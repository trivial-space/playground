{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/contants.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/libs/dist/events/dom.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/asset-lib.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/render-utils.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/form.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/texture.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/render-target.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/frame.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/layer.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/shade.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/sketch.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/painter.js","webpack:///./shared-utils/painterState.ts","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/libs/dist/utils/object.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/painter/dist/utils/context.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/libs/dist/utils/sequence.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/process/browser.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/api/constants.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/libs/dist/events/keyboard.js","webpack:///./experiments/textures/context.ts","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/is-string.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/idgen.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/is-array.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/tslib/tslib.es6.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/is-plain-object.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/equiv/index.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/associative/dissoc.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/transducers/func/compr.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/implements-function.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/transducers/internal/ensure.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/transducers/reduced.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/errors/deferror.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/errors/illegal-arity.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/transducers/reduce.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/is-arraylike.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/transducers/iterator.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/transducers/xform/map.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/associative/internal/inspect.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/api/mixin.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/is-map.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/associative/into.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/associative/array-set.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/associative/internal/equiv.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/associative/equiv-map.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/is-set.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/associative/union.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/associative/utils.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/errors/illegal-arguments.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/transducers/xform/filter.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/dgraph/index.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/checks.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/scope.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/sym.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/function.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/is-number.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/is-boolean.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/lit.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/item.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/ops.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/assign.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/swizzle.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/ast/controlflow.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/builtin/math.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast-stdlib/math/fit.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast-stdlib/screen/uv.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast-stdlib/math/additive.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast-stdlib/math/magsq.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast-stdlib/noise/permute.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast-stdlib/noise/simplex2.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/errors/unsupported.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/api/api/logger.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/api/logger.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/defmulti/constants.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/defmulti/defmulti.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast/target.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast-glsl/api.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/shader-ast-glsl/target.js","webpack:///./experiments/textures/shaders.ts","webpack:///./experiments/textures/index.ts","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/libs/dist/math/random.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/api/assert.js","webpack:////Users/trival/projects/personal/trivialspace/playground/node_modules/@thi.ng/checks/is-node.js","webpack:///./shared-utils/scheduler.ts","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/libs/dist/events/pointer.js","webpack:////Users/trival/projects/personal/trivialspace/playground/projects/libs/dist/utils/predicates.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","GEOMETRY_PROP_POSITION","GEOMETRY_PROP_NORMAL","GEOMETRY_PROP_UV","UNIFORM_SOURCE_TEXTURE","VARYING_UV_COORDS","GL_TYPE","FLOAT","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","INT","INT_VEC2","INT_VEC3","INT_VEC4","BOOL","BOOL_VEC2","BOOL_VEC3","BOOL_VEC4","FLOAT_MAT2","FLOAT_MAT3","FLOAT_MAT4","SAMPLER_2D","SAMPLER_CUBE","SAMPLER_3D","SAMPLER_2D_SHADOW","FLOAT_MAT2X3","FLOAT_MAT2X4","FLOAT_MAT3X2","FLOAT_MAT3X4","FLOAT_MAT4X2","FLOAT_MAT4X3","SAMPLER_2D_ARRAY","SAMPLER_2D_ARRAY_SHADOW","SAMPLER_CUBE_SHADOW","UNSIGNED_INT","UNSIGNED_INT_VEC2","UNSIGNED_INT_VEC3","UNSIGNED_INT_VEC4","INT_SAMPLER_2D","INT_SAMPLER_3D","INT_SAMPLER_CUBE","INT_SAMPLER_2D_ARRAY","UNSIGNED_INT_SAMPLER_2D","UNSIGNED_INT_SAMPLER_3D","UNSIGNED_INT_SAMPLER_CUBE","UNSIGNED_INT_SAMPLER_2D_ARRAY","TEXTURE_2D","TEXTURE_CUBE_MAP","TEXTURE_3D","TEXTURE_2D_ARRAY","BYTE","UNSIGNED_BYTE","SHORT","UNSIGNED_SHORT","UNSIGNED_SHORT_4_4_4_4","UNSIGNED_SHORT_5_5_5_1","UNSIGNED_SHORT_5_6_5","HALF_FLOAT","UNSIGNED_INT_2_10_10_10_REV","UNSIGNED_INT_10F_11F_11F_REV","UNSIGNED_INT_5_9_9_9_REV","FLOAT_32_UNSIGNED_INT_24_8_REV","UNSIGNED_INT_24_8","TEXTURE_FORMAT","TEXTURE_FORMAT_INTERNAL","windowSize","callback","resize","width","window","innerWidth","height","innerHeight","addEventListener","removeEventListener","defaultTextureSettings","defaultForms","renderQuad","attribs","buffer","Float32Array","storeType","drawType","itemCount","defaultShaders","basicEffect","vert","frag","getBindPointForSamplerType","type","typeMap","bindPoint","intSetter","gl","location","v","uniform1i","intArraySetter","uniform1iv","intVec2Setter","uniform2iv","intVec3Setter","uniform3iv","intVec4Setter","uniform4iv","samplerSetter","unit","texture","activeTexture","TEXTURE0","bindTexture","_texture","samplerArraySetter","size","units","Int32Array","textures","index","Type","setter","uniform1f","arraySetter","uniform1fv","uniform2fv","uniform3fv","uniform4fv","Uint32Array","uniform1ui","uniform1uiv","uniform2uiv","uniform3uiv","uniform4uiv","uniformMatrix2fv","uniformMatrix3fv","uniformMatrix4fv","uniformMatrix2x3fv","uniformMatrix2x4fv","uniformMatrix3x2fv","uniformMatrix3x4fv","uniformMatrix4x2fv","uniformMatrix4x3fv","floatAttribSetter","typeInfo","b","bindBuffer","ARRAY_BUFFER","enableVertexAttribArray","vertexAttribPointer","itemSize","normalize","stride","offset","intAttribSetter","vertexAttribIPointer","matAttribSetter","defaultSize","count","numComponents","rowOffset","attrTypeMap","Int8Array","Uint8Array","Int16Array","Uint16Array","applyDrawSettings","settings","enable","setting","disable","blendFunc","apply","depthFunc","cullFace","frontFace","lineWidth","colorMask","depthMask","clearColor","clearDepth","clearBits","clear","revertDrawSettings","formCounter","_painter","id","this","data","_drawType","_itemCount","_attribs","attribData","createBuffer","bufferData","elements","_elements","glType","typedArray","Uint8ClampedArray","Error","getGLTypeForTypedArray","ELEMENT_ARRAY_BUFFER","deleteBuffer","undefined","textureCount","_data","createTexture","wrap","wrapS","wrapT","texParameteri","TEXTURE_WRAP_S","TEXTURE_WRAP_T","magFilter","TEXTURE_MAG_FILTER","minFilter","TEXTURE_MIN_FILTER","asset","texImage2D","RGBA","isWebGL2","RGBA32F","flipY","pixelStorei","UNPACK_FLIP_Y_WEBGL","indexOf","generateMipmap","assign","deleteTexture","frameBuffer","depthBuffer","bufferStructure","length","every","buf","createFramebuffer","bindFramebuffer","FRAMEBUFFER","some","getExtension","texCount","bufferAttachments","COLOR_ATTACHMENT0","glx","attachment","COLOR_ATTACHMENT0_WEBGL","drawBuffers","drawBuffersWEBGL","update","framebufferTexture2D","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","err","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","console","error","deleteFramebuffer","deleteRenderbuffer","frameCount","layers","_targets","_textures","Array","isArray","selfReferencing","layerCount","reduce","layer","_uniforms","targetCount","drawingBufferWidth","drawingBufferHeight","_destroyTargets","targetData","forEach","tex","destroy","tmp","Layer","sketches","sketch","shade","uniforms","shadeCounter","fragSource","trim","vertSource","program","createProgram","createShader","FRAGMENT_SHADER","VERTEX_SHADER","_program","_frag","_vert","attachShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","addLineNumbers","linkProgram","getProgramParameter","LINK_STATUS","lastError","getProgramInfoLog","_uniformSetters","textureUnit","createUniformSetter","uniformInfo","getUniformLocation","substr","toString","uniformSetters","numUniforms","ACTIVE_UNIFORMS","getActiveUniform","createUniformSetters","_attributeSetters","attribSetters","numAttribs","ACTIVE_ATTRIBUTES","attribInfo","getActiveAttrib","getAttribLocation","createAttributeSetters","deleteProgram","deleteShader","src","split","map","line","join","sketchCounter","Sketch","drawSettings","_drawSettings","form","canvas","opts","maxBufferSamples","useWebGL1","getContext","sizeMultiplier","getParameter","MAX_SAMPLES","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","getDefaultLayerSettings","_renderQuad","createForm","_staticSketch","createFlatSketch","createSketch","createShade","createLayer","globalUniforms","viewport","draw","frames","frame","renderFrame","idx","source","image","sources","useProgram","shadeForm","shadeUniforms","drawInstance","drawElements","drawArrays","renderLayer","target","layerPasses","j","_swapTargets","currentCanvas","painter","getPainter","state","device","cancelWindow","cancelPointer","cancelKeys","dispatch","baseEvents","RESIZE","pointer","element","enableRightButton","keyboard","k","keys","init","getForm","shades","getShade","getSketch","getLayer","getFrame","createFrame","effects","getEffect","createEffect","tpf","prop","set","val","reset","deepOverride","obj1","obj2","opt","ignore","val1","val2","getState","systems","addSystem","event","FRAME","makeClear","clearArray","res","item","toUpperCase","resizeCanvas","multiplier","clientWidth","clientHeight","pickRandom","arr","doTimes","fn","times","zip","as","bs","Math","min","flatten","array","subarray","currentLength","mapcat","coll","obj","each","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","defaultClearTimeout","runTimeout","fun","setTimeout","e","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","timeout","len","run","marker","runClearTimeout","Item","noop","nextTick","args","arguments","push","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","SEMAPHORE","NO_OP","Keys","cb","pressed","onKeydown","keyCode","Date","now","onKeyup","document","getElementById","events","isString","x","symID","gensym","__decorate","decorators","desc","getOwnPropertyDescriptor","Reflect","decorate","getPrototypeOf","FN","equiv","a","proto","equivArrayLike","Set","equivSet","Map","equivMap","getTime","RegExp","equivObject","_equiv","sort","dissoc","delete","compR","rfn","implementsFunction","ensureTransducer","xform","Reduced","isReduced","unreduced","deref","defError","prefix","suffix","msg","super","IllegalArityError","parseArgs","illegalArity","complete","acc","xs","$reduce","reduceArray","reduceIterable","reducer","iterator1","_","y","inspect","inspectSet","inspectMap","inspectable","behaviour","sharedBehaviour","instanceKeys","ownKeys","sharedKeys","typeTag","_mixin","clazz","existing","configurable","writable","log","propertyIsEnumerable","hasInstance","mixin","for","depth","childOpts","stylize","isMap","into","dest","add","ArraySet_1","__private","WeakMap","__vals","inst","vals","iterator","species","$this","slice","has","notFound","eq","splice","thisArg","EquivMap_1","__map","pairs","_opts","entries","copy","pair","values","union","out","ctor","IllegalArgumentError","illegalArgs","filter","pred","edges","dependencies","dependents","addDependency","g","node","dep","depends","deps","transitiveDependencies","transitiveDependents","immediateDependents","immediateDependencies","isLeaf","nodes","isRoot","transitive","sorted","leaves","reverse","first","removeEdge","removeNode","RE_VEC","RE_MAT","isVec","test","isMat","scopedChildren","tag","scope","body","f","allChildren","walk","visit","children","tree","pre","buildCallGraph","graph","addNode","decl","global","uniform","q","defArg","defn","_args","_body","returns","assert","$","funcall","ret","builtinCall","isNumber","isBoolean","lit","info","bool","uint","wrapFloat","wrapInt","wrapUint","wrapBool","FALSE","FLOAT0","FLOAT1","FLOAT2","FLOAT05","INT0","UINT0","$gvec","PI","SQRT2","$vec","$gvec2","$gvec3","$gvec4","vec2","vec3","vec4","numberWithMatchingType","op1","op","post","OP_INFO","mave","vema","vefl","mafl","flve","flma","ivin","iniv","uvui","uiuv","op2","_l","_r","rtype","nl","nr","inc","sub","mul","div","cmp","neq","lt","gt","$x","$y","$xy","ternary","forLoop","iter","ctrl","primOp1","primOp2","primOp3","dot","max","abs","floor","fract","mod","aspectCorrectedUV","pos","uv","additive","oct","shift","decay","amp","magSq2","__permute","permute3","snoise2","C","i1","x0","x12","h","ox","a0","UnsupportedOperationError","unsupported","LogLevel","NULL_LOGGER","freeze","level","NONE","DEFAULT","LOGGER","findImpl","impls","rels","parents","impl","findAncestors","makeRels","spec","defTarget","ancestors","warn","addAll","_impls","ok","remove","callable","isa","parent","defmulti","GLSLVersion","RE_SEMI","fs","GLES_300","versionPragma","prelude","isVS","$list","sep","$fn","$decl","sym","arg","in","uni","loc","const","prec","replace","itemType","num","array_init","call_i","if","String","trunc","swizzle","while","gl_FragColor","gl_FragCoord","gl_FragData","gl_FrontFacing","gl_PointCoord","gl_PointSize","gl_Position","targetGLSL","GLES_100","resolution","getImage","fragCoord","time","col","noiseShader","syms","noise","toNormal","noiseFrame","compose","display","randInt","int","random","randIntInRange","from","to","normalRand","UMBRELLA_ASSERTS","isNode","updateOnce","updateRepeat","willUpdate","uidCounter","oldTime","processUpdates","updates","requestAnimationFrame","repeat","stop","Buttons","LEFT","MIDDLE","RIGHT","holdDelay","holdRadius","drag","dX","dY","xMax","yMax","dragging","holding","oX","oY","onPointerDown","isPrimary","button","clientX","clientY","onPointerUp","_e","onPointerMove","preventDefault","equalArray","arr1","arr2","equalObject","k1"],"mappings":"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","file":"experiments/textures/main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 43);\n","export const GEOMETRY_PROP_POSITION = 'position';\nexport const GEOMETRY_PROP_NORMAL = 'normal';\nexport const GEOMETRY_PROP_UV = 'uv';\nexport const UNIFORM_SOURCE_TEXTURE = 'source';\nexport const VARYING_UV_COORDS = 'coords';\nexport const GL_TYPE = {\n    FLOAT: 0x1406,\n    FLOAT_VEC2: 0x8b50,\n    FLOAT_VEC3: 0x8b51,\n    FLOAT_VEC4: 0x8b52,\n    INT: 0x1404,\n    INT_VEC2: 0x8b53,\n    INT_VEC3: 0x8b54,\n    INT_VEC4: 0x8b55,\n    BOOL: 0x8b56,\n    BOOL_VEC2: 0x8b57,\n    BOOL_VEC3: 0x8b58,\n    BOOL_VEC4: 0x8b59,\n    FLOAT_MAT2: 0x8b5a,\n    FLOAT_MAT3: 0x8b5b,\n    FLOAT_MAT4: 0x8b5c,\n    SAMPLER_2D: 0x8b5e,\n    SAMPLER_CUBE: 0x8b60,\n    SAMPLER_3D: 0x8b5f,\n    SAMPLER_2D_SHADOW: 0x8b62,\n    FLOAT_MAT2X3: 0x8b65,\n    FLOAT_MAT2X4: 0x8b66,\n    FLOAT_MAT3X2: 0x8b67,\n    FLOAT_MAT3X4: 0x8b68,\n    FLOAT_MAT4X2: 0x8b69,\n    FLOAT_MAT4X3: 0x8b6a,\n    SAMPLER_2D_ARRAY: 0x8dc1,\n    SAMPLER_2D_ARRAY_SHADOW: 0x8dc4,\n    SAMPLER_CUBE_SHADOW: 0x8dc5,\n    UNSIGNED_INT: 0x1405,\n    UNSIGNED_INT_VEC2: 0x8dc6,\n    UNSIGNED_INT_VEC3: 0x8dc7,\n    UNSIGNED_INT_VEC4: 0x8dc8,\n    INT_SAMPLER_2D: 0x8dca,\n    INT_SAMPLER_3D: 0x8dcb,\n    INT_SAMPLER_CUBE: 0x8dcc,\n    INT_SAMPLER_2D_ARRAY: 0x8dcf,\n    UNSIGNED_INT_SAMPLER_2D: 0x8dd2,\n    UNSIGNED_INT_SAMPLER_3D: 0x8dd3,\n    UNSIGNED_INT_SAMPLER_CUBE: 0x8dd4,\n    UNSIGNED_INT_SAMPLER_2D_ARRAY: 0x8dd7,\n    TEXTURE_2D: 0x0de1,\n    TEXTURE_CUBE_MAP: 0x8513,\n    TEXTURE_3D: 0x806f,\n    TEXTURE_2D_ARRAY: 0x8c1a,\n    BYTE: 0x1400,\n    UNSIGNED_BYTE: 0x1401,\n    SHORT: 0x1402,\n    UNSIGNED_SHORT: 0x1403,\n    UNSIGNED_SHORT_4_4_4_4: 0x8033,\n    UNSIGNED_SHORT_5_5_5_1: 0x8034,\n    UNSIGNED_SHORT_5_6_5: 0x8363,\n    HALF_FLOAT: 0x140b,\n    UNSIGNED_INT_2_10_10_10_REV: 0x8368,\n    UNSIGNED_INT_10F_11F_11F_REV: 0x8c3b,\n    UNSIGNED_INT_5_9_9_9_REV: 0x8c3e,\n    FLOAT_32_UNSIGNED_INT_24_8_REV: 0x8dad,\n    UNSIGNED_INT_24_8: 0x84fa,\n};\nexport const TEXTURE_FORMAT = {\n    RED: 0x1903,\n    RG: 0x8227,\n    RGB: 0x1907,\n    RGBA: 0x1908,\n    RED_INTEGER: 0x8d94,\n    RG_INTEGER: 0x8228,\n    RGB_INTEGER: 0x8d98,\n    RGBA_INTEGER: 0x8d99,\n    DEPTH_COMPONENT: 0x1902,\n};\nexport const TEXTURE_FORMAT_INTERNAL = {\n    R8: 0x8229,\n    RG8: 0x822b,\n    RGB8: 0x8051,\n    RGBA8: 0x8058,\n    R16F: 0x822d,\n    RG16F: 0x822f,\n    RGB16F: 0x881b,\n    RGBA16F: 0x881a,\n    R32F: 0x822e,\n    RG32F: 0x8230,\n    RGB32F: 0x8815,\n    RGBA32F: 0x8814,\n    R8I: 0x8231,\n    RG8I: 0x8237,\n    RGB8I: 0x8d8f,\n    RGBA8I: 0x8d8e,\n    R8UI: 0x8232,\n    RG8UI: 0x8238,\n    RGB8UI: 0x8d7d,\n    RGBA8UI: 0x8d7c,\n    R16I: 0x8233,\n    RG16I: 0x8239,\n    RGB16I: 0x8d89,\n    RGBA16I: 0x8d88,\n    R16UI: 0x8234,\n    RG16UI: 0x823a,\n    RGB16UI: 0x8d77,\n    RGBA16UI: 0x8d76,\n    R32I: 0x8235,\n    RG32I: 0x823b,\n    RGB32I: 0x8d83,\n    RGBA32I: 0x8d82,\n    R32UI: 0x8236,\n    RG32UI: 0x823c,\n    RGB32UI: 0x8d71,\n    RGBA32UI: 0x8d70,\n    RGB10_A2: 0x8059,\n    RGB10_A2UI: 0x906f,\n    SRGB: 0x8c40,\n    SRGB8: 0x8c41,\n    SRGB8_ALPHA8: 0x8c43,\n    R8_SNORM: 0x8f94,\n    RG8_SNORM: 0x8f95,\n    RGB8_SNORM: 0x8f96,\n    RGBA8_SNORM: 0x8f97,\n    DEPTH_COMPONENT16: 0x81a5,\n    DEPTH_COMPONENT24: 0x81a6,\n    DEPTH_COMPONENT32F: 0x8cac,\n};\nexport const TEXTURE_FORMAT_DEFAULTS = {\n    [GL_TYPE.UNSIGNED_BYTE]: {\n        [TEXTURE_FORMAT.RED]: TEXTURE_FORMAT_INTERNAL.R8,\n        [TEXTURE_FORMAT.RG]: TEXTURE_FORMAT_INTERNAL.RG8,\n        [TEXTURE_FORMAT.RGB]: TEXTURE_FORMAT_INTERNAL.RGB8,\n        [TEXTURE_FORMAT.RGBA]: TEXTURE_FORMAT_INTERNAL.RGBA8,\n    },\n    [GL_TYPE.UNSIGNED_SHORT]: {\n        [TEXTURE_FORMAT.DEPTH_COMPONENT]: TEXTURE_FORMAT_INTERNAL.DEPTH_COMPONENT16,\n        [TEXTURE_FORMAT.RED]: TEXTURE_FORMAT_INTERNAL.R16UI,\n        [TEXTURE_FORMAT.RG]: TEXTURE_FORMAT_INTERNAL.RG16UI,\n        [TEXTURE_FORMAT.RGB]: TEXTURE_FORMAT_INTERNAL.RGB16UI,\n        [TEXTURE_FORMAT.RGBA]: TEXTURE_FORMAT_INTERNAL.RGBA16UI,\n    },\n    [GL_TYPE.UNSIGNED_INT]: {\n        [TEXTURE_FORMAT.DEPTH_COMPONENT]: TEXTURE_FORMAT_INTERNAL.DEPTH_COMPONENT24,\n        [TEXTURE_FORMAT.RED]: TEXTURE_FORMAT_INTERNAL.R32UI,\n        [TEXTURE_FORMAT.RG]: TEXTURE_FORMAT_INTERNAL.RG32UI,\n        [TEXTURE_FORMAT.RGB]: TEXTURE_FORMAT_INTERNAL.RGB32UI,\n        [TEXTURE_FORMAT.RGBA]: TEXTURE_FORMAT_INTERNAL.RGBA32UI,\n    },\n    [GL_TYPE.FLOAT]: {\n        [TEXTURE_FORMAT.RED]: TEXTURE_FORMAT_INTERNAL.R16F,\n        [TEXTURE_FORMAT.RG]: TEXTURE_FORMAT_INTERNAL.RG16F,\n        [TEXTURE_FORMAT.RGB]: TEXTURE_FORMAT_INTERNAL.RGB16F,\n        [TEXTURE_FORMAT.RGBA]: TEXTURE_FORMAT_INTERNAL.RGBA16F,\n        [TEXTURE_FORMAT.DEPTH_COMPONENT]: TEXTURE_FORMAT_INTERNAL.DEPTH_COMPONENT32F,\n    },\n    COMPRESSED_TYPES: {},\n};\n//# sourceMappingURL=contants.js.map","export function windowSize(callback) {\n    function resize() {\n        callback({\n            width: window.innerWidth,\n            height: window.innerHeight,\n        });\n    }\n    window.addEventListener('resize', resize);\n    resize();\n    return function stop() {\n        window.removeEventListener('resize', resize);\n    };\n}\nexport function windowSizeObserver() {\n    const state = {\n        size: { width: 0, height: 0 },\n    };\n    const destroy = windowSize(s => (state.size = s));\n    return { state, destroy };\n}\n//# sourceMappingURL=dom.js.map","import * as constants from './contants';\nexport const defaultTextureSettings = {\n    wrap: 'CLAMP_TO_EDGE',\n    minFilter: 'LINEAR',\n    magFilter: 'NEAREST',\n};\nexport function getDefaultLayerSettings(gl) {\n    return {\n        clearColor: [0.0, 0.0, 0.0, 1.0],\n        blendFunc: [gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA],\n    };\n}\nexport const defaultForms = {\n    renderQuad: {\n        attribs: {\n            [constants.GEOMETRY_PROP_POSITION]: {\n                buffer: new Float32Array([-1, 1, -1, -1, 1, 1, 1, -1]),\n                storeType: 'STATIC',\n            },\n            [constants.GEOMETRY_PROP_UV]: {\n                buffer: new Float32Array([0, 1, 0, 0, 1, 1, 1, 0]),\n                storeType: 'STATIC',\n            },\n        },\n        drawType: 'TRIANGLE_STRIP',\n        itemCount: 4,\n    },\n};\nexport const defaultShaders = {\n    basicEffect: {\n        vert: `\nattribute vec2 ${constants.GEOMETRY_PROP_POSITION};\nattribute vec2 ${constants.GEOMETRY_PROP_UV};\nvarying vec2 ${constants.VARYING_UV_COORDS};\nvoid main() {\n\t${constants.VARYING_UV_COORDS} = ${constants.GEOMETRY_PROP_UV};\n\tgl_Position = vec4(${constants.GEOMETRY_PROP_POSITION}, 0.0, 1.0);\n}`,\n        frag: `precision mediump float;\nuniform sampler2D ${constants.UNIFORM_SOURCE_TEXTURE};\nvarying vec2 ${constants.VARYING_UV_COORDS};\nvoid main() {\n\tgl_FragColor = texture2D(${constants.UNIFORM_SOURCE_TEXTURE}, ${constants.VARYING_UV_COORDS});\n}`,\n    },\n};\n//# sourceMappingURL=asset-lib.js.map","import { GL_TYPE } from './contants';\n// Attrib and Uniform Setters\nfunction getBindPointForSamplerType(type) {\n    return typeMap[type].bindPoint;\n}\nfunction floatSetter(gl, location) {\n    return (v) => {\n        gl.uniform1f(location, v);\n    };\n}\nfunction floatArraySetter(gl, location) {\n    return (v) => {\n        gl.uniform1fv(location, v);\n    };\n}\nfunction floatVec2Setter(gl, location) {\n    return (v) => {\n        gl.uniform2fv(location, v);\n    };\n}\nfunction floatVec3Setter(gl, location) {\n    return (v) => {\n        gl.uniform3fv(location, v);\n    };\n}\nfunction floatVec4Setter(gl, location) {\n    return (v) => {\n        gl.uniform4fv(location, v);\n    };\n}\nfunction intSetter(gl, location) {\n    return (v) => {\n        gl.uniform1i(location, v);\n    };\n}\nfunction intArraySetter(gl, location) {\n    return (v) => {\n        gl.uniform1iv(location, v);\n    };\n}\nfunction intVec2Setter(gl, location) {\n    return (v) => {\n        gl.uniform2iv(location, v);\n    };\n}\nfunction intVec3Setter(gl, location) {\n    return (v) => {\n        gl.uniform3iv(location, v);\n    };\n}\nfunction intVec4Setter(gl, location) {\n    return (v) => {\n        gl.uniform4iv(location, v);\n    };\n}\nfunction uintSetter(gl, location) {\n    return (v) => {\n        gl.uniform1ui(location, v);\n    };\n}\nfunction uintArraySetter(gl, location) {\n    return (v) => {\n        gl.uniform1uiv(location, v);\n    };\n}\nfunction uintVec2Setter(gl, location) {\n    return (v) => {\n        gl.uniform2uiv(location, v);\n    };\n}\nfunction uintVec3Setter(gl, location) {\n    return (v) => {\n        gl.uniform3uiv(location, v);\n    };\n}\nfunction uintVec4Setter(gl, location) {\n    return (v) => {\n        gl.uniform4uiv(location, v);\n    };\n}\nfunction floatMat2Setter(gl, location) {\n    return (v) => {\n        gl.uniformMatrix2fv(location, false, v);\n    };\n}\nfunction floatMat3Setter(gl, location) {\n    return (v) => {\n        gl.uniformMatrix3fv(location, false, v);\n    };\n}\nfunction floatMat4Setter(gl, location) {\n    return (v) => {\n        gl.uniformMatrix4fv(location, false, v);\n    };\n}\nfunction floatMat23Setter(gl, location) {\n    return (v) => {\n        gl.uniformMatrix2x3fv(location, false, v);\n    };\n}\nfunction floatMat32Setter(gl, location) {\n    return (v) => {\n        gl.uniformMatrix3x2fv(location, false, v);\n    };\n}\nfunction floatMat24Setter(gl, location) {\n    return (v) => {\n        gl.uniformMatrix2x4fv(location, false, v);\n    };\n}\nfunction floatMat42Setter(gl, location) {\n    return (v) => {\n        gl.uniformMatrix4x2fv(location, false, v);\n    };\n}\nfunction floatMat34Setter(gl, location) {\n    return (v) => {\n        gl.uniformMatrix3x4fv(location, false, v);\n    };\n}\nfunction floatMat43Setter(gl, location) {\n    return (v) => {\n        gl.uniformMatrix4x3fv(location, false, v);\n    };\n}\nfunction samplerSetter(gl, type, unit, location) {\n    const bindPoint = getBindPointForSamplerType(type);\n    return (texture) => {\n        gl.uniform1i(location, unit);\n        gl.activeTexture(gl.TEXTURE0 + unit);\n        gl.bindTexture(bindPoint, texture._texture);\n    };\n}\nfunction samplerArraySetter(gl, type, unit, location, size) {\n    const bindPoint = getBindPointForSamplerType(type);\n    const units = new Int32Array(size);\n    for (let i = 0; i < size; ++i) {\n        units[i] = unit + i;\n    }\n    return (textures) => {\n        gl.uniform1iv(location, units);\n        for (const index in textures) {\n            gl.activeTexture(gl.TEXTURE0 + units[index]);\n            gl.bindTexture(bindPoint, textures[index]._texture);\n        }\n    };\n}\nfunction isSamplerInfo(info) {\n    return info.Type === null;\n}\nconst typeMap = {\n    [GL_TYPE.FLOAT]: {\n        Type: Float32Array,\n        size: 4,\n        setter: floatSetter,\n        arraySetter: floatArraySetter,\n    },\n    [GL_TYPE.FLOAT_VEC2]: {\n        Type: Float32Array,\n        size: 8,\n        setter: floatVec2Setter,\n    },\n    [GL_TYPE.FLOAT_VEC3]: {\n        Type: Float32Array,\n        size: 12,\n        setter: floatVec3Setter,\n    },\n    [GL_TYPE.FLOAT_VEC4]: {\n        Type: Float32Array,\n        size: 16,\n        setter: floatVec4Setter,\n    },\n    [GL_TYPE.INT]: {\n        Type: Int32Array,\n        size: 4,\n        setter: intSetter,\n        arraySetter: intArraySetter,\n    },\n    [GL_TYPE.INT_VEC2]: { Type: Int32Array, size: 8, setter: intVec2Setter },\n    [GL_TYPE.INT_VEC3]: { Type: Int32Array, size: 12, setter: intVec3Setter },\n    [GL_TYPE.INT_VEC4]: { Type: Int32Array, size: 16, setter: intVec4Setter },\n    [GL_TYPE.UNSIGNED_INT]: {\n        Type: Uint32Array,\n        size: 4,\n        setter: uintSetter,\n        arraySetter: uintArraySetter,\n    },\n    [GL_TYPE.UNSIGNED_INT_VEC2]: {\n        Type: Uint32Array,\n        size: 8,\n        setter: uintVec2Setter,\n    },\n    [GL_TYPE.UNSIGNED_INT_VEC3]: {\n        Type: Uint32Array,\n        size: 12,\n        setter: uintVec3Setter,\n    },\n    [GL_TYPE.UNSIGNED_INT_VEC4]: {\n        Type: Uint32Array,\n        size: 16,\n        setter: uintVec4Setter,\n    },\n    [GL_TYPE.BOOL]: {\n        Type: Uint32Array,\n        size: 4,\n        setter: intSetter,\n        arraySetter: intArraySetter,\n    },\n    [GL_TYPE.BOOL_VEC2]: { Type: Uint32Array, size: 8, setter: intVec2Setter },\n    [GL_TYPE.BOOL_VEC3]: { Type: Uint32Array, size: 12, setter: intVec3Setter },\n    [GL_TYPE.BOOL_VEC4]: { Type: Uint32Array, size: 16, setter: intVec4Setter },\n    [GL_TYPE.FLOAT_MAT2]: {\n        Type: Float32Array,\n        size: 16,\n        setter: floatMat2Setter,\n    },\n    [GL_TYPE.FLOAT_MAT3]: {\n        Type: Float32Array,\n        size: 36,\n        setter: floatMat3Setter,\n    },\n    [GL_TYPE.FLOAT_MAT4]: {\n        Type: Float32Array,\n        size: 64,\n        setter: floatMat4Setter,\n    },\n    [GL_TYPE.FLOAT_MAT2X3]: {\n        Type: Float32Array,\n        size: 24,\n        setter: floatMat23Setter,\n    },\n    [GL_TYPE.FLOAT_MAT2X4]: {\n        Type: Float32Array,\n        size: 32,\n        setter: floatMat24Setter,\n    },\n    [GL_TYPE.FLOAT_MAT3X2]: {\n        Type: Float32Array,\n        size: 24,\n        setter: floatMat32Setter,\n    },\n    [GL_TYPE.FLOAT_MAT3X4]: {\n        Type: Float32Array,\n        size: 48,\n        setter: floatMat34Setter,\n    },\n    [GL_TYPE.FLOAT_MAT4X2]: {\n        Type: Float32Array,\n        size: 32,\n        setter: floatMat42Setter,\n    },\n    [GL_TYPE.FLOAT_MAT4X3]: {\n        Type: Float32Array,\n        size: 48,\n        setter: floatMat43Setter,\n    },\n    [GL_TYPE.SAMPLER_2D]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_2D,\n    },\n    [GL_TYPE.SAMPLER_CUBE]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_CUBE_MAP,\n    },\n    [GL_TYPE.SAMPLER_3D]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_3D,\n    },\n    [GL_TYPE.SAMPLER_2D_SHADOW]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_2D,\n    },\n    [GL_TYPE.SAMPLER_2D_ARRAY]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_2D_ARRAY,\n    },\n    [GL_TYPE.SAMPLER_2D_ARRAY_SHADOW]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_2D_ARRAY,\n    },\n    [GL_TYPE.SAMPLER_CUBE_SHADOW]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_CUBE_MAP,\n    },\n    [GL_TYPE.INT_SAMPLER_2D]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_2D,\n    },\n    [GL_TYPE.INT_SAMPLER_3D]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_3D,\n    },\n    [GL_TYPE.INT_SAMPLER_CUBE]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_CUBE_MAP,\n    },\n    [GL_TYPE.INT_SAMPLER_2D_ARRAY]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_2D_ARRAY,\n    },\n    [GL_TYPE.UNSIGNED_INT_SAMPLER_2D]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_2D,\n    },\n    [GL_TYPE.UNSIGNED_INT_SAMPLER_3D]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_3D,\n    },\n    [GL_TYPE.UNSIGNED_INT_SAMPLER_CUBE]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_CUBE_MAP,\n    },\n    [GL_TYPE.UNSIGNED_INT_SAMPLER_2D_ARRAY]: {\n        Type: null,\n        size: 0,\n        setter: samplerSetter,\n        arraySetter: samplerArraySetter,\n        bindPoint: GL_TYPE.TEXTURE_2D_ARRAY,\n    },\n};\nfunction floatAttribSetter(gl, location, typeInfo) {\n    return (b) => {\n        gl.bindBuffer(gl.ARRAY_BUFFER, b.buffer);\n        gl.enableVertexAttribArray(location);\n        gl.vertexAttribPointer(location, typeInfo.itemSize, GL_TYPE.FLOAT, b.normalize || false, b.stride || 0, b.offset || 0);\n    };\n}\nfunction intAttribSetter(gl, location, typeInfo) {\n    return (b) => {\n        gl.bindBuffer(gl.ARRAY_BUFFER, b.buffer);\n        gl.enableVertexAttribArray(location);\n        gl.vertexAttribIPointer(location, typeInfo.itemSize, GL_TYPE.INT, b.stride || 0, b.offset || 0);\n    };\n}\nfunction matAttribSetter(gl, location, typeInfo) {\n    const defaultSize = typeInfo.size;\n    const count = typeInfo.count;\n    return (b) => {\n        gl.bindBuffer(gl.ARRAY_BUFFER, b.buffer);\n        const numComponents = defaultSize;\n        const size = numComponents / count;\n        const typeInfo = typeMap[GL_TYPE.FLOAT];\n        const stride = typeInfo.size * numComponents;\n        const normalize = b.normalize || false;\n        const offset = b.offset || 0;\n        const rowOffset = stride / count;\n        for (let i = 0; i < count; ++i) {\n            gl.enableVertexAttribArray(location + i);\n            gl.vertexAttribPointer(location + i, size, GL_TYPE.FLOAT, normalize, stride, offset + rowOffset * i);\n        }\n    };\n}\nconst attrTypeMap = {\n    [GL_TYPE.FLOAT]: { size: 4, setter: floatAttribSetter, itemSize: 1 },\n    [GL_TYPE.FLOAT_VEC2]: { size: 8, setter: floatAttribSetter, itemSize: 2 },\n    [GL_TYPE.FLOAT_VEC3]: { size: 12, setter: floatAttribSetter, itemSize: 3 },\n    [GL_TYPE.FLOAT_VEC4]: { size: 16, setter: floatAttribSetter, itemSize: 4 },\n    [GL_TYPE.INT]: { size: 4, setter: intAttribSetter, itemSize: 1 },\n    [GL_TYPE.INT_VEC2]: { size: 8, setter: intAttribSetter, itemSize: 2 },\n    [GL_TYPE.INT_VEC3]: { size: 12, setter: intAttribSetter, itemSize: 3 },\n    [GL_TYPE.INT_VEC4]: { size: 16, setter: intAttribSetter, itemSize: 4 },\n    [GL_TYPE.UNSIGNED_INT]: { size: 4, setter: intAttribSetter, itemSize: 1 },\n    [GL_TYPE.UNSIGNED_INT_VEC2]: {\n        size: 8,\n        setter: intAttribSetter,\n        itemSize: 2,\n    },\n    [GL_TYPE.UNSIGNED_INT_VEC3]: {\n        size: 12,\n        setter: intAttribSetter,\n        itemSize: 3,\n    },\n    [GL_TYPE.UNSIGNED_INT_VEC4]: {\n        size: 16,\n        setter: intAttribSetter,\n        itemSize: 4,\n    },\n    [GL_TYPE.BOOL]: { size: 4, setter: intAttribSetter, itemSize: 1 },\n    [GL_TYPE.BOOL_VEC2]: { size: 8, setter: intAttribSetter, itemSize: 2 },\n    [GL_TYPE.BOOL_VEC3]: { size: 12, setter: intAttribSetter, itemSize: 3 },\n    [GL_TYPE.BOOL_VEC4]: { size: 16, setter: intAttribSetter, itemSize: 4 },\n    [GL_TYPE.FLOAT_MAT2]: { size: 4, setter: matAttribSetter, count: 2 },\n    [GL_TYPE.FLOAT_MAT3]: { size: 9, setter: matAttribSetter, count: 3 },\n    [GL_TYPE.FLOAT_MAT4]: { size: 16, setter: matAttribSetter, count: 4 },\n};\nexport function createUniformSetters(gl, program) {\n    let textureUnit = 0;\n    function createUniformSetter(program, uniformInfo) {\n        const location = gl.getUniformLocation(program, uniformInfo.name);\n        const isArray = uniformInfo.size > 1 && uniformInfo.name.substr(-3) === '[0]';\n        const type = uniformInfo.type;\n        const typeInfo = typeMap[type];\n        if (!typeInfo) {\n            throw new Error('unknown type: 0x' + type.toString(16)); // we should never get here.\n        }\n        if (location == null) {\n            return;\n        }\n        let setter;\n        if (isSamplerInfo(typeInfo)) {\n            // it's a sampler\n            const unit = textureUnit;\n            textureUnit += uniformInfo.size;\n            if (isArray) {\n                setter = typeInfo.arraySetter(gl, type, unit, location, uniformInfo.size);\n            }\n            else {\n                setter = typeInfo.setter(gl, type, unit, location);\n            }\n        }\n        else {\n            if (typeInfo.arraySetter && isArray) {\n                setter = typeInfo.arraySetter(gl, location);\n            }\n            else {\n                setter = typeInfo.setter(gl, location);\n            }\n        }\n        return { setter, location };\n    }\n    const uniformSetters = {};\n    const numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n    for (let i = 0; i < numUniforms; ++i) {\n        const uniformInfo = gl.getActiveUniform(program, i);\n        if (!uniformInfo) {\n            continue;\n        }\n        let name = uniformInfo.name;\n        // remove the array suffix.\n        if (name.substr(-3) === '[0]') {\n            name = name.substr(0, name.length - 3);\n        }\n        if (program) {\n            const setter = createUniformSetter(program, uniformInfo);\n            if (setter) {\n                uniformSetters[name] = setter;\n            }\n        }\n    }\n    return uniformSetters;\n}\nexport function createAttributeSetters(gl, program) {\n    const attribSetters = {};\n    const numAttribs = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n    for (let i = 0; i < numAttribs; i++) {\n        const attribInfo = gl.getActiveAttrib(program, i);\n        if (!attribInfo) {\n            break;\n        }\n        const location = gl.getAttribLocation(program, attribInfo.name);\n        const typeInfo = attrTypeMap[attribInfo.type];\n        const setter = typeInfo.setter(gl, location, typeInfo);\n        attribSetters[attribInfo.name] = { setter, location };\n    }\n    return attribSetters;\n}\n// Type helpers\nexport const glTypeToTypedArray = {\n    [GL_TYPE.BYTE]: Int8Array,\n    [GL_TYPE.UNSIGNED_BYTE]: Uint8Array,\n    [GL_TYPE.SHORT]: Int16Array,\n    [GL_TYPE.UNSIGNED_SHORT]: Uint16Array,\n    [GL_TYPE.INT]: Int32Array,\n    [GL_TYPE.UNSIGNED_INT]: Uint32Array,\n    [GL_TYPE.FLOAT]: Float32Array,\n    [GL_TYPE.UNSIGNED_SHORT_4_4_4_4]: Uint16Array,\n    [GL_TYPE.UNSIGNED_SHORT_5_5_5_1]: Uint16Array,\n    [GL_TYPE.UNSIGNED_SHORT_5_6_5]: Uint16Array,\n    [GL_TYPE.HALF_FLOAT]: Uint16Array,\n    [GL_TYPE.UNSIGNED_INT_2_10_10_10_REV]: Uint32Array,\n    [GL_TYPE.UNSIGNED_INT_10F_11F_11F_REV]: Uint32Array,\n    [GL_TYPE.UNSIGNED_INT_5_9_9_9_REV]: Uint32Array,\n    [GL_TYPE.FLOAT_32_UNSIGNED_INT_24_8_REV]: Uint32Array,\n    [GL_TYPE.UNSIGNED_INT_24_8]: Uint32Array,\n};\nexport function getGLTypeForTypedArray(typedArray) {\n    if (typedArray instanceof Int8Array) {\n        return GL_TYPE.BYTE;\n    }\n    if (typedArray instanceof Uint8Array) {\n        return GL_TYPE.UNSIGNED_BYTE;\n    }\n    if (typedArray instanceof Uint8ClampedArray) {\n        return GL_TYPE.UNSIGNED_BYTE;\n    }\n    if (typedArray instanceof Int16Array) {\n        return GL_TYPE.SHORT;\n    }\n    if (typedArray instanceof Uint16Array) {\n        return GL_TYPE.UNSIGNED_SHORT;\n    }\n    if (typedArray instanceof Int32Array) {\n        return GL_TYPE.INT;\n    }\n    if (typedArray instanceof Uint32Array) {\n        return GL_TYPE.UNSIGNED_INT;\n    }\n    if (typedArray instanceof Float32Array) {\n        return GL_TYPE.FLOAT;\n    }\n    throw new Error('unsupported typed array type');\n}\nexport function getGLTypeForTypedArrayType(typedArrayType) {\n    if (typedArrayType === Int8Array) {\n        return GL_TYPE.BYTE;\n    }\n    if (typedArrayType === Uint8Array) {\n        return GL_TYPE.UNSIGNED_BYTE;\n    }\n    if (typedArrayType === Uint8ClampedArray) {\n        return GL_TYPE.UNSIGNED_BYTE;\n    }\n    if (typedArrayType === Int16Array) {\n        return GL_TYPE.SHORT;\n    }\n    if (typedArrayType === Uint16Array) {\n        return GL_TYPE.UNSIGNED_SHORT;\n    }\n    if (typedArrayType === Int32Array) {\n        return GL_TYPE.INT;\n    }\n    if (typedArrayType === Uint32Array) {\n        return GL_TYPE.UNSIGNED_INT;\n    }\n    if (typedArrayType === Float32Array) {\n        return GL_TYPE.FLOAT;\n    }\n    throw new Error('unsupported typed array type');\n}\n// Settings\nexport function applyDrawSettings(gl, settings) {\n    if (settings.enable) {\n        for (const setting of settings.enable) {\n            gl.enable(setting);\n        }\n    }\n    if (settings.disable) {\n        for (const setting of settings.disable) {\n            gl.disable(setting);\n        }\n    }\n    if (settings.blendFunc) {\n        gl.blendFunc.apply(gl, settings.blendFunc);\n    }\n    if (settings.depthFunc != null) {\n        gl.depthFunc(settings.depthFunc);\n    }\n    if (settings.cullFace != null) {\n        gl.cullFace(settings.cullFace);\n    }\n    if (settings.frontFace != null) {\n        gl.frontFace(settings.frontFace);\n    }\n    if (settings.lineWidth != null) {\n        gl.lineWidth(settings.lineWidth);\n    }\n    if (settings.colorMask) {\n        gl.colorMask.apply(gl, settings.colorMask);\n    }\n    if (settings.depthMask != null) {\n        gl.depthMask(settings.depthMask);\n    }\n    if (settings.clearColor) {\n        gl.clearColor.apply(gl, settings.clearColor);\n    }\n    if (settings.clearDepth != null) {\n        gl.clearDepth(settings.clearDepth);\n    }\n    if (settings.clearBits != null) {\n        gl.clear(settings.clearBits);\n    }\n}\nexport function revertDrawSettings(gl, settings) {\n    if (settings.enable) {\n        for (const setting of settings.enable) {\n            gl.disable(setting);\n        }\n    }\n    if (settings.disable) {\n        for (const setting of settings.disable) {\n            gl.enable(setting);\n        }\n    }\n}\n//# sourceMappingURL=render-utils.js.map","import { getGLTypeForTypedArray } from './render-utils';\nlet formCounter = 1;\nexport class Form {\n    constructor(_painter, id = 'Form' + formCounter++) {\n        this._painter = _painter;\n        this.id = id;\n    }\n    update(data) {\n        const gl = this._painter.gl;\n        if (data.drawType) {\n            this._drawType = gl[data.drawType];\n        }\n        if (data.itemCount) {\n            this._itemCount = data.itemCount;\n        }\n        this._attribs = this._attribs || {};\n        for (const id in data.attribs) {\n            const attribData = data.attribs[id];\n            if (this._attribs[id] == null) {\n                this._attribs[id] = {\n                    buffer: gl.createBuffer(),\n                };\n            }\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._attribs[id].buffer);\n            gl.bufferData(gl.ARRAY_BUFFER, attribData.buffer, gl[(attribData.storeType || 'STATIC') + '_DRAW']);\n        }\n        if (data.elements) {\n            const buffer = data.elements.buffer;\n            if (this._elements == null) {\n                this._elements = {\n                    buffer: gl.createBuffer(),\n                    glType: null,\n                };\n            }\n            this._elements.glType = getGLTypeForTypedArray(buffer);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._elements.buffer);\n            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, buffer, gl[(data.elements.storeType || 'STATIC') + '_DRAW']);\n        }\n        return this;\n    }\n    destroy() {\n        const gl = this._painter.gl;\n        for (const id in this._attribs) {\n            gl.deleteBuffer(this._attribs[id].buffer);\n        }\n        this._attribs = {};\n        if (this._elements) {\n            gl.deleteBuffer(this._elements.buffer);\n            this._elements = undefined;\n        }\n    }\n}\n//# sourceMappingURL=form.js.map","import { defaultTextureSettings } from './asset-lib';\nlet textureCount = 1;\nexport class Texture {\n    constructor(_painter, id = 'Texture' + textureCount++) {\n        this._painter = _painter;\n        this.id = id;\n        this._texture = null;\n        this._data = {};\n    }\n    update(data) {\n        const gl = this._painter.gl;\n        if (this._texture == null) {\n            this._texture = gl.createTexture();\n        }\n        gl.bindTexture(gl.TEXTURE_2D, this._texture);\n        if ((data.wrap && data.wrap !== this._data.wrap) ||\n            (data.wrapS && data.wrapS !== this._data.wrapS) ||\n            (data.wrapT && data.wrapT !== this._data.wrapT)) {\n            let wrapS, wrapT;\n            if (data.wrap) {\n                wrapS = wrapT = data.wrap;\n            }\n            else {\n                wrapT = data.wrapT || defaultTextureSettings.wrap;\n                wrapS = data.wrapS || defaultTextureSettings.wrap;\n            }\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl[wrapS]);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl[wrapT]);\n        }\n        else if (!(this._data.wrap || this._data.wrapS || this._data.wrapT)) {\n            this._data.wrap = this._data.wrapT = this._data.wrapS = defaultTextureSettings.wrap;\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl[this._data.wrap]);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl[this._data.wrap]);\n        }\n        if (data.magFilter && data.magFilter !== this._data.magFilter) {\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl[data.magFilter]);\n        }\n        else if (!this._data.magFilter) {\n            this._data.magFilter = defaultTextureSettings.magFilter;\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl[this._data.magFilter]);\n        }\n        if (data.minFilter && data.minFilter !== this._data.minFilter) {\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl[data.minFilter]);\n        }\n        else if (!this._data.minFilter) {\n            this._data.minFilter = defaultTextureSettings.minFilter;\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl[this._data.minFilter]);\n        }\n        if (data.asset) {\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data.asset);\n        }\n        if (data.data !== undefined) {\n            gl.texImage2D(gl.TEXTURE_2D, 0, data.type === 'FLOAT' && this._painter.isWebGL2\n                ? gl.RGBA32F\n                : gl.RGBA, data.width, // width and height are required if using custom data\n            data.height, 0, gl.RGBA, gl[data.type || 'UNSIGNED_BYTE'], data.data);\n        }\n        if (data.flipY != null && data.flipY !== this._data.flipY) {\n            gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, data.flipY);\n        }\n        if (data.minFilter && data.minFilter.indexOf('MIPMAP') > 0) {\n            gl.generateMipmap(gl.TEXTURE_2D);\n        }\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        Object.assign(this._data, data);\n        return this;\n    }\n    destroy() {\n        this._painter.gl.deleteTexture(this._texture);\n        this._data = {};\n        this._texture = null;\n    }\n}\n//# sourceMappingURL=texture.js.map","import { equalObject } from 'tvs-libs/dist/utils/predicates';\nimport { Texture } from './texture';\nlet targetCount = 1;\nexport class RenderTarget {\n    constructor(_painter, id = 'Form' + targetCount++) {\n        this._painter = _painter;\n        this.id = id;\n        this.width = 0;\n        this.height = 0;\n        this.frameBuffer = null;\n        this.textures = [];\n        this.depthBuffer = null;\n        this.bufferStructure = [];\n        this._data = {};\n    }\n    update(data) {\n        const gl = this._painter.gl;\n        const width = data.width || this.width;\n        const height = data.height || this.height;\n        if (!(width && height)) {\n            return this;\n        }\n        else if (width === this.width && height === this.height) {\n            if (!data.bufferStructure)\n                return this;\n            if (data.bufferStructure.length === this.bufferStructure.length &&\n                this.bufferStructure.every((buf, i) => equalObject(buf, data.bufferStructure[i]))) {\n                return this;\n            }\n        }\n        if (this.frameBuffer == null) {\n            this.frameBuffer = gl.createFramebuffer();\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.frameBuffer);\n        if (data.bufferStructure && data.bufferStructure.length) {\n            this.bufferStructure = data.bufferStructure;\n            if (this.bufferStructure.some(t => t.type === 'FLOAT')) {\n                if (this._painter.isWebGL2) {\n                    gl.getExtension('EXT_color_buffer_float');\n                }\n                else {\n                    gl.getExtension('OES_texture_float');\n                }\n            }\n        }\n        const texCount = this.bufferStructure.length || 1;\n        const bufferAttachments = [gl.COLOR_ATTACHMENT0];\n        if (texCount > 1) {\n            let glx;\n            if (!this._painter.isWebGL2) {\n                glx = gl.getExtension('WEBGL_draw_buffers');\n            }\n            const attachment = this._painter.isWebGL2\n                ? gl.COLOR_ATTACHMENT0\n                : glx.COLOR_ATTACHMENT0_WEBGL;\n            for (let i = 0; i < texCount; i++) {\n                bufferAttachments[i] = attachment + i;\n            }\n            this._painter.isWebGL2\n                ? gl.drawBuffers(bufferAttachments)\n                : glx.drawBuffersWEBGL(bufferAttachments);\n        }\n        for (let i = 0; i < texCount; i++) {\n            if (!this.textures[i]) {\n                this.textures[i] = new Texture(this._painter, this.id + '_Texture' + i);\n            }\n            const texture = this.textures[i];\n            texture.update(Object.assign(Object.assign({ minFilter: 'NEAREST', magFilter: 'NEAREST' }, this.bufferStructure[i]), { data: null, width,\n                height }));\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, bufferAttachments[i], gl.TEXTURE_2D, texture._texture, 0);\n        }\n        if (this.depthBuffer == null) {\n            this.depthBuffer = gl.createRenderbuffer();\n        }\n        gl.bindRenderbuffer(gl.RENDERBUFFER, this.depthBuffer);\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height);\n        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, this.depthBuffer);\n        const err = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        if (err !== gl.FRAMEBUFFER_COMPLETE) {\n            console.error('framebuffer error', err, data);\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n        Object.assign(this._data, data);\n        this.width = width;\n        this.height = height;\n        return this;\n    }\n    destroy() {\n        const gl = this._painter.gl;\n        gl.deleteFramebuffer(this.frameBuffer);\n        gl.deleteRenderbuffer(this.depthBuffer);\n        for (const texture of this.textures) {\n            gl.deleteTexture(texture);\n        }\n        this.textures = [];\n        this.frameBuffer = null;\n        this.depthBuffer = null;\n        this._data = {};\n        this.bufferStructure = [];\n        this.width = 0;\n        this.height = 0;\n    }\n}\n//# sourceMappingURL=render-target.js.map","import { times } from 'tvs-libs/dist/utils/sequence';\nimport { RenderTarget } from './render-target';\nimport { Texture } from './texture';\nlet frameCount = 1;\nexport class Frame {\n    constructor(_painter, id = 'Frame' + frameCount++) {\n        this._painter = _painter;\n        this.id = id;\n        this.width = 0;\n        this.height = 0;\n        this.layers = [];\n        this._data = {};\n        this._targets = [];\n        this._textures = [];\n    }\n    image(i = 0) {\n        return ((this._targets.length &&\n            this._targets[this._targets.length - 1].textures[i]) ||\n            this._textures[i]);\n    }\n    update(data = {}) {\n        const gl = this._painter.gl;\n        const layers = Array.isArray(data.layers)\n            ? data.layers\n            : data.layers\n                ? [data.layers]\n                : this.layers;\n        const selfReferencing = data.selfReferencing || this._data.selfReferencing;\n        const layerCount = layers.reduce((count, layer) => count + (layer._uniforms.length || 1), 0);\n        const targetCount = selfReferencing || layerCount > 1 ? 2 : layerCount;\n        const width = data.width || this._data.width || gl.drawingBufferWidth;\n        const height = data.height || this._data.height || gl.drawingBufferHeight;\n        if (targetCount !== this._targets.length) {\n            this._destroyTargets();\n        }\n        const targetData = Object.assign(Object.assign({}, data), { width, height });\n        if (!this._targets.length && targetCount > 0) {\n            this._targets = times(i => new RenderTarget(this._painter, this.id + '_target' + (i + 1)).update(targetData), targetCount);\n        }\n        else if (this._targets.length) {\n            this._targets.forEach(t => {\n                t.update(targetData);\n            });\n        }\n        if (data.texture) {\n            // Hardcode to one static texture for now\n            if (!this._textures[0]) {\n                this._textures[0] = new Texture(this._painter, this.id + '_Texture0');\n            }\n            data.texture.width = data.texture.width || width;\n            data.texture.height = data.texture.height || height;\n            this._textures[0].update(data.texture);\n        }\n        Object.assign(this._data, data);\n        this.layers = layers;\n        this.width = width;\n        this.height = height;\n        return this;\n    }\n    destroy() {\n        this._destroyTargets();\n        this._textures.forEach(tex => tex.destroy());\n        this._textures = [];\n        this._data = {};\n        this.layers = [];\n        this.width = 0;\n        this.height = 0;\n    }\n    _destroyTargets() {\n        this._targets.forEach(t => t.destroy());\n        this._targets = [];\n    }\n    _swapTargets() {\n        if (this._targets.length > 1) {\n            const tmp = this._targets[0];\n            this._targets[0] = this._targets[1];\n            this._targets[1] = tmp;\n        }\n    }\n}\n//# sourceMappingURL=frame.js.map","let layerCount = 1;\nexport class Layer {\n    constructor(id = 'DrawingLayer' + layerCount++) {\n        this.id = id;\n        this.sketches = [];\n        this._data = {};\n        this._uniforms = [];\n    }\n    update(data) {\n        if (data.sketches) {\n            this.sketches = Array.isArray(data.sketches)\n                ? data.sketches\n                : [data.sketches];\n        }\n        if (data.frag) {\n            const sketch = this.sketches && this.sketches[0];\n            if (sketch) {\n                sketch.shade.update({ frag: data.frag });\n            }\n        }\n        if (data.uniforms) {\n            this._uniforms = Array.isArray(data.uniforms)\n                ? data.uniforms\n                : [data.uniforms];\n        }\n        Object.assign(this._data, data);\n        return this;\n    }\n    destroy() {\n        for (const sketch of this.sketches) {\n            sketch.destroy();\n        }\n        this._data.sketches = [];\n        this._data = {};\n        this._uniforms = [];\n    }\n}\n//# sourceMappingURL=layer.js.map","import { createAttributeSetters, createUniformSetters } from './render-utils';\nlet shadeCounter = 1;\nexport class Shade {\n    constructor(_painter, id = 'Shade' + shadeCounter++) {\n        this._painter = _painter;\n        this.id = id;\n    }\n    update(data) {\n        const gl = this._painter.gl;\n        const fragSource = (data.frag && data.frag.trim()) || this.fragSource;\n        const vertSource = (data.vert && data.vert.trim()) || this.vertSource;\n        if (!(fragSource &&\n            vertSource &&\n            (fragSource !== this.fragSource || vertSource !== this.vertSource))) {\n            return this;\n        }\n        this.destroy();\n        if (fragSource.indexOf('GL_EXT_draw_buffers') >= 0) {\n            gl.getExtension('WEBGL_draw_buffers');\n        }\n        const program = gl.createProgram();\n        const frag = gl.createShader(gl.FRAGMENT_SHADER);\n        const vert = gl.createShader(gl.VERTEX_SHADER);\n        if (!(program && vert && frag))\n            return;\n        this._program = program;\n        this._frag = frag;\n        this._vert = vert;\n        gl.attachShader(program, vert);\n        gl.attachShader(program, frag);\n        gl.shaderSource(vert, vertSource);\n        gl.shaderSource(frag, fragSource);\n        gl.compileShader(vert);\n        gl.compileShader(frag);\n        if (!gl.getShaderParameter(vert, gl.COMPILE_STATUS)) {\n            console.error('Error Compiling Vertex Shader!\\n', gl.getShaderInfoLog(vert), addLineNumbers(vertSource));\n        }\n        if (!gl.getShaderParameter(frag, gl.COMPILE_STATUS)) {\n            console.error('Error Compiling Fragment Shader!\\n', gl.getShaderInfoLog(frag), addLineNumbers(fragSource));\n        }\n        gl.linkProgram(program);\n        const linked = gl.getProgramParameter(program, gl.LINK_STATUS);\n        if (!linked) {\n            const lastError = gl.getProgramInfoLog(program);\n            console.error('Error in program linking:', lastError);\n        }\n        this._uniformSetters = createUniformSetters(gl, program);\n        this._attributeSetters = createAttributeSetters(gl, program);\n        this.fragSource = fragSource;\n        this.vertSource = vertSource;\n        return this;\n    }\n    destroy() {\n        const gl = this._painter.gl;\n        gl.deleteProgram(this._program);\n        gl.deleteShader(this._frag);\n        gl.deleteShader(this._vert);\n        this.vertSource = undefined;\n        this.fragSource = undefined;\n        this._attributeSetters = {};\n        this._uniformSetters = {};\n    }\n}\nfunction addLineNumbers(src) {\n    return src\n        .trim()\n        .split('\\n')\n        .map((line, i) => i + 1 + ': ' + line)\n        .join('\\n');\n}\n//# sourceMappingURL=shade.js.map","let sketchCounter = 1;\nexport class Sketch {\n    constructor(id = 'Sketch' + sketchCounter++) {\n        this.id = id;\n        this._uniforms = [];\n    }\n    update(data) {\n        if (data.drawSettings) {\n            this._drawSettings = data.drawSettings;\n        }\n        if (data.form) {\n            this.form = data.form;\n        }\n        if (data.shade) {\n            this.shade = data.shade;\n        }\n        if (data.uniforms) {\n            this._uniforms = Array.isArray(data.uniforms)\n                ? data.uniforms\n                : [data.uniforms];\n        }\n        return this;\n    }\n    destroy() {\n        this.form && this.form.destroy();\n        this.shade && this.shade.destroy();\n        this._drawSettings = undefined;\n        this._uniforms = [];\n    }\n}\n//# sourceMappingURL=sketch.js.map","import { defaultForms, defaultShaders, getDefaultLayerSettings, } from './asset-lib';\nimport { Form } from './form';\nimport { Frame } from './frame';\nimport { Layer } from './layer';\nimport { applyDrawSettings, revertDrawSettings } from './render-utils';\nimport { Shade } from './shade';\nimport { Sketch } from './sketch';\nimport { resizeCanvas } from './utils/context';\nexport class Painter {\n    constructor(canvas, opts = {}) {\n        this.canvas = canvas;\n        this.isWebGL2 = true;\n        this.maxBufferSamples = 0;\n        let gl = null;\n        if (!opts.useWebGL1) {\n            gl =\n                canvas.getContext('webgl2', opts) ||\n                    canvas.getContext('experimental-webgl2', opts);\n        }\n        if (gl == null) {\n            this.isWebGL2 = false;\n            gl =\n                canvas.getContext('webgl', opts) ||\n                    canvas.getContext('experimental-webgl', opts);\n        }\n        if (gl == null) {\n            throw Error('Cannot initialize WebGL.');\n        }\n        this.gl = gl;\n        this.sizeMultiplier = opts.sizeMultiplier || 1;\n        if (this.isWebGL2) {\n            this.maxBufferSamples = gl.getParameter(gl.MAX_SAMPLES);\n        }\n        this.resize();\n        applyDrawSettings(gl, getDefaultLayerSettings(gl));\n        this._renderQuad = this.createForm().update(defaultForms.renderQuad);\n        this._staticSketch = this.createFlatSketch();\n    }\n    resize() {\n        resizeCanvas(this.gl.canvas, this.sizeMultiplier);\n        return this;\n    }\n    destroy() {\n        this._staticSketch.destroy();\n        this._renderQuad.destroy();\n    }\n    updateDrawSettings(drawSettings) {\n        applyDrawSettings(this.gl, Object.assign({}, drawSettings));\n        return this;\n    }\n    createForm(id) {\n        return new Form(this, id);\n    }\n    createShade(id) {\n        return new Shade(this, id);\n    }\n    createSketch(id) {\n        return new Sketch(id);\n    }\n    createFlatSketch(id) {\n        const s = this.createSketch(id);\n        return s.update({\n            form: this._renderQuad,\n            shade: this.createShade(s.id + '_defaultShade').update(defaultShaders.basicEffect),\n        });\n    }\n    createFrame(id) {\n        return new Frame(this, id);\n    }\n    createLayer(id) {\n        return new Layer(id);\n    }\n    createEffect(id) {\n        const l = this.createLayer(id);\n        return l.update({\n            sketches: this.createFlatSketch(l.id + '_effectSketch'),\n        });\n    }\n    draw(sketch, globalUniforms) {\n        const gl = this.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n        draw(gl, sketch, globalUniforms);\n        return this;\n    }\n    compose(...frames) {\n        for (const frame of frames) {\n            renderFrame(this.gl, frame);\n        }\n        return this;\n    }\n    display(frame, idx = 0) {\n        return this.draw(this._staticSketch, { source: frame.image(idx) });\n    }\n}\nfunction draw(gl, sketch, globalUniforms, sources) {\n    const { shade: shade, form: form, _drawSettings: drawSettings, _uniforms: uniforms, } = sketch;\n    if (!(shade && form)) {\n        throw Error('cannot draw, shader or geometry are not set');\n    }\n    gl.useProgram(shade._program);\n    shadeForm(shade, form);\n    if (globalUniforms) {\n        shadeUniforms(shade, globalUniforms, sources);\n    }\n    if (drawSettings) {\n        applyDrawSettings(gl, drawSettings);\n    }\n    for (let i = 0; i < (uniforms.length || 1); i++) {\n        drawInstance(gl, sketch, uniforms[i], sources);\n    }\n    if (drawSettings) {\n        revertDrawSettings(gl, drawSettings);\n    }\n}\nfunction drawInstance(gl, sketch, uniforms, sources) {\n    if (uniforms) {\n        shadeUniforms(sketch.shade, uniforms, sources);\n    }\n    if (sketch.form._elements && sketch.form._elements.glType != null) {\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sketch.form._elements.buffer);\n        gl.drawElements(sketch.form._drawType, sketch.form._itemCount, sketch.form._elements.glType, 0);\n    }\n    else {\n        gl.drawArrays(sketch.form._drawType, 0, sketch.form._itemCount);\n    }\n}\nfunction shadeForm(shade, form) {\n    for (const name in form._attribs) {\n        const setter = shade._attributeSetters[name];\n        if (setter) {\n            setter.setter(form._attribs[name]);\n        }\n    }\n}\nfunction shadeUniforms(shade, uniforms, sources) {\n    for (const name in uniforms) {\n        const setter = shade._uniformSetters[name];\n        if (setter) {\n            let value = uniforms[name];\n            if (typeof value === 'function') {\n                value = value();\n            }\n            if (typeof value === 'string' && sources) {\n                setter.setter(sources[value]);\n            }\n            else {\n                setter.setter(value);\n            }\n        }\n    }\n}\nfunction renderLayer(gl, layer, uniforms, target, source) {\n    if (target) {\n        gl.bindFramebuffer(gl.FRAMEBUFFER, target.frameBuffer);\n        gl.viewport(0, 0, target.width, target.height);\n    }\n    else {\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n    }\n    if (layer._data.drawSettings) {\n        applyDrawSettings(gl, layer._data.drawSettings);\n    }\n    for (const sketch of layer.sketches) {\n        draw(gl, sketch, uniforms, source);\n    }\n    if (layer._data.drawSettings) {\n        revertDrawSettings(gl, layer._data.drawSettings);\n    }\n}\nfunction renderFrame(gl, frame) {\n    for (let i = 0; i < frame.layers.length; i++) {\n        const layer = frame.layers[i];\n        const layerPasses = layer._uniforms.length || 1;\n        for (let j = 0; j < layerPasses; j++) {\n            const target = frame._targets[0];\n            const sources = i + j === 0 && frame._textures.length\n                ? frame._textures\n                : frame._targets[1] && frame._targets[1].textures;\n            renderLayer(gl, layer, layer._uniforms[j], target, sources);\n            frame._swapTargets();\n        }\n    }\n}\n//# sourceMappingURL=painter.js.map","import { once } from './scheduler'\nimport { windowSize } from 'tvs-libs/dist/events/dom'\nimport { keyboard, KeyState } from 'tvs-libs/dist/events/keyboard'\nimport { deepOverride } from 'tvs-libs/dist/utils/object'\nimport { PainterOptions } from 'tvs-painter'\nimport { Form } from 'tvs-painter/dist/form'\nimport { Frame } from 'tvs-painter/dist/frame'\nimport { Layer } from 'tvs-painter/dist/layer'\nimport { Painter } from 'tvs-painter/dist/painter'\nimport { Shade } from 'tvs-painter/dist/shade'\nimport { Sketch } from 'tvs-painter/dist/sketch'\nimport { PointerState, pointer } from 'tvs-libs/dist/events/pointer'\n\n// === Painter ===\n\nlet currentCanvas: HTMLCanvasElement\nlet painter: Painter\n\nexport function getPainter(canvas: HTMLCanvasElement, opts?: PainterOptions) {\n\tinit(canvas, opts)\n\treturn painter\n}\n\nconst forms: { [id: string]: Form } = {}\nexport function getForm(painter: Painter, id: string) {\n\treturn forms[id] || (forms[id] = painter.createForm('Form_' + id))\n}\n\nconst shades: { [id: string]: Shade } = {}\nexport function getShade(painter: Painter, id: string) {\n\treturn shades[id] || (shades[id] = painter.createShade('Shade_' + id))\n}\n\nconst sketches: { [id: string]: Sketch } = {}\nexport function getSketch(painter: Painter, id: string) {\n\treturn sketches[id] || (sketches[id] = painter.createSketch('Sketch_' + id))\n}\n\nconst layers: { [id: string]: Layer } = {}\nexport function getLayer(painter: Painter, id: string) {\n\treturn layers[id] || (layers[id] = painter.createLayer('Layer_' + id))\n}\n\nconst frames: { [id: string]: Frame } = {}\nexport function getFrame(painter: Painter, id: string) {\n\treturn frames[id] || (frames[id] = painter.createFrame('Frame_' + id))\n}\n\nconst effects: { [id: string]: Layer } = {}\nexport function getEffect(painter: Painter, id: string) {\n\treturn effects[id] || (effects[id] = painter.createEffect('Effect_' + id))\n}\n\n// === State ===\n\nexport interface BaseState {\n\tdevice: {\n\t\ttpf: number\n\t\tcanvas: HTMLCanvasElement\n\t\tpointer: PointerState\n\t\tkeys: KeyState\n\t\tsizeMultiplier: number\n\t\tkeepCanvasSize?: boolean\n\t}\n}\n\nexport const state: BaseState = {\n\tdevice: {\n\t\ttpf: 0,\n\t\tsizeMultiplier: 1,\n\t},\n} as BaseState\n;(window as any).state = state\n\nexport function get<\n\tS extends BaseState = BaseState,\n\tK extends keyof S = keyof S\n>(prop: K): S[K] {\n\treturn (state as S)[prop]\n}\n\nexport function set<\n\tS extends BaseState = BaseState,\n\tK extends keyof S = keyof S\n>(key: K, val: S[K], opts?: { reset: any }) {\n\tconst s = state as S\n\tif (s[key]) {\n\t\tconst reset = opts && opts.reset\n\t\tif (reset !== true) {\n\t\t\tval = deepOverride(val, s[key], { ignore: reset })\n\t\t}\n\t}\n\ts[key] = val\n}\n\nexport function getState<S extends BaseState>() {\n\treturn state as S\n}\n\n// === Systems ===\n\ntype ActionHandler<S extends BaseState = BaseState> = (\n\tevent: string,\n\tstate: S,\n) => void\n\nconst systems: { [id: string]: ActionHandler<any> } = {}\n\nexport function addSystem<S extends BaseState = BaseState>(\n\tid: string,\n\ts: ActionHandler<S>,\n) {\n\tsystems[id] = s\n}\n\nexport function dispatch(event: string) {\n\tfor (const k in systems) {\n\t\tsystems[k](event, state)\n\t}\n}\n\nexport const baseEvents = {\n\tFRAME: 'frame',\n\tRESIZE: 'resize',\n}\n\n// === Init ===\n\nlet cancelWindow: () => void\nlet cancelPointer: () => void\nlet cancelKeys: () => void\n\nexport function init(canvas: HTMLCanvasElement, opts?: PainterOptions) {\n\tif (canvas !== currentCanvas) {\n\t\tcurrentCanvas = canvas\n\n\t\tpainter = new Painter(canvas, opts)\n\n\t\tstate.device.canvas = canvas\n\n\t\tcancelWindow && cancelWindow()\n\t\tcancelPointer && cancelPointer()\n\t\tcancelKeys && cancelKeys()\n\n\t\tcancelWindow = windowSize(() =>\n\t\t\tonce(() => {\n\t\t\t\tpainter.sizeMultiplier = state.device.sizeMultiplier\n\t\t\t\tpainter.resize()\n\t\t\t\tdispatch(baseEvents.RESIZE)\n\t\t\t}, 'resize'),\n\t\t)\n\n\t\tcancelPointer = pointer(\n\t\t\t{ element: canvas, enableRightButton: true },\n\t\t\tm => (state.device.pointer = m),\n\t\t)\n\n\t\tcancelKeys = keyboard(k => (state.device.keys = k))\n\t}\n}\n\n\nif (module.hot) {module.hot.accept(function(err) {\nif (err) {\nconsole.error(err);\n}\n});\n}\n","export function deepmerge(obj1, obj2) {\n    if (typeof obj1 === 'object' &&\n        typeof obj2 === 'object' &&\n        !Array.isArray(obj1) &&\n        !Array.isArray(obj2) &&\n        obj1 !== obj2) {\n        const result = Object.assign({}, obj1);\n        for (const key in obj2) {\n            const val1 = obj1[key];\n            const val2 = obj2[key];\n            if (typeof val2 !== 'undefined') {\n                result[key] = deepmerge(val1, val2);\n            }\n            else {\n                delete result[key];\n            }\n        }\n        return result;\n    }\n    return obj2;\n}\nexport function deepOverride(obj1, obj2, opt) {\n    const ignore = opt && opt.ignore;\n    if (typeof obj1 === 'object' &&\n        typeof obj2 === 'object' &&\n        !Array.isArray(obj1) &&\n        !Array.isArray(obj2) &&\n        obj1 !== obj2) {\n        for (const key in obj1) {\n            if (obj1.hasOwnProperty(key) &&\n                !(ignore && key in ignore && ignore[key] === true)) {\n                const val1 = obj1[key];\n                const val2 = obj2[key];\n                if (val2 !== undefined) {\n                    obj1[key] = deepOverride(val1, val2, {\n                        ignore: ignore && ignore[key],\n                    });\n                }\n            }\n        }\n        return obj1;\n    }\n    return obj2;\n}\n//# sourceMappingURL=object.js.map","export function makeClear(gl, ...clearArray) {\n    return clearArray.reduce((res, item) => res | gl[item.toUpperCase() + '_BUFFER_BIT'], 0);\n}\nexport function setBlendFunc(gl, blendOpts) {\n    gl.blendFunc.apply(gl, blendOpts.map(opt => gl[opt.toUpperCase()]));\n}\n/**\n * @param {HTMLCanvasElement} canvas The canvas to resize.\n * @param {number} [multiplier] optional `window.devicePixelRatio`.\n * @return {boolean} true if the canvas was resized.\n */\nexport function resizeCanvas(canvas, multiplier = 1) {\n    let width = canvas.width;\n    let height = canvas.height;\n    if ('clientWidth' in canvas && 'clientHeight' in canvas) {\n        width = (canvas.clientWidth * multiplier) | 0;\n        height = (canvas.clientHeight * multiplier) | 0;\n    }\n    if (canvas.width !== width || canvas.height !== height) {\n        canvas.width = width;\n        canvas.height = height;\n        return true;\n    }\n    return false;\n}\n//# sourceMappingURL=context.js.map","import { randInt, randIntInRange } from '../math/random';\nexport function pickRandom(arr) {\n    return arr[randInt(arr.length)];\n}\nexport function doTimes(fn, count) {\n    for (let i = 0; i < count; i++) {\n        fn(i);\n    }\n}\nexport function times(fn, count, res = []) {\n    for (let i = 0; i < count; i++) {\n        res[i] = fn(i);\n    }\n    return res;\n}\nexport function zip(fn, as, bs, res = []) {\n    const length = Math.min(as.length, bs.length);\n    for (let i = 0; i < length; i++) {\n        res[i] = fn(as[i], bs[i]);\n    }\n    return res;\n}\nexport function flatten(array, res = []) {\n    for (const subarray of array) {\n        const currentLength = res.length;\n        for (let i = 0; i < subarray.length; i++) {\n            res[i + currentLength] = subarray[i];\n        }\n    }\n    return res;\n}\nexport function mapcat(fn, array, res = []) {\n    return flatten(array.map(fn), res);\n}\nexport function shuffle(arr) {\n    const shuffled = [];\n    for (let i = 0; i < arr.length; i++) {\n        const j = randIntInRange(i, arr.length);\n        const temp = shuffled[i] !== undefined ? shuffled[i] : arr[i];\n        shuffled[i] = shuffled[j] !== undefined ? shuffled[j] : arr[j];\n        shuffled[j] = temp;\n    }\n    return shuffled;\n}\nexport function map(fn, coll) {\n    if (Array.isArray(coll)) {\n        return coll.map(fn);\n    }\n    else {\n        const obj = {};\n        for (const key in coll) {\n            obj[key] = fn(coll[key], key);\n        }\n        return obj;\n    }\n}\nexport function each(fn, coll) {\n    for (const key in coll) {\n        fn(coll[key], key);\n    }\n}\n//# sourceMappingURL=sequence.js.map","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","export const DEFAULT_EPS = 1e-6;\n/**\n * Internal use only. **Do NOT use in user land code!**\n *\n * @internal\n */\nexport const SEMAPHORE = Symbol();\n/**\n * No-effect placeholder function.\n */\nexport const NO_OP = () => { };\n/**\n * Catch-all event ID\n */\nexport const EVENT_ALL = \"*\";\nexport const EVENT_ENABLE = \"enable\";\nexport const EVENT_DISABLE = \"disable\";\n","export var Keys;\n(function (Keys) {\n    Keys[Keys[\"CANCEL\"] = 3] = \"CANCEL\";\n    Keys[Keys[\"HELP\"] = 6] = \"HELP\";\n    Keys[Keys[\"BACK_SPACE\"] = 8] = \"BACK_SPACE\";\n    Keys[Keys[\"TAB\"] = 9] = \"TAB\";\n    Keys[Keys[\"CLEAR\"] = 12] = \"CLEAR\";\n    Keys[Keys[\"RETURN\"] = 13] = \"RETURN\";\n    Keys[Keys[\"ENTER\"] = 14] = \"ENTER\";\n    Keys[Keys[\"SHIFT\"] = 16] = \"SHIFT\";\n    Keys[Keys[\"CONTROL\"] = 17] = \"CONTROL\";\n    Keys[Keys[\"ALT\"] = 18] = \"ALT\";\n    Keys[Keys[\"PAUSE\"] = 19] = \"PAUSE\";\n    Keys[Keys[\"CAPS_LOCK\"] = 20] = \"CAPS_LOCK\";\n    Keys[Keys[\"ESCAPE\"] = 27] = \"ESCAPE\";\n    Keys[Keys[\"SPACE\"] = 32] = \"SPACE\";\n    Keys[Keys[\"PAGE_UP\"] = 33] = \"PAGE_UP\";\n    Keys[Keys[\"PAGE_DOWN\"] = 34] = \"PAGE_DOWN\";\n    Keys[Keys[\"END\"] = 35] = \"END\";\n    Keys[Keys[\"HOME\"] = 36] = \"HOME\";\n    Keys[Keys[\"LEFT\"] = 37] = \"LEFT\";\n    Keys[Keys[\"UP\"] = 38] = \"UP\";\n    Keys[Keys[\"RIGHT\"] = 39] = \"RIGHT\";\n    Keys[Keys[\"DOWN\"] = 40] = \"DOWN\";\n    Keys[Keys[\"PRINTSCREEN\"] = 44] = \"PRINTSCREEN\";\n    Keys[Keys[\"INSERT\"] = 45] = \"INSERT\";\n    Keys[Keys[\"DELETE\"] = 46] = \"DELETE\";\n    Keys[Keys[\"DIGIT_0\"] = 48] = \"DIGIT_0\";\n    Keys[Keys[\"DIGIT_1\"] = 49] = \"DIGIT_1\";\n    Keys[Keys[\"DIGIT_2\"] = 50] = \"DIGIT_2\";\n    Keys[Keys[\"DIGIT_3\"] = 51] = \"DIGIT_3\";\n    Keys[Keys[\"DIGIT_4\"] = 52] = \"DIGIT_4\";\n    Keys[Keys[\"DIGIT_5\"] = 53] = \"DIGIT_5\";\n    Keys[Keys[\"DIGIT_6\"] = 54] = \"DIGIT_6\";\n    Keys[Keys[\"DIGIT_7\"] = 55] = \"DIGIT_7\";\n    Keys[Keys[\"DIGIT_8\"] = 56] = \"DIGIT_8\";\n    Keys[Keys[\"DIGIT_9\"] = 57] = \"DIGIT_9\";\n    Keys[Keys[\"SEMICOLON\"] = 59] = \"SEMICOLON\";\n    Keys[Keys[\"EQUALS\"] = 61] = \"EQUALS\";\n    Keys[Keys[\"A\"] = 65] = \"A\";\n    Keys[Keys[\"B\"] = 66] = \"B\";\n    Keys[Keys[\"C\"] = 67] = \"C\";\n    Keys[Keys[\"D\"] = 68] = \"D\";\n    Keys[Keys[\"E\"] = 69] = \"E\";\n    Keys[Keys[\"F\"] = 70] = \"F\";\n    Keys[Keys[\"G\"] = 71] = \"G\";\n    Keys[Keys[\"H\"] = 72] = \"H\";\n    Keys[Keys[\"I\"] = 73] = \"I\";\n    Keys[Keys[\"J\"] = 74] = \"J\";\n    Keys[Keys[\"K\"] = 75] = \"K\";\n    Keys[Keys[\"L\"] = 76] = \"L\";\n    Keys[Keys[\"M\"] = 77] = \"M\";\n    Keys[Keys[\"N\"] = 78] = \"N\";\n    Keys[Keys[\"O\"] = 79] = \"O\";\n    Keys[Keys[\"P\"] = 80] = \"P\";\n    Keys[Keys[\"Q\"] = 81] = \"Q\";\n    Keys[Keys[\"R\"] = 82] = \"R\";\n    Keys[Keys[\"S\"] = 83] = \"S\";\n    Keys[Keys[\"T\"] = 84] = \"T\";\n    Keys[Keys[\"U\"] = 85] = \"U\";\n    Keys[Keys[\"V\"] = 86] = \"V\";\n    Keys[Keys[\"W\"] = 87] = \"W\";\n    Keys[Keys[\"X\"] = 88] = \"X\";\n    Keys[Keys[\"Y\"] = 89] = \"Y\";\n    Keys[Keys[\"Z\"] = 90] = \"Z\";\n    Keys[Keys[\"CONTEXT_MENU\"] = 93] = \"CONTEXT_MENU\";\n    Keys[Keys[\"NUMPAD0\"] = 96] = \"NUMPAD0\";\n    Keys[Keys[\"NUMPAD1\"] = 97] = \"NUMPAD1\";\n    Keys[Keys[\"NUMPAD2\"] = 98] = \"NUMPAD2\";\n    Keys[Keys[\"NUMPAD3\"] = 99] = \"NUMPAD3\";\n    Keys[Keys[\"NUMPAD4\"] = 100] = \"NUMPAD4\";\n    Keys[Keys[\"NUMPAD5\"] = 101] = \"NUMPAD5\";\n    Keys[Keys[\"NUMPAD6\"] = 102] = \"NUMPAD6\";\n    Keys[Keys[\"NUMPAD7\"] = 103] = \"NUMPAD7\";\n    Keys[Keys[\"NUMPAD8\"] = 104] = \"NUMPAD8\";\n    Keys[Keys[\"NUMPAD9\"] = 105] = \"NUMPAD9\";\n    Keys[Keys[\"MULTIPLY\"] = 106] = \"MULTIPLY\";\n    Keys[Keys[\"ADD\"] = 107] = \"ADD\";\n    Keys[Keys[\"SEPARATOR\"] = 108] = \"SEPARATOR\";\n    Keys[Keys[\"SUBTRACT\"] = 109] = \"SUBTRACT\";\n    Keys[Keys[\"DECIMAL\"] = 110] = \"DECIMAL\";\n    Keys[Keys[\"DIVIDE\"] = 111] = \"DIVIDE\";\n    Keys[Keys[\"F1\"] = 112] = \"F1\";\n    Keys[Keys[\"F2\"] = 113] = \"F2\";\n    Keys[Keys[\"F3\"] = 114] = \"F3\";\n    Keys[Keys[\"F4\"] = 115] = \"F4\";\n    Keys[Keys[\"F5\"] = 116] = \"F5\";\n    Keys[Keys[\"F6\"] = 117] = \"F6\";\n    Keys[Keys[\"F7\"] = 118] = \"F7\";\n    Keys[Keys[\"F8\"] = 119] = \"F8\";\n    Keys[Keys[\"F9\"] = 120] = \"F9\";\n    Keys[Keys[\"F10\"] = 121] = \"F10\";\n    Keys[Keys[\"F11\"] = 122] = \"F11\";\n    Keys[Keys[\"F12\"] = 123] = \"F12\";\n    Keys[Keys[\"F13\"] = 124] = \"F13\";\n    Keys[Keys[\"F14\"] = 125] = \"F14\";\n    Keys[Keys[\"F15\"] = 126] = \"F15\";\n    Keys[Keys[\"F16\"] = 127] = \"F16\";\n    Keys[Keys[\"F17\"] = 128] = \"F17\";\n    Keys[Keys[\"F18\"] = 129] = \"F18\";\n    Keys[Keys[\"F19\"] = 130] = \"F19\";\n    Keys[Keys[\"F20\"] = 131] = \"F20\";\n    Keys[Keys[\"F21\"] = 132] = \"F21\";\n    Keys[Keys[\"F22\"] = 133] = \"F22\";\n    Keys[Keys[\"F23\"] = 134] = \"F23\";\n    Keys[Keys[\"F24\"] = 135] = \"F24\";\n    Keys[Keys[\"NUM_LOCK\"] = 144] = \"NUM_LOCK\";\n    Keys[Keys[\"SCROLL_LOCK\"] = 145] = \"SCROLL_LOCK\";\n    Keys[Keys[\"COMMA\"] = 188] = \"COMMA\";\n    Keys[Keys[\"PERIOD\"] = 190] = \"PERIOD\";\n    Keys[Keys[\"SLASH\"] = 191] = \"SLASH\";\n    Keys[Keys[\"BACK_QUOTE\"] = 192] = \"BACK_QUOTE\";\n    Keys[Keys[\"OPEN_BRACKET\"] = 219] = \"OPEN_BRACKET\";\n    Keys[Keys[\"BACK_SLASH\"] = 220] = \"BACK_SLASH\";\n    Keys[Keys[\"CLOSE_BRACKET\"] = 221] = \"CLOSE_BRACKET\";\n    Keys[Keys[\"QUOTE\"] = 222] = \"QUOTE\";\n    Keys[Keys[\"META\"] = 224] = \"META\";\n})(Keys || (Keys = {}));\nexport function keyboard(opts, callback) {\n    const cb = callback || opts;\n    const { element = window } = opts;\n    const pressed = {};\n    function onKeydown(event) {\n        pressed[event.keyCode] = Date.now();\n        cb(pressed);\n    }\n    function onKeyup(event) {\n        delete pressed[event.keyCode];\n        cb(pressed);\n    }\n    element.addEventListener('keyup', onKeyup, false);\n    element.addEventListener('keydown', onKeydown, false);\n    cb(pressed);\n    return function stop() {\n        element.removeEventListener('keyup', onKeyup);\n        element.removeEventListener('keydown', onKeydown);\n    };\n}\nexport function keyboardObserver(opts) {\n    const observer = {\n        Keys,\n        state: { pressed: {} },\n        destroy: () => { },\n    };\n    function callback(pressed) {\n        observer.state.pressed = pressed;\n    }\n    observer.destroy = keyboard(callback, opts);\n    return observer;\n}\n//# sourceMappingURL=keyboard.js.map","import { baseEvents, getPainter } from '../../shared-utils/painterState'\n\nexport const canvas = document.getElementById('canvas') as HTMLCanvasElement\n\nexport const painter = getPainter(canvas)\n\nexport const gl = painter.gl\n\nexport const events = {\n\t...baseEvents,\n}\n\n\nif (module.hot) {module.hot.accept(function(err) {\nif (err) {\nconsole.error(err);\n}\n});\n}\n","export const isString = (x) => typeof x === \"string\";\n","let symID = 0;\n/**\n * Helper for deterministic code generation / testing. Resets sym ID\n * counter.\n */\nexport const resetSymID = () => (symID = 0);\n/**\n * Generates a new symbol name, e.g. `_sa2`. Uses base36 for counter to\n * keep names short.\n */\nexport const gensym = () => `_s${(symID++).toString(36)}`;\n","export const isArray = Array.isArray;\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","const OBJP = Object.getPrototypeOf;\n/**\n * Similar to {@link isObject}, but also checks if prototype is that of\n * `Object` (or `null`).\n *\n * @param x -\n */\nexport const isPlainObject = (x) => {\n    let p;\n    return (x != null &&\n        typeof x === \"object\" &&\n        ((p = OBJP(x)) === null || OBJP(p) === null));\n};\n","const OBJP = Object.getPrototypeOf({});\nconst FN = \"function\";\nconst STR = \"string\";\nexport const equiv = (a, b) => {\n    let proto;\n    if (a === b) {\n        return true;\n    }\n    if (a != null) {\n        if (typeof a.equiv === FN) {\n            return a.equiv(b);\n        }\n    }\n    else {\n        return a == b;\n    }\n    if (b != null) {\n        if (typeof b.equiv === FN) {\n            return b.equiv(a);\n        }\n    }\n    else {\n        return a == b;\n    }\n    if (typeof a === STR || typeof b === STR) {\n        return false;\n    }\n    if (((proto = Object.getPrototypeOf(a)), proto == null || proto === OBJP) &&\n        ((proto = Object.getPrototypeOf(b)), proto == null || proto === OBJP)) {\n        return equivObject(a, b);\n    }\n    if (typeof a !== FN &&\n        a.length !== undefined &&\n        typeof b !== FN &&\n        b.length !== undefined) {\n        return equivArrayLike(a, b);\n    }\n    if (a instanceof Set && b instanceof Set) {\n        return equivSet(a, b);\n    }\n    if (a instanceof Map && b instanceof Map) {\n        return equivMap(a, b);\n    }\n    if (a instanceof Date && b instanceof Date) {\n        return a.getTime() === b.getTime();\n    }\n    if (a instanceof RegExp && b instanceof RegExp) {\n        return a.toString() === b.toString();\n    }\n    // NaN\n    return a !== a && b !== b;\n};\nexport const equivArrayLike = (a, b, _equiv = equiv) => {\n    let l = a.length;\n    if (l === b.length) {\n        while (--l >= 0 && _equiv(a[l], b[l]))\n            ;\n    }\n    return l < 0;\n};\nexport const equivSet = (a, b, _equiv = equiv) => a.size === b.size && _equiv([...a.keys()].sort(), [...b.keys()].sort());\nexport const equivMap = (a, b, _equiv = equiv) => a.size === b.size && _equiv([...a].sort(), [...b].sort());\nexport const equivObject = (a, b, _equiv = equiv) => {\n    if (Object.keys(a).length !== Object.keys(b).length) {\n        return false;\n    }\n    for (let k in a) {\n        if (!b.hasOwnProperty(k) || !_equiv(a[k], b[k])) {\n            return false;\n        }\n    }\n    return true;\n};\n","export function dissoc(coll, keys) {\n    for (let k of keys) {\n        coll.delete(k);\n    }\n    return coll;\n}\nexport const dissocObj = (obj, keys) => {\n    for (let k of keys) {\n        delete obj[k];\n    }\n    return obj;\n};\n","/**\n * Reducer composition helper, internally used by various transducers\n * during initialization. Takes existing reducer `rfn` (a 3-tuple) and a\n * reducing function `fn`. Returns a new reducer tuple.\n *\n * @remarks\n * `rfn[2]` reduces values of type `B` into an accumulator of type `A`.\n * `fn` accepts values of type `C` and produces interim results of type\n * `B`, which are then (possibly) passed to the \"inner\" `rfn[2]`\n * function. Therefore the resulting reducer takes inputs of `C` and an\n * accumulator of type `A`.\n *\n * It is assumed that `fn` internally calls `rfn[2]` to pass its own\n * results for further processing by the nested reducer `rfn`.\n *\n * @example\n * ```ts\n * compR(rfn, fn)\n * // [rfn[0], rfn[1], fn]\n * ```\n *\n * @param rfn -\n * @param fn -\n */\nexport const compR = (rfn, fn) => [rfn[0], rfn[1], fn];\n","export const implementsFunction = (x, fn) => x != null && typeof x[fn] === \"function\";\n","import { implementsFunction } from \"@thi.ng/checks\";\nexport const ensureTransducer = (x) => implementsFunction(x, \"xform\")\n    ? x.xform()\n    : x;\n","export class Reduced {\n    constructor(val) {\n        this.value = val;\n    }\n    deref() {\n        return this.value;\n    }\n}\nexport const reduced = (x) => new Reduced(x);\nexport const isReduced = (x) => x instanceof Reduced;\nexport const ensureReduced = (x) => x instanceof Reduced ? x : new Reduced(x);\nexport const unreduced = (x) => (x instanceof Reduced ? x.deref() : x);\n","export const defError = (prefix, suffix = (msg) => (msg !== undefined ? \": \" + msg : \"\")) => class extends Error {\n    constructor(msg) {\n        super(prefix(msg) + suffix(msg));\n    }\n};\n","import { defError } from \"./deferror\";\nexport const IllegalArityError = defError(() => \"illegal arity\");\nexport const illegalArity = (n) => {\n    throw new IllegalArityError(n);\n};\n","import { implementsFunction, isArrayLike, isIterable } from \"@thi.ng/checks\";\nimport { illegalArity } from \"@thi.ng/errors\";\nimport { isReduced, unreduced } from \"./reduced\";\nconst parseArgs = (args) => args.length === 2\n    ? [undefined, args[1]]\n    : args.length === 3\n        ? [args[1], args[2]]\n        : illegalArity(args.length);\nexport function reduce(...args) {\n    const rfn = args[0];\n    const init = rfn[0];\n    const complete = rfn[1];\n    const reduce = rfn[2];\n    args = parseArgs(args);\n    const acc = args[0] == null ? init() : args[0];\n    const xs = args[1];\n    return unreduced(complete(implementsFunction(xs, \"$reduce\")\n        ? xs.$reduce(reduce, acc)\n        : isArrayLike(xs)\n            ? reduceArray(reduce, acc, xs)\n            : reduceIterable(reduce, acc, xs)));\n}\nconst reduceArray = (rfn, acc, xs) => {\n    for (let i = 0, n = xs.length; i < n; i++) {\n        acc = rfn(acc, xs[i]);\n        if (isReduced(acc)) {\n            acc = acc.deref();\n            break;\n        }\n    }\n    return acc;\n};\nconst reduceIterable = (rfn, acc, xs) => {\n    for (let x of xs) {\n        acc = rfn(acc, x);\n        if (isReduced(acc)) {\n            acc = acc.deref();\n            break;\n        }\n    }\n    return acc;\n};\n/**\n * Convenience helper for building a full {@link Reducer} using the identity\n * function (i.e. `(x) => x`) as completion step (true for 90% of all\n * bundled transducers).\n *\n * @param init - init step of reducer\n * @param rfn - reduction step of reducer\n */\nexport const reducer = (init, rfn) => [init, (acc) => acc, rfn];\nexport const $$reduce = (rfn, args) => {\n    const n = args.length - 1;\n    return isIterable(args[n])\n        ? args.length > 1\n            ? reduce(rfn.apply(null, args.slice(0, n)), args[n])\n            : reduce(rfn(), args[0])\n        : undefined;\n};\n","export const isArrayLike = (x) => x != null && typeof x !== \"function\" && x.length !== undefined;\n","import { NO_OP, SEMAPHORE } from \"@thi.ng/api\";\nimport { isIterable } from \"@thi.ng/checks\";\nimport { ensureTransducer } from \"./internal/ensure\";\nimport { isReduced, unreduced } from \"./reduced\";\nimport { push } from \"./rfn/push\";\n/**\n * Takes a transducer and input iterable. Returns iterator of\n * transformed results.\n *\n * @param xform -\n * @param xs -\n */\nexport function* iterator(xform, xs) {\n    const rfn = ensureTransducer(xform)(push());\n    const complete = rfn[1];\n    const reduce = rfn[2];\n    for (let x of xs) {\n        const y = reduce([], x);\n        if (isReduced(y)) {\n            yield* unreduced(complete(y.deref()));\n            return;\n        }\n        if (y.length) {\n            yield* y;\n        }\n    }\n    yield* unreduced(complete([]));\n}\n/**\n * Optimized version of {@link iterator} for transducers which are\n * guaranteed to:\n *\n * 1) Only produce none or a single result per input\n * 2) Do not require a `completion` reduction step\n *\n * @param xform -\n * @param xs -\n */\nexport function* iterator1(xform, xs) {\n    const reduce = (ensureTransducer(xform)([NO_OP, NO_OP, (_, x) => x]))[2];\n    for (let x of xs) {\n        let y = reduce(SEMAPHORE, x);\n        if (isReduced(y)) {\n            y = unreduced(y.deref());\n            if (y !== SEMAPHORE) {\n                yield y;\n            }\n            return;\n        }\n        if (y !== SEMAPHORE) {\n            yield y;\n        }\n    }\n}\n/**\n * Helper function used by various transducers to wrap themselves as\n * transforming iterators. Delegates to {@link iterator1} by default.\n *\n * @param xform -\n * @param args -\n * @param impl -\n *\n * @internal\n */\nexport const $iter = (xform, args, impl = iterator1) => {\n    const n = args.length - 1;\n    return isIterable(args[n])\n        ? args.length > 1\n            ? impl(xform.apply(null, args.slice(0, n)), args[n])\n            : impl(xform(), args[0])\n        : undefined;\n};\n","import { compR } from \"../func/compr\";\nimport { iterator1 } from \"../iterator\";\nexport function map(fn, src) {\n    return src\n        ? iterator1(map(fn), src)\n        : (rfn) => {\n            const r = rfn[2];\n            return compR(rfn, (acc, x) => r(acc, fn(x)));\n        };\n}\n","import { mixin } from \"@thi.ng/api\";\nimport { isNode } from \"@thi.ng/checks\";\nimport { map } from \"@thi.ng/transducers\";\nconst inspect = isNode() ? require(\"util\").inspect : null;\nconst inspectSet = (coll, opts) => [...map((x) => inspect(x, opts), coll)].join(\", \");\nconst inspectMap = (coll, opts) => [\n    ...map(([k, v]) => `${inspect(k, opts)} => ${inspect(v, opts)}`, coll),\n].join(\", \");\n/**\n * NodeJS inspection mixin\n *\n * @remarks\n * Reference:\n * https://nodejs.org/api/util.html#util_custom_inspection_functions_on_objects\n *\n * @internal\n */\nexport const inspectable = mixin({\n    [Symbol.for(\"nodejs.util.inspect.custom\")](depth, opts) {\n        const name = this[Symbol.toStringTag];\n        const childOpts = Object.assign(Object.assign({}, opts), { depth: opts.depth === null ? null : opts.depth - 1 });\n        return depth >= 0\n            ? [\n                `${name}(${this.size || 0}) {`,\n                inspect\n                    ? this instanceof Set\n                        ? inspectSet(this, childOpts)\n                        : this instanceof Map\n                            ? inspectMap(this, childOpts)\n                            : \"\"\n                    : \"\",\n                \"}\",\n            ].join(\" \")\n            : opts.stylize(`[${name}]`, \"special\");\n    },\n});\n","/**\n * Class behavior mixin based on:\n * {@link http://raganwald.com/2015/06/26/decorators-in-es7.html}\n *\n * Additionally only injects/overwrites properties in target, which are\n * NOT marked with `@nomixin` (i.e. haven't set their `configurable`\n * property descriptor flag to `false`)\n *\n * @param behaviour - to mixin\n * @param sharedBehaviour -\n * @returns decorator function\n */\nexport const mixin = (behaviour, sharedBehaviour = {}) => {\n    const instanceKeys = Reflect.ownKeys(behaviour);\n    const sharedKeys = Reflect.ownKeys(sharedBehaviour);\n    const typeTag = Symbol(\"isa\");\n    function _mixin(clazz) {\n        for (let key of instanceKeys) {\n            const existing = Object.getOwnPropertyDescriptor(clazz.prototype, key);\n            if (!existing || existing.configurable) {\n                Object.defineProperty(clazz.prototype, key, {\n                    value: behaviour[key],\n                    writable: true\n                });\n            }\n            else {\n                console.log(`not patching: ${clazz.name}.${key.toString()}`);\n            }\n        }\n        Object.defineProperty(clazz.prototype, typeTag, { value: true });\n        return clazz;\n    }\n    for (let key of sharedKeys) {\n        Object.defineProperty(_mixin, key, {\n            value: sharedBehaviour[key],\n            enumerable: sharedBehaviour.propertyIsEnumerable(key)\n        });\n    }\n    Object.defineProperty(_mixin, Symbol.hasInstance, {\n        value: (x) => !!x[typeTag]\n    });\n    return _mixin;\n};\n","export const isMap = (x) => x instanceof Map;\n","import { isMap } from \"@thi.ng/checks\";\nexport function into(dest, src) {\n    if (isMap(dest)) {\n        for (let x of src) {\n            dest.set(x[0], x[1]);\n        }\n    }\n    else {\n        for (let x of src) {\n            dest.add(x);\n        }\n    }\n    return dest;\n}\n","var ArraySet_1;\nimport { __decorate } from \"tslib\";\nimport { SEMAPHORE } from \"@thi.ng/api\";\nimport { equiv } from \"@thi.ng/equiv\";\nimport { dissoc } from \"./dissoc\";\nimport { equivSet } from \"./internal/equiv\";\nimport { inspectable } from \"./internal/inspect\";\nimport { into } from \"./into\";\nconst __private = new WeakMap();\nconst __vals = (inst) => __private.get(inst).vals;\n/**\n * An alternative set implementation to the native ES6 Set type. Uses\n * customizable equality/equivalence predicate and so is more useful\n * when dealing with structured data. Implements full API of native Set\n * and by the default uses {@link @thi.ng/equiv#equiv} for equivalence\n * checking.\n *\n * Additionally, the type also implements the {@link @thi.ng/api#ICopy},\n * {@link @thi.ng/api#IEmpty} and {@link @thi.ng/api#IEquiv} interfaces\n * itself.\n */\nlet ArraySet = ArraySet_1 = class ArraySet extends Set {\n    constructor(vals, opts = {}) {\n        super();\n        __private.set(this, { equiv: opts.equiv || equiv, vals: [] });\n        vals && this.into(vals);\n    }\n    *[Symbol.iterator]() {\n        yield* __vals(this);\n    }\n    get [Symbol.species]() {\n        return ArraySet_1;\n    }\n    get [Symbol.toStringTag]() {\n        return \"ArraySet\";\n    }\n    get size() {\n        return __vals(this).length;\n    }\n    copy() {\n        const $this = __private.get(this);\n        const s = new ArraySet_1(null, { equiv: $this.equiv });\n        __private.get(s).vals = $this.vals.slice();\n        return s;\n    }\n    empty() {\n        return new ArraySet_1(null, this.opts());\n    }\n    clear() {\n        __vals(this).length = 0;\n    }\n    first() {\n        if (this.size) {\n            return __vals(this)[0];\n        }\n    }\n    add(key) {\n        !this.has(key) && __vals(this).push(key);\n        return this;\n    }\n    into(keys) {\n        return into(this, keys);\n    }\n    has(key) {\n        return this.get(key, SEMAPHORE) !== SEMAPHORE;\n    }\n    /**\n     * Returns the canonical value for `x`, if present. If the set\n     * contains no equivalent for `x`, returns `notFound`.\n     *\n     * @param key - search key\n     * @param notFound - default value\n     */\n    get(key, notFound) {\n        const $this = __private.get(this);\n        const eq = $this.equiv;\n        const vals = $this.vals;\n        for (let i = vals.length; --i >= 0;) {\n            if (eq(vals[i], key)) {\n                return vals[i];\n            }\n        }\n        return notFound;\n    }\n    delete(key) {\n        const $this = __private.get(this);\n        const eq = $this.equiv;\n        const vals = $this.vals;\n        for (let i = vals.length; --i >= 0;) {\n            if (eq(vals[i], key)) {\n                vals.splice(i, 1);\n                return true;\n            }\n        }\n        return false;\n    }\n    disj(keys) {\n        return dissoc(this, keys);\n    }\n    equiv(o) {\n        return equivSet(this, o);\n    }\n    forEach(fn, thisArg) {\n        const vals = __vals(this);\n        for (let i = vals.length; --i >= 0;) {\n            const v = vals[i];\n            fn.call(thisArg, v, v, this);\n        }\n    }\n    *entries() {\n        for (let v of __vals(this)) {\n            yield [v, v];\n        }\n    }\n    *keys() {\n        yield* __vals(this);\n    }\n    *values() {\n        yield* __vals(this);\n    }\n    opts() {\n        return { equiv: __private.get(this).equiv };\n    }\n};\nArraySet = ArraySet_1 = __decorate([\n    inspectable\n], ArraySet);\nexport { ArraySet };\nexport const defArraySet = (vals, opts) => new ArraySet(vals, opts);\n","import { equiv } from \"@thi.ng/equiv\";\nexport const equivMap = (a, b) => {\n    if (a === b) {\n        return true;\n    }\n    if (!(b instanceof Map) || a.size !== b.size) {\n        return false;\n    }\n    for (let p of a.entries()) {\n        if (!equiv(b.get(p[0]), p[1])) {\n            return false;\n        }\n    }\n    return true;\n};\nexport const equivSet = (a, b) => {\n    if (a === b) {\n        return true;\n    }\n    if (!(b instanceof Set) || a.size !== b.size) {\n        return false;\n    }\n    for (let k of a.keys()) {\n        if (!b.has(k)) {\n            return false;\n        }\n    }\n    return true;\n};\n","var EquivMap_1;\nimport { __decorate } from \"tslib\";\nimport { SEMAPHORE } from \"@thi.ng/api\";\nimport { isPlainObject } from \"@thi.ng/checks\";\nimport { equiv } from \"@thi.ng/equiv\";\nimport { pairs } from \"@thi.ng/transducers\";\nimport { ArraySet } from \"./array-set\";\nimport { dissoc } from \"./dissoc\";\nimport { equivMap } from \"./internal/equiv\";\nimport { inspectable } from \"./internal/inspect\";\nimport { into } from \"./into\";\nconst __private = new WeakMap();\nconst __map = (map) => __private.get(map).map;\nlet EquivMap = EquivMap_1 = class EquivMap extends Map {\n    /**\n     * Creates a new instance with optional initial key-value pairs and\n     * provided options. If no `opts` are given, uses `ArraySet` for\n     * storing canonical keys and {@link @thi.ng/equiv#equiv} for\n     * checking key equivalence.\n     *\n     * @param pairs - key-value pairs\n     * @param opts - config options\n     */\n    constructor(pairs, opts) {\n        super();\n        const _opts = Object.assign({ equiv, keys: ArraySet }, opts);\n        __private.set(this, {\n            keys: new _opts.keys(null, { equiv: _opts.equiv }),\n            map: new Map(),\n            opts: _opts,\n        });\n        if (pairs) {\n            this.into(pairs);\n        }\n    }\n    [Symbol.iterator]() {\n        return this.entries();\n    }\n    get [Symbol.species]() {\n        return EquivMap_1;\n    }\n    get [Symbol.toStringTag]() {\n        return \"EquivMap\";\n    }\n    get size() {\n        return __private.get(this).keys.size;\n    }\n    clear() {\n        const $this = __private.get(this);\n        $this.keys.clear();\n        $this.map.clear();\n    }\n    empty() {\n        return new EquivMap_1(null, __private.get(this).opts);\n    }\n    copy() {\n        const $this = __private.get(this);\n        const m = new EquivMap_1();\n        __private.set(m, {\n            keys: $this.keys.copy(),\n            map: new Map($this.map),\n            opts: $this.opts,\n        });\n        return m;\n    }\n    equiv(o) {\n        return equivMap(this, o);\n    }\n    delete(key) {\n        const $this = __private.get(this);\n        key = $this.keys.get(key, SEMAPHORE);\n        if (key !== SEMAPHORE) {\n            $this.map.delete(key);\n            $this.keys.delete(key);\n            return true;\n        }\n        return false;\n    }\n    dissoc(keys) {\n        return dissoc(this, keys);\n    }\n    forEach(fn, thisArg) {\n        for (let pair of __map(this)) {\n            fn.call(thisArg, pair[1], pair[0], this);\n        }\n    }\n    get(key, notFound) {\n        const $this = __private.get(this);\n        key = $this.keys.get(key, SEMAPHORE);\n        if (key !== SEMAPHORE) {\n            return $this.map.get(key);\n        }\n        return notFound;\n    }\n    has(key) {\n        return __private.get(this).keys.has(key);\n    }\n    set(key, value) {\n        const $this = __private.get(this);\n        const k = $this.keys.get(key, SEMAPHORE);\n        if (k !== SEMAPHORE) {\n            $this.map.set(k, value);\n        }\n        else {\n            $this.keys.add(key);\n            $this.map.set(key, value);\n        }\n        return this;\n    }\n    into(pairs) {\n        return into(this, pairs);\n    }\n    entries() {\n        return __map(this).entries();\n    }\n    keys() {\n        return __map(this).keys();\n    }\n    values() {\n        return __map(this).values();\n    }\n    opts() {\n        return __private.get(this).opts;\n    }\n};\nEquivMap = EquivMap_1 = __decorate([\n    inspectable\n], EquivMap);\nexport { EquivMap };\nexport function defEquivMap(src, opts) {\n    return new EquivMap(isPlainObject(src) ? pairs(src) : src, opts);\n}\n","export const isSet = (x) => x instanceof Set;\n","import { xformSetOp } from \"./internal/xform-setop\";\nimport { into } from \"./into\";\nimport { copy } from \"./utils\";\n/**\n * Computes union of sets `a` and `b` and writes results to new set or\n * optionally given set `out` (assumed to be empty for correct results).\n *\n * @param a - first set\n * @param b - other set\n * @param out - result set\n */\nexport const union = (a, b, out) => {\n    if (a.size < b.size) {\n        const t = a;\n        a = b;\n        b = t;\n    }\n    out = out ? into(out, a) : copy(a, Set);\n    return a === b ? out : into(out, b);\n};\nexport function unionR(src) {\n    return xformSetOp(unionR, union, src);\n}\n","import { implementsFunction, isMap, isSet } from \"@thi.ng/checks\";\nexport const empty = (x, ctor) => implementsFunction(x, \"empty\")\n    ? x.empty()\n    : new (x[Symbol.species] || ctor)();\nexport const copy = (x, ctor) => implementsFunction(x, \"copy\")\n    ? x.copy()\n    : new (x[Symbol.species] || ctor)(x);\nexport const first = (x) => x[Symbol.iterator]().next().value;\nexport const objValues = (src) => {\n    const vals = [];\n    for (let k in src) {\n        src.hasOwnProperty(k) && vals.push(src[k]);\n    }\n    return vals;\n};\nexport const ensureMap = (x) => isMap(x) ? x : new Map(x);\nexport const ensureSet = (x) => isSet(x) ? x : new Set(x);\n","import { defError } from \"./deferror\";\nexport const IllegalArgumentError = defError(() => \"illegal argument(s)\");\nexport const illegalArgs = (msg) => {\n    throw new IllegalArgumentError(msg);\n};\n","import { compR } from \"../func/compr\";\nimport { iterator1 } from \"../iterator\";\nexport function filter(pred, src) {\n    return src\n        ? iterator1(filter(pred), src)\n        : (rfn) => {\n            const r = rfn[2];\n            return compR(rfn, (acc, x) => (pred(x) ? r(acc, x) : acc));\n        };\n}\n","import { ArraySet, EquivMap, union } from \"@thi.ng/associative\";\nimport { equiv } from \"@thi.ng/equiv\";\nimport { illegalArgs } from \"@thi.ng/errors\";\nimport { filter, reduce, reducer } from \"@thi.ng/transducers\";\nexport const defDGraph = (edges) => new DGraph(edges);\nexport class DGraph {\n    constructor(edges) {\n        this.dependencies = new EquivMap();\n        this.dependents = new EquivMap();\n        if (edges) {\n            for (let [a, b] of edges) {\n                this.addDependency(a, b);\n            }\n        }\n    }\n    *[Symbol.iterator]() {\n        yield* this.sort();\n    }\n    get [Symbol.species]() {\n        return DGraph;\n    }\n    copy() {\n        const g = new DGraph();\n        for (let e of this.dependencies) {\n            g.dependencies.set(e[0], e[1].copy());\n        }\n        for (let e of this.dependents) {\n            g.dependents.set(e[0], e[1].copy());\n        }\n        return g;\n    }\n    addNode(node) {\n        !this.dependencies.has(node) &&\n            this.dependencies.set(node, new ArraySet());\n        return this;\n    }\n    addDependency(node, dep) {\n        if (equiv(node, dep) || this.depends(dep, node)) {\n            illegalArgs(`Circular dependency between: ${node} & ${dep}`);\n        }\n        let deps = this.dependencies.get(node);\n        this.dependencies.set(node, deps ? deps.add(dep) : new ArraySet([dep]));\n        deps = this.dependents.get(dep);\n        this.dependents.set(dep, deps ? deps.add(node) : new ArraySet([node]));\n        return this;\n    }\n    addDependencies(node, deps) {\n        for (let d of deps) {\n            this.addDependency(node, d);\n        }\n    }\n    removeEdge(node, dep) {\n        let deps = this.dependencies.get(node);\n        if (deps) {\n            deps.delete(dep);\n        }\n        deps = this.dependents.get(dep);\n        if (deps) {\n            deps.delete(node);\n        }\n        return this;\n    }\n    removeNode(x) {\n        this.dependencies.delete(x);\n        return this;\n    }\n    depends(x, y) {\n        return this.transitiveDependencies(x).has(y);\n    }\n    dependent(x, y) {\n        return this.transitiveDependents(x).has(y);\n    }\n    immediateDependencies(x) {\n        return this.dependencies.get(x) || new ArraySet();\n    }\n    immediateDependents(x) {\n        return this.dependents.get(x) || new ArraySet();\n    }\n    isLeaf(x) {\n        return this.immediateDependents(x).size === 0;\n    }\n    isRoot(x) {\n        return this.immediateDependencies(x).size === 0;\n    }\n    nodes() {\n        return union(new ArraySet(this.dependencies.keys()), new ArraySet(this.dependents.keys()));\n    }\n    leaves() {\n        return filter((node) => this.isLeaf(node), this.nodes());\n    }\n    roots() {\n        return filter((node) => this.isRoot(node), this.nodes());\n    }\n    transitiveDependencies(x) {\n        return transitive(this.dependencies, x);\n    }\n    transitiveDependents(x) {\n        return transitive(this.dependents, x);\n    }\n    sort() {\n        const sorted = [];\n        const g = this.copy();\n        let queue = new ArraySet(g.leaves());\n        while (true) {\n            if (!queue.size) {\n                return sorted.reverse();\n            }\n            const node = queue.first();\n            queue.delete(node);\n            for (let d of [...g.immediateDependencies(node)]) {\n                g.removeEdge(node, d);\n                if (g.isLeaf(d)) {\n                    queue.add(d);\n                }\n            }\n            sorted.push(node);\n            g.removeNode(node);\n        }\n    }\n}\nconst transitive = (nodes, x) => {\n    const deps = nodes.get(x);\n    if (deps) {\n        return reduce(reducer(null, (acc, k) => union(acc, transitive(nodes, k))), deps, deps);\n    }\n    return new ArraySet();\n};\n","const RE_VEC = /^[iub]?vec[234]$/;\nconst RE_MAT = /^mat[234]$/;\n/**\n * Returns true, if given term evaluates to a boolean value.\n */\nexport const isBool = (t) => t.type === \"bool\";\n/**\n * Returns true, if given term evaluates to a float value.\n */\nexport const isFloat = (t) => t.type === \"float\";\n/**\n * Returns true, if given term evaluates to a signed integer value.\n */\nexport const isInt = (t) => t.type === \"int\";\n/**\n * Returns true, if given term evaluates to an unsigned integer value.\n */\nexport const isUint = (t) => t.type === \"uint\";\n/**\n * Returns true, if given term is a literal.\n */\nexport const isLit = (t) => t.tag === \"lit\";\n/**\n * Returns true, if given term is a float literal.\n */\nexport const isLitFloat = (t) => isLit(t) && isFloat(t);\n/**\n * Returns true, if given term is a signed integer literal.\n */\nexport const isLitInt = (t) => isLit(t) && isInt(t);\n/**\n * Returns true, if given term is a numeric literal (float, int, uint).\n */\nexport const isLitNumeric = (t) => isLit(t) && (isFloat(t) || isInt(t) || isUint(t));\n/**\n * Returns true, if given term evaluates to a vector value (vec, ivec, bvec).\n */\nexport const isVec = (t) => RE_VEC.test(t.type);\n/**\n * Returns true, if given term evaluates to a matrix value.\n */\nexport const isMat = (t) => RE_MAT.test(t.type);\n","import { isArray } from \"@thi.ng/checks\";\nimport { DGraph } from \"@thi.ng/dgraph\";\nimport { isMat, isVec } from \"./checks\";\n/**\n * Helper function for {@link walk}. Returns child nodes for any control\n * flow nodes containing a child scope.\n *\n * {@link allChildren}\n */\nexport const scopedChildren = (t) => t.tag === \"fn\" || t.tag === \"for\" || t.tag == \"while\"\n    ? t.scope.body\n    : t.tag === \"if\"\n        ? t.f\n            ? t.t.body.concat(t.f.body)\n            : t.t.body\n        : undefined;\n/**\n * Helper function for {@link walk}. Returns an array of all child nodes for\n * a given term (if any).\n *\n * {@link scopedChildren}\n */\nexport const allChildren = (t) => scopedChildren(t) ||\n    (t.tag === \"scope\"\n        ? t.body\n        : t.tag === \"ternary\"\n            ? [t.t, t.f]\n            : t.tag === \"ret\"\n                ? [t.val]\n                : t.tag === \"call\" || t.tag === \"call_i\"\n                    ? t.args\n                    : t.tag === \"sym\" && t.init\n                        ? [t.init]\n                        : t.tag === \"decl\"\n                            ? [t.id]\n                            : t.tag === \"op1\" || t.tag === \"swizzle\"\n                                ? [t.val]\n                                : t.tag === \"op2\"\n                                    ? [t.l, t.r]\n                                    : t.tag === \"assign\"\n                                        ? [t.r]\n                                        : isVec(t) || isMat(t)\n                                            ? t.val\n                                            : undefined);\n/**\n * Traverses given AST in depth-first order and applies `visit` and\n * `children` fns to each node. Descends only further if `children`\n * returns an array of child nodes. The `visit` function must accept 2\n * args: the accumulator (`acc`) given to {@link walk} and a tree node. The\n * return value of `visit` becomes the new `acc` value, much like in a\n * reduce operation. {@link walk} itself returns the final `acc`.\n *\n * If `pre` is true (default), the `visit` function will be called prior\n * to visiting a node's children. If false, the visitor is called on the\n * way back up.\n *\n * @param visit -\n * @param children -\n * @param acc -\n * @param tree -\n * @param pre -\n */\nexport const walk = (visit, children, acc, tree, pre = true) => {\n    if (isArray(tree)) {\n        tree.forEach((x) => (acc = walk(visit, children, acc, x, pre)));\n    }\n    else {\n        pre && (acc = visit(acc, tree));\n        const c = children(tree);\n        c && (acc = walk(visit, children, acc, c, pre));\n        !pre && (acc = visit(acc, tree));\n    }\n    return acc;\n};\n/**\n * Builds dependency graph of given function, by recursively adding all\n * function dependencies. Returns graph.\n *\n * @param fn -\n * @param graph -\n */\nexport const buildCallGraph = (fn, graph = new DGraph()) => fn.deps && fn.deps.length\n    ? fn.deps.reduce((graph, d) => buildCallGraph(d, graph.addDependency(fn, d)), graph)\n    : graph.addNode(fn);\nexport const decl = (id) => ({\n    tag: \"decl\",\n    type: id.type,\n    id\n});\n/**\n * Wraps the given AST node array in `scope` node, optionally as global\n * scope (default false). The interpretation of the global flag is\n * dependent on the target code gen. I.e. for GLSL / JS, the flag\n * disables wrapping the scope's body in `{}`, but else has no\n * difference. In general this node type only serves as internal\n * mechanism for various control flow AST nodes and should not need to\n * be used directly from user land code (though might be useful to\n * create custom / higher level control flow nodes).\n *\n * @param body -\n * @param global -\n */\nexport const scope = (body, global = false) => ({\n    tag: \"scope\",\n    type: \"void\",\n    body: (body\n        .filter((x) => x != null)\n        .map((x) => (x.tag === \"sym\" ? decl(x) : x))),\n    global\n});\n/**\n * Takes an array of global sym/var definitions ({@link input},\n * {@link output}, {@link uniform}) and functions defined via\n * {@link (defn:1)}. Constructs the call graph of all transitively used\n * functions and bundles everything in topological order within a global\n * scope object, which is then returned to the user and can be passed to\n * a target codegen for full program output.\n *\n * - {@link scope}\n * - {@link input}\n * - {@link output}\n * - {@link uniform}\n *\n * @param body -\n */\nexport const program = (body) => {\n    const syms = body.filter((x) => x.tag !== \"fn\");\n    const g = body.reduce((acc, x) => (x.tag === \"fn\" ? buildCallGraph(x, acc) : acc), new DGraph());\n    return scope(syms.concat(g.sort()), true);\n};\n","import { assert } from \"@thi.ng/api\";\nimport { isString } from \"@thi.ng/checks\";\nimport { illegalArgs } from \"@thi.ng/errors\";\nimport { gensym } from \"./idgen\";\nexport function sym(type, ...xs) {\n    let id;\n    let opts;\n    let init;\n    switch (xs.length) {\n        case 0:\n            if (!isString(type)) {\n                init = type;\n                type = init.type;\n            }\n            break;\n        case 1:\n            if (isString(xs[0])) {\n                id = xs[0];\n            }\n            else if (xs[0].tag) {\n                init = xs[0];\n            }\n            else {\n                opts = xs[0];\n            }\n            break;\n        case 2:\n            if (isString(xs[0])) {\n                [id, opts] = xs;\n            }\n            else {\n                [opts, init] = xs;\n            }\n            break;\n        case 3:\n            [id, opts, init] = xs;\n            break;\n        default:\n            illegalArgs();\n    }\n    return {\n        tag: \"sym\",\n        type,\n        id: id || gensym(),\n        opts: opts || {},\n        init: init\n    };\n}\nexport const constSym = (type, id, opts, init) => sym(type, id || gensym(), Object.assign({ const: true }, opts), init);\n/**\n * Defines a new symbol with optional initial array values.\n *\n * Important: Array initializers are UNSUPPORTED in GLSL ES v1 (WebGL),\n * any code using such initializers will only work under WebGL2 or other\n * targets.\n */\nexport const arraySym = (type, id, opts = {}, init) => {\n    if (init && opts.num == null) {\n        opts.num = init.length;\n    }\n    assert(opts.num != null, \"missing array length\");\n    init &&\n        assert(opts.num === init.length, `expected ${opts.num} items in array, but got ${init.length}`);\n    const atype = (type + \"[]\");\n    return {\n        tag: \"sym\",\n        type: atype,\n        id: id || gensym(),\n        opts,\n        init: init\n            ? {\n                tag: \"array_init\",\n                type: atype,\n                init\n            }\n            : undefined\n    };\n};\nexport const input = (type, id, opts) => sym(type, id, Object.assign({ q: \"in\", type: \"in\" }, opts));\nexport const output = (type, id, opts) => sym(type, id, Object.assign({ q: \"out\", type: \"out\" }, opts));\nexport const uniform = (type, id, opts) => sym(type, id, Object.assign({ q: \"in\", type: \"uni\" }, opts));\n","import { assert } from \"@thi.ng/api\";\nimport { isString } from \"@thi.ng/checks\";\nimport { gensym } from \"./idgen\";\nimport { allChildren, scope, scopedChildren, walk } from \"./scope\";\nimport { sym } from \"./sym\";\nconst defArg = (a) => {\n    const [type, id, opts] = isString(a) ? [a] : a;\n    return {\n        tag: \"arg\",\n        type,\n        id: id || gensym(),\n        opts: Object.assign({ q: \"in\" }, opts)\n    };\n};\n// prettier-ignore\nexport function defn(type, id, _args, _body) {\n    const args = _args.map(defArg);\n    const body = (_body(...args.map((x) => sym(x.type, x.id, x.opts))).filter((x) => x != null));\n    // count & check returns\n    const returns = walk((n, t) => {\n        if (t.tag === \"ret\") {\n            assert(t.type === type, `wrong return type for function '${id}', expected ${type}, got ${t.type}`);\n            n++;\n        }\n        return n;\n    }, scopedChildren, 0, body);\n    if (type !== \"void\" && !returns) {\n        throw new Error(`function '${id}' must return a value of type ${type}`);\n    }\n    // verify all non-builtin functions called are also\n    // provided as deps to ensure complete call graph later\n    const deps = walk((acc, t) => {\n        if (t.tag === \"call\" && t.fn) {\n            acc.push(t.fn);\n        }\n        return acc;\n    }, allChildren, [], body);\n    const $ = (...xs) => funcall($, ...xs);\n    return Object.assign($, {\n        tag: \"fn\",\n        type,\n        id,\n        args,\n        deps,\n        scope: scope(body)\n    });\n}\n/**\n * Syntax sugar for defining `void main()` functions.\n *\n * @param body -\n */\nexport const defMain = (body) => defn(\"void\", \"main\", [], body);\nexport function ret(val) {\n    return {\n        tag: \"ret\",\n        type: val ? val.type : \"void\",\n        val\n    };\n}\n// prettier-ignore\nexport function funcall(fn, ...args) {\n    return isString(fn)\n        ? {\n            tag: \"call\",\n            type: args[0],\n            id: fn,\n            args: args.slice(1)\n        }\n        : {\n            tag: \"call\",\n            type: fn.type,\n            id: fn.id,\n            args,\n            fn\n        };\n}\nexport const builtinCall = (id, type, ...args) => ({\n    tag: \"call_i\",\n    type,\n    id,\n    args\n});\n","export const isNumber = (x) => typeof x === \"number\";\n","export const isBoolean = (x) => typeof x === \"boolean\";\n","import { isBoolean, isNumber } from \"@thi.ng/checks\";\nimport { isVec } from \"./checks\";\nexport const lit = (type, val, info) => ({\n    tag: \"lit\",\n    type,\n    info,\n    val\n});\nexport const bool = (x) => lit(\"bool\", isNumber(x) ? !!x : x);\nexport const float = (x) => lit(\"float\", isBoolean(x) ? x & 1 : x);\nexport const int = (x) => lit(\"int\", isBoolean(x) ? x & 1 : isNumber(x) ? x | 0 : x);\nexport const uint = (x) => lit(\"uint\", isBoolean(x) ? x & 1 : isNumber(x) ? x >>> 0 : x);\nconst wrap = (type, ctor) => (x) => isNumber(x)\n    ? ctor(x)\n    : x !== undefined && !isVec(x) && x.type !== type\n        ? ctor(x)\n        : x;\n/**\n * Takes a plain number or numeric term and wraps it as float literal if\n * needed.\n *\n * @param x -\n */\nexport const wrapFloat = wrap(\"float\", float);\n/**\n * Takes a plain number or numeric term and wraps it as signed integer\n * literal if needed.\n *\n * @param x -\n */\nexport const wrapInt = wrap(\"int\", int);\n/**\n * Takes a plain number or numeric term and wraps it as unsigned integer\n * literal if needed.\n *\n * @param x -\n */\nexport const wrapUint = wrap(\"uint\", uint);\n/**\n * Takes a plain number or numeric term and wraps it as boolean literal\n * if needed.\n *\n * @param x -\n */\nexport const wrapBool = wrap(\"bool\", bool);\nexport const TRUE = lit(\"bool\", true);\nexport const FALSE = lit(\"bool\", false);\nexport const FLOAT0 = float(0);\nexport const FLOAT1 = float(1);\nexport const FLOAT2 = float(2);\nexport const FLOAT05 = float(0.5);\nexport const INT0 = int(0);\nexport const INT1 = int(1);\nexport const UINT0 = uint(0);\nexport const UINT1 = uint(1);\nexport const PI = float(Math.PI);\nexport const TAU = float(Math.PI * 2);\nexport const HALF_PI = float(Math.PI / 2);\nexport const SQRT2 = float(Math.SQRT2);\nconst $gvec = (wrap, init) => (xs) => [xs[0] === undefined ? init : wrap(xs[0]), ...xs.slice(1).map(wrap)];\nconst $vec = $gvec(wrapFloat, FLOAT0);\nconst $ivec = $gvec(wrapInt, INT0);\nconst $uvec = $gvec(wrapUint, UINT0);\nconst $bvec = $gvec(wrapBool, FALSE);\nconst $gvec2 = (type, ctor, xs) => lit(type, (xs = ctor(xs)), [\"n\", \"n\"][xs.length]);\nconst $gvec3 = (type, ctor, xs) => lit(type, (xs = ctor(xs)), [\"n\", \"n\", \"vn\"][xs.length]);\nconst $gvec4 = (type, ctor, xs) => lit(type, (xs = ctor(xs)), xs.length === 2\n    ? isVec(xs[1])\n        ? \"vv\"\n        : \"vn\"\n    : [\"n\", \"n\", , \"vnn\"][xs.length]);\nconst $gmat = (type, info, xs) => lit(type, (xs = $vec(xs)), info[xs.length]);\n// prettier-ignore\nexport function vec2(...xs) {\n    return $gvec2(\"vec2\", $vec, xs);\n}\nexport function vec3(...xs) {\n    return $gvec3(\"vec3\", $vec, xs);\n}\nexport function vec4(...xs) {\n    return $gvec4(\"vec4\", $vec, xs);\n}\n// prettier-ignore\nexport function ivec2(...xs) {\n    return $gvec2(\"ivec2\", $ivec, xs);\n}\nexport function ivec3(...xs) {\n    return $gvec3(\"ivec3\", $ivec, xs);\n}\nexport function ivec4(...xs) {\n    return $gvec4(\"ivec4\", $ivec, xs);\n}\n// prettier-ignore\nexport function uvec2(...xs) {\n    return $gvec2(\"uvec2\", $uvec, xs);\n}\nexport function uvec3(...xs) {\n    return $gvec3(\"uvec3\", $uvec, xs);\n}\nexport function uvec4(...xs) {\n    return $gvec4(\"uvec4\", $uvec, xs);\n}\n// prettier-ignore\nexport function bvec2(...xs) {\n    return $gvec2(\"bvec2\", $bvec, xs);\n}\nexport function bvec3(...xs) {\n    return $gvec3(\"bvec3\", $bvec, xs);\n}\nexport function bvec4(...xs) {\n    return $gvec4(\"bvec4\", $bvec, xs);\n}\nexport function mat2(...xs) {\n    return $gmat(\"mat2\", [\"n\", \"n\", \"vv\"], xs);\n}\nexport function mat3(...xs) {\n    return $gmat(\"mat3\", [\"n\", \"n\", , \"vvv\"], xs);\n}\nexport function mat4(...xs) {\n    return $gmat(\"mat4\", [\"n\", \"n\", , , \"vvvv\"], xs);\n}\n","import { bool, float, int, uint, vec2, vec3, vec4 } from \"./lit\";\n/**\n * Returns base type for given term. Used for array ops.\n *\n * @example\n * ```ts\n * itemType(\"vec2[]\") => \"vec2\"\n * ```\n */\nexport const itemType = (type) => type.replace(\"[]\", \"\");\n/**\n * Takes a numeric term and a plain number, returns number wrapped in\n * typed literal compatible with term.\n *\n * @param t -\n * @param x -\n */\nexport const numberWithMatchingType = (t, x) => {\n    const id = t.type[0];\n    return id === \"i\"\n        ? int(x)\n        : id === \"u\"\n            ? uint(x)\n            : id === \"b\"\n                ? bool(x)\n                : float(x);\n};\nexport const matchingPrimFor = (t, x) => {\n    const ctor = { vec2, vec3, vec4 }[t.type];\n    return ctor ? ctor(x) : x;\n};\nexport const matchingBoolType = (t) => ({\n    float: \"bool\",\n    int: \"bool\",\n    uint: \"bool\",\n    vec2: \"bvec2\",\n    ivec2: \"bvec2\",\n    uvec2: \"bvec2\",\n    vec3: \"bvec3\",\n    ivec3: \"bvec3\",\n    uvec3: \"bvec3\",\n    vec4: \"bvec4\",\n    ivec4: \"bvec4\",\n    uvec4: \"bvec4\"\n}[t.type]);\n","import { isNumber } from \"@thi.ng/checks\";\nimport { isMat, isVec } from \"./checks\";\nimport { numberWithMatchingType } from \"./item\";\nimport { float } from \"./lit\";\nexport const op1 = (op, val, post = false) => ({\n    tag: \"op1\",\n    type: val.type,\n    op,\n    val,\n    post\n});\nconst OP_INFO = {\n    mave: \"mv\",\n    vema: \"vm\",\n    vefl: \"vn\",\n    mafl: \"vn\",\n    flve: \"nv\",\n    flma: \"nv\",\n    ivin: \"vn\",\n    iniv: \"nv\",\n    uvui: \"vn\",\n    uiuv: \"nv\"\n};\nexport const op2 = (op, _l, _r, rtype, info) => {\n    const nl = isNumber(_l);\n    const nr = isNumber(_r);\n    let type;\n    let l;\n    let r;\n    if (nl) {\n        if (nr) {\n            // (number, number)\n            l = float(_l);\n            r = float(_r);\n            type = \"float\";\n        }\n        else {\n            // (number, term)\n            r = _r;\n            l = numberWithMatchingType(r, _l);\n            type = r.type;\n        }\n    }\n    else if (nr) {\n        // (term, number)\n        l = _l;\n        r = numberWithMatchingType(l, _r);\n        type = l.type;\n    }\n    else {\n        // (term, term)\n        l = _l;\n        r = _r;\n        type =\n            rtype ||\n                (isVec(l)\n                    ? l.type\n                    : isVec(r)\n                        ? r.type\n                        : isMat(r)\n                            ? r.type\n                            : l.type);\n    }\n    return {\n        tag: \"op2\",\n        type: rtype || type,\n        info: info || OP_INFO[l.type.substr(0, 2) + r.type.substr(0, 2)],\n        op,\n        l: l,\n        r: r\n    };\n};\nexport const inc = (t) => op1(\"++\", t, true);\nexport const dec = (t) => op1(\"--\", t, true);\n// prettier-ignore\nexport function add(l, r) {\n    return op2(\"+\", l, r);\n}\nexport function sub(l, r) {\n    return op2(\"-\", l, r);\n}\nexport function mul(l, r) {\n    return op2(\"*\", l, r, !isNumber(l) && !isNumber(r) && isMat(l) && isVec(r)\n        ? r.type\n        : undefined);\n}\nexport function div(l, r) {\n    return op2(\"/\", l, r);\n}\nexport function modi(l, r) {\n    return op2(\"%\", isNumber(l) ? numberWithMatchingType(r, l) : l, isNumber(r) ? numberWithMatchingType(l, r) : r);\n}\nexport const neg = (val) => op1(\"-\", val);\n/**\n * Multiply-add: a * b + c. All must be of same type.\n *\n * @param a -\n * @param b -\n * @param c -\n */\nexport const madd = (a, b, c) => add(mul(a, b), c);\n/**\n * Add-multiply: (a + b) * c. All must be of same type.\n *\n * @param a -\n * @param b -\n * @param c -\n */\nexport const addm = (a, b, c) => mul(add(a, b), c);\nexport const not = (val) => op1(\"!\", val);\nexport const or = (a, b) => op2(\"||\", a, b);\nexport const and = (a, b) => op2(\"&&\", a, b);\nconst cmp = (op) => (a, b) => op2(op, a, b, \"bool\");\nexport const eq = cmp(\"==\");\nexport const neq = cmp(\"!=\");\nexport const lt = cmp(\"<\");\nexport const lte = cmp(\"<=\");\nexport const gt = cmp(\">\");\nexport const gte = cmp(\">=\");\nexport const bitnot = (val) => op1(\"~\", val);\n// prettier-ignore\nexport function bitand(l, r) {\n    return op2(\"&\", l, r, undefined);\n}\n// prettier-ignore\nexport function bitor(l, r) {\n    return op2(\"|\", l, r, undefined);\n}\n// prettier-ignore\nexport function bitxor(l, r) {\n    return op2(\"^\", l, r, undefined);\n}\n","import { assert } from \"@thi.ng/api\";\nexport const assign = (l, r) => {\n    assert(l.tag !== \"swizzle\" || l.val.tag === \"sym\", \"can't assign to non-symbol swizzle\");\n    return {\n        tag: \"assign\",\n        type: l.type,\n        l,\n        r\n    };\n};\n","export function $(val, id) {\n    const type = val.type[0];\n    const rtype = (a, b) => id.length === 1 ? a : (b + id.length);\n    return {\n        tag: \"swizzle\",\n        type: type === \"i\"\n            ? rtype(\"int\", \"ivec\")\n            : type === \"u\"\n                ? rtype(\"uint\", \"uvec\")\n                : type === \"b\"\n                    ? rtype(\"bool\", \"bvec\")\n                    : rtype(\"float\", \"vec\"),\n        val,\n        id\n    };\n}\nexport const $x = (val) => $(val, \"x\");\nexport const $y = (val) => $(val, \"y\");\nexport const $z = (val) => $(val, \"z\");\nexport const $w = (val) => $(val, \"w\");\nexport function $xy(val) {\n    return $(val, \"xy\");\n}\nexport function $xyz(val) {\n    return $(val, \"xyz\");\n}\n","import { decl, scope } from \"./scope\";\nexport const ifThen = (test, truthy, falsey) => ({\n    tag: \"if\",\n    type: \"void\",\n    test,\n    t: scope(truthy),\n    f: falsey ? scope(falsey) : undefined\n});\nexport const ternary = (test, t, f) => ({\n    tag: \"ternary\",\n    type: t.type,\n    test,\n    t,\n    f\n});\nexport function forLoop(...xs) {\n    const [init, test, iter, body] = xs.length === 2\n        ? [, xs[0], , xs[1]]\n        : xs.length === 3\n            ? [xs[0], xs[1], , xs[2]]\n            : xs;\n    return {\n        tag: \"for\",\n        type: \"void\",\n        init: init ? decl(init) : undefined,\n        test: test(init),\n        iter: iter ? iter(init) : undefined,\n        scope: scope(body(init))\n    };\n}\nexport const whileLoop = (test, body) => ({\n    tag: \"while\",\n    type: \"void\",\n    test,\n    scope: scope(body)\n});\nconst ctrl = (id) => ({\n    tag: \"ctrl\",\n    type: \"void\",\n    id\n});\nexport const brk = ctrl(\"break\");\nexport const cont = ctrl(\"continue\");\nexport const discard = ctrl(\"discard\");\n","import { builtinCall } from \"../ast/function\";\nimport { matchingBoolType, matchingPrimFor } from \"../ast/item\";\nconst primOp1 = (name) => (a) => builtinCall(name, a.type, a);\nconst primOp2 = (name) => (a, b) => builtinCall(name, a.type, a, b);\nconst primOp3 = (name) => (a, b, c) => builtinCall(name, a.type, a, b, c);\n/**\n * Returns normalized version of given vector.\n *\n * @param v -\n */\nexport const normalize = (v) => builtinCall(\"normalize\", v.type, v);\n/**\n * Returns length / magnitude of given vector.\n *\n * @param v -\n */\nexport const length = (v) => builtinCall(\"length\", \"float\", v);\nexport const distance = (a, b) => builtinCall(\"distance\", \"float\", a, b);\n/**\n * Returns dot product of given vectors.\n *\n * @param a -\n * @param b -\n */\nexport const dot = (a, b) => builtinCall(\"dot\", \"float\", a, b);\n/**\n * Returns cross product of given 3D vectors.\n *\n * @param a -\n * @param b -\n */\nexport const cross = (a, b) => builtinCall(\"cross\", a.type, a, b);\nexport const reflect = (i, n) => builtinCall(\"reflect\", i.type, i, n);\nexport const refract = (i, n, ior) => builtinCall(\"refract\", i.type, i, n, ior);\nexport const faceForward = (i, n, nref) => builtinCall(\"faceForward\", i.type, i, n, nref);\nexport const min = primOp2(\"min\");\nexport const max = primOp2(\"max\");\nexport const clamp = primOp3(\"clamp\");\nexport const step = primOp2(\"step\");\nexport const smoothstep = primOp3(\"smoothstep\");\nexport const radians = primOp1(\"radians\");\nexport const degrees = primOp1(\"degrees\");\nexport const cos = primOp1(\"cos\");\nexport const sin = primOp1(\"sin\");\nexport const tan = primOp1(\"tan\");\nexport const acos = primOp1(\"acos\");\nexport const asin = primOp1(\"asin\");\nexport function atan(a, b) {\n    const f = b\n        ? builtinCall(\"atan\", a.type, a, b)\n        : builtinCall(\"atan\", a.type, a);\n    b && (f.info = \"nn\");\n    return f;\n}\nexport const pow = primOp2(\"pow\");\nexport const exp = primOp1(\"exp\");\nexport const log = primOp1(\"log\");\nexport const exp2 = primOp1(\"exp2\");\nexport const log2 = primOp1(\"log2\");\nexport const sqrt = primOp1(\"sqrt\");\nexport const inversesqrt = primOp1(\"inversesqrt\");\nexport const abs = primOp1(\"abs\");\nexport const sign = primOp1(\"sign\");\nexport const floor = primOp1(\"floor\");\nexport const ceil = primOp1(\"ceil\");\nexport const fract = primOp1(\"fract\");\nexport const powf = (x, y) => pow(x, matchingPrimFor(x, y));\nexport function mod(a, b) {\n    const f = builtinCall(\"mod\", a.type, a, b);\n    b.type === \"float\" && (f.info = \"n\");\n    return f;\n}\n/**\n * Important: Currently unsupported by JS target.\n *\n * TODO add additional metadata for JS (`b` is an output var), issue #96\n *\n * @param a -\n * @param b -\n */\n// prettier-ignore\nexport const modf = (a, b) => builtinCall(\"modf\", a.type, a, b);\nexport function mix(a, b, c) {\n    const f = builtinCall(\"mix\", a.type, a, b, c);\n    c.type === \"float\" && (f.info = \"n\");\n    return f;\n}\n// prettier-ignore\nexport const matrixCompMult = (a, b) => builtinCall(\"matrixCompMult\", a.type, a, b);\nexport function isnan(a) {\n    return builtinCall(\"isnan\", matchingBoolType(a), a);\n}\nexport function isinf(a) {\n    return builtinCall(\"isinf\", matchingBoolType(a), a);\n}\n","import { add, defn, div, FLOAT0, FLOAT05, FLOAT1, FLOAT2, mix, mul, neq, ret, sub, ternary } from \"@thi.ng/shader-ast\";\n/**\n * Returns normalized value of `x` WRT to interval [a,b]. Returns 0, if\n * `a` equals `b`.\n *\n * @param x -\n * @param a -\n * @param b -\n */\nexport const fitNorm1 = defn(\"float\", \"fitNorm1\", [\"float\", \"float\", \"float\"], (x, a, b) => [ret(ternary(neq(a, b), div(sub(x, a), sub(b, a)), FLOAT0))]);\n/**\n * Inline function. Fits value `a` in [0..1] interval to new interval\n * [b..c]. No clamping performed. Same as `mix(b, c, a)`\n *\n * @param a -\n * @param b -\n * @param c -\n */\nexport const fit01 = (a, b, c) => mix(b, c, a);\n/**\n * Inline function. Fits value `x` in [-1..+1] interval to [0..1]\n * interval. No clamping performed.\n *\n * @param x -\n */\nexport const fit1101 = (x) => add(mul(x, FLOAT05), FLOAT05);\n/**\n * Inline function. Fits value `x` in [0..1] interval to [-1..+1]\n * interval. No clamping performed.\n *\n * @param x -\n */\nexport const fit0111 = (x) => sub(mul(x, FLOAT2), FLOAT1);\n","import { $x, $xy, $y, assign, defn, div, mul, ret, sym } from \"@thi.ng/shader-ast\";\nimport { fit0111 } from \"../math/fit\";\n/**\n * Computes UV coord in [0..1] interval from given `fragCoord` and screen `res`.\n *\n * @param fragCoord -\n * @param res -\n */\nexport const fragUV = (fragCoord, res) => div($xy(fragCoord), res);\n/**\n * Takes `pos`, a screen coord (e.g. gl_FragCoord) and viewport\n * resolution `res`, returns aspect corrected uv, with uv.y in [-1..1]\n * interval.\n *\n * @param fragCoord - vec2\n * @param res - vec2\n */\nexport const aspectCorrectedUV = defn(\"vec2\", \"aspectCorrectedUV\", [\"vec2\", \"vec2\"], (pos, res) => {\n    let uv;\n    return [\n        (uv = sym(\"vec2\", fit0111(div(pos, res)))),\n        assign($x(uv), mul($x(uv), div($x(res), $y(res)))),\n        ret(uv)\n    ];\n});\n","import { add, assign, defn, float, FLOAT0, FLOAT05, forLoop, inc, lt, mul, ret, sym } from \"@thi.ng/shader-ast\";\n/**\n * Higher order function. Takes an AST type ID, a single-arg scalar\n * function `fn`, number of octaves (default: 4) and an optional\n * function name. Returns a new function which computes the summed value\n * of `fn` over the given number octaves and accepts 3 args:\n *\n * - position (float)\n * - octave shift (float)\n * - octave decay (usually 0.5)\n *\n * For each octave `i` [0..oct), the function is (in principle)\n * evaluated as:\n *\n * n += decay / exp2(i) * fn(pos * exp2(i) + i * shift)\n *\n * @param fn -\n * @param oct -\n * @param name -\n */\nexport const additive = (type, fn, oct = 4, name = \"additive\") => defn(\"float\", name, [[type], [type], \"float\"], (pos, shift, decay) => {\n    let n;\n    let amp;\n    return [\n        (n = sym(FLOAT0)),\n        (amp = sym(FLOAT05)),\n        forLoop(sym(\"float\", float(0)), (i) => lt(i, float(oct)), inc, (i) => [\n            assign(n, add(n, mul(amp, fn(add(pos, mul(i, shift)))))),\n            assign(amp, mul(amp, decay)),\n            assign(pos, mul(pos, 2))\n        ]),\n        ret(n)\n    ];\n});\n","import { defn, dot, ret } from \"@thi.ng/shader-ast\";\nexport const magSq2 = defn(\"float\", \"magSq2\", [\"vec2\"], (v) => [\n    ret(dot(v, v))\n]);\nexport const magSq3 = defn(\"float\", \"magSq3\", [\"vec3\"], (v) => [\n    ret(dot(v, v))\n]);\nexport const magSq4 = defn(\"float\", \"magSq4\", [\"vec4\"], (v) => [\n    ret(dot(v, v))\n]);\n","import { add, defn, float, FLOAT1, mod, mul, ret } from \"@thi.ng/shader-ast\";\nconst __permute = (type, suffix = \"\") => defn(type, `permute${suffix}`, [type], (v) => [\n    ret(mod(mul(v, add(mul(v, float(34)), FLOAT1)), float(289)))\n]);\nexport const permute = __permute(\"float\");\nexport const permute2 = __permute(\"vec2\", \"2\");\nexport const permute3 = __permute(\"vec3\", \"3\");\nexport const permute4 = __permute(\"vec4\", \"4\");\n","import { $, $x, $xy, $y, abs, add, assign, defn, dot, float, FLOAT05, FLOAT1, floor, fract, gt, max, mod, mul, ret, sub, sym, ternary, vec2, vec3, vec4 } from \"@thi.ng/shader-ast\";\nimport { magSq2 } from \"../math/magsq\";\nimport { permute3 } from \"./permute\";\n/**\n * Array and textureless GLSL 2D simplex noise function. Ported from\n * original GLSL implementation by Ian McEwan & Ashima Arts.\n *\n * {@link https://github.com/ashima/webgl-noise}\n */\nexport const snoise2 = defn(\"float\", \"snoise2\", [\"vec2\"], (v) => {\n    let C;\n    let i;\n    let i1;\n    let x0;\n    let x12;\n    let p;\n    let m;\n    let x;\n    let h;\n    let ox;\n    let a0;\n    let g;\n    return [\n        (C = sym(vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439))),\n        (i = sym(floor(add(v, dot(v, $(C, \"yy\")))))),\n        (x0 = sym(add(sub(v, i), dot(i, $(C, \"xx\"))))),\n        (i1 = sym(ternary(gt($x(x0), $y(x0)), vec2(1, 0), vec2(0, 1)))),\n        (x12 = sym(sub(add($(x0, \"xyxy\"), $(C, \"xxzz\")), vec4(i1, 0, 0)))),\n        assign(i, mod(i, float(289))),\n        (p = sym(permute3(add(permute3(add(vec3(0, $y(i1), 1), $y(i))), add(vec3(0, $x(i1), 1), $x(i)))))),\n        (m = sym(max(sub(FLOAT05, vec3(magSq2(x0), magSq2($xy(x12)), magSq2($(x12, \"zw\")))), vec3()))),\n        assign(m, mul(m, m)),\n        assign(m, mul(m, m)),\n        (x = sym(sub(mul(2, fract(mul(p, $(C, \"www\")))), FLOAT1))),\n        (h = sym(sub(abs(x), FLOAT05))),\n        (ox = sym(floor(add(x, FLOAT05)))),\n        (a0 = sym(sub(x, ox))),\n        assign(m, mul(m, sub(1.79284291400159, mul(0.85373472095314, add(mul(a0, a0), mul(h, h)))))),\n        (g = sym(vec3(add(mul($x(a0), $x(x0)), mul($x(h), $y(x0)))))),\n        assign($(g, \"yz\"), add(mul($(a0, \"yz\"), $(x12, \"xz\")), mul($(h, \"yz\"), $(x12, \"yw\")))),\n        ret(mul(130, dot(m, g)))\n    ];\n});\n","import { defError } from \"./deferror\";\nexport const UnsupportedOperationError = defError(() => \"unsupported operation\");\nexport const unsupported = (msg) => {\n    throw new UnsupportedOperationError(msg);\n};\n","export var LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"FINE\"] = 0] = \"FINE\";\n    LogLevel[LogLevel[\"DEBUG\"] = 1] = \"DEBUG\";\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\n    LogLevel[LogLevel[\"SEVERE\"] = 4] = \"SEVERE\";\n    LogLevel[LogLevel[\"NONE\"] = 5] = \"NONE\";\n})(LogLevel || (LogLevel = {}));\n","import { LogLevel } from \"./api/logger\";\nexport const NULL_LOGGER = Object.freeze({\n    level: LogLevel.NONE,\n    fine() { },\n    debug() { },\n    info() { },\n    warn() { },\n    severe() { }\n});\nexport class ConsoleLogger {\n    constructor(id, level = LogLevel.FINE) {\n        this.id = id;\n        this.level = level;\n    }\n    fine(...args) {\n        this.level <= LogLevel.FINE && this.log(\"FINE\", args);\n    }\n    debug(...args) {\n        this.level <= LogLevel.DEBUG && this.log(\"DEBUG\", args);\n    }\n    info(...args) {\n        this.level <= LogLevel.INFO && this.log(\"INFO\", args);\n    }\n    warn(...args) {\n        this.level <= LogLevel.WARN && this.log(\"WARN\", args);\n    }\n    severe(...args) {\n        this.level <= LogLevel.SEVERE && this.log(\"SEVERE\", args);\n    }\n    log(level, args) {\n        console.log(`[${level}] ${this.id}:`, ...args);\n    }\n}\n","import { NULL_LOGGER } from \"@thi.ng/api\";\n/**\n * Unique symbol used for registering a default / fallback\n * implementation.\n */\nexport const DEFAULT = Symbol();\nexport let LOGGER = NULL_LOGGER;\nexport const setLogger = (logger) => (LOGGER = logger);\n","import { unsupported } from \"@thi.ng/errors\";\nimport { DEFAULT, LOGGER } from \"./constants\";\nexport function defmulti(f, ancestors) {\n    const impls = {};\n    const rels = ancestors\n        ? makeRels(ancestors)\n        : {};\n    const fn = (...args) => {\n        const id = f(...args);\n        const g = impls[id] || findImpl(impls, rels, id) || impls[DEFAULT];\n        return g\n            ? g(...args)\n            : unsupported(`missing implementation for: \"${id.toString()}\"`);\n    };\n    fn.add = (id, g) => {\n        if (impls[id]) {\n            LOGGER.warn(`overwriting '${id.toString()}' impl`);\n        }\n        impls[id] = g;\n        return true;\n    };\n    fn.addAll = (_impls) => {\n        let ok = true;\n        for (let id in _impls) {\n            ok = fn.add(id, _impls[id]) && ok;\n        }\n        return ok;\n    };\n    fn.remove = (id) => {\n        if (!impls[id])\n            return false;\n        delete impls[id];\n        return true;\n    };\n    fn.callable = (...args) => {\n        const id = f(...args);\n        return !!(impls[id] ||\n            findImpl(impls, rels, id) ||\n            impls[DEFAULT]);\n    };\n    fn.isa = (id, parent) => {\n        let val = rels[id];\n        !val && (rels[id] = val = new Set());\n        val.add(parent);\n    };\n    fn.impls = () => {\n        const res = new Set(Object.keys(impls));\n        for (let id in rels) {\n            findImpl(impls, rels, id) && res.add(id);\n        }\n        impls[DEFAULT] && res.add(DEFAULT);\n        return res;\n    };\n    fn.rels = () => rels;\n    fn.parents = (id) => rels[id];\n    fn.ancestors = (id) => new Set(findAncestors([], rels, id));\n    return fn;\n}\nconst findImpl = (impls, rels, id) => {\n    const parents = rels[id];\n    if (!parents)\n        return;\n    for (let p of parents) {\n        let impl = impls[p] || findImpl(impls, rels, p);\n        if (impl)\n            return impl;\n    }\n};\nconst findAncestors = (acc, rels, id) => {\n    const parents = rels[id];\n    if (parents) {\n        for (let p of parents) {\n            acc.push(p);\n            findAncestors(acc, rels, p);\n        }\n    }\n    return acc;\n};\nconst makeRels = (spec) => {\n    const rels = {};\n    for (let k in spec) {\n        const val = spec[k];\n        rels[k] = val instanceof Set ? val : new Set(val);\n    }\n    return rels;\n};\n","import { DEFAULT, defmulti } from \"@thi.ng/defmulti\";\nimport { unsupported } from \"@thi.ng/errors\";\n/**\n * Takes an object of code generator functions and returns a new code\n * generator / compile target function which serializes a given AST\n * using the provided node type implementations.\n *\n * {@link @thi.ng/shader-ast-glsl#targetGLSL}\n *\n * @param impls -\n */\nexport const defTarget = (impls) => {\n    const emit = defmulti((x) => x.tag);\n    emit.add(DEFAULT, (t) => unsupported(`no impl for AST node type: '${t.tag}'`));\n    emit.addAll(impls);\n    return emit;\n};\n","export var GLSLVersion;\n(function (GLSLVersion) {\n    GLSLVersion[\"GLES_100\"] = \"100\";\n    GLSLVersion[\"GLES_300\"] = \"300 es\";\n})(GLSLVersion || (GLSLVersion = {}));\n","import { isBoolean, isNumber } from \"@thi.ng/checks\";\nimport { unsupported } from \"@thi.ng/errors\";\nimport { defTarget, isMat, isVec, itemType, sym } from \"@thi.ng/shader-ast\";\nimport { GLSLVersion } from \"./api\";\nconst RE_SEMI = /[};]$/;\n/**\n * GLSL code gen, targets GLSL ES 3.00 (WebGL2) by default.\n *\n * Use options object to configure shader type and GLSL version: `100`\n * for WebGL, 300 for WebGL2. Currently, the only differences in terms\n * of code generation, not correctness, are:\n *\n * - attribute, varying, uniform declarations\n * - texture lookup function naming\n *\n * Unsupported features in GLSL 100:\n *\n * - Fragment shader output vars\n *\n * @param opts -\n */\nexport const targetGLSL = (opts) => {\n    const _opts = Object.assign({ type: \"fs\", version: GLSLVersion.GLES_300, versionPragma: true, prelude: \"\" }, opts);\n    const isVS = _opts.type === \"vs\";\n    // TODO update once we have struct support\n    const $type = (t) => t;\n    const $list = (body, sep = \", \") => body.map(emit).join(sep);\n    const $fn = (t) => `${t.id}(${$list(t.args)})`;\n    const $decl = (sym, arg = false) => {\n        const { id, type, opts, init } = sym;\n        const res = [];\n        if (opts.type) {\n            let type;\n            if (_opts.version < GLSLVersion.GLES_300) {\n                if (isVS) {\n                    type = {\n                        in: \"attribute\",\n                        out: \"varying\",\n                        uni: \"uniform\"\n                    }[opts.type];\n                }\n                else {\n                    type = {\n                        in: \"varying\",\n                        out: null,\n                        uni: \"uniform\"\n                    }[opts.type];\n                    !type &&\n                        unsupported(\"GLSL 100 doesn't support fragment shader output variables\");\n                }\n            }\n            else {\n                opts.loc != null && res.push(`layout(location=${opts.loc}) `);\n                type = opts.type === \"uni\" ? \"uniform\" : opts.type;\n            }\n            res.push(type + \" \");\n        }\n        else {\n            opts.const && res.push(\"const \");\n            arg && opts.q && res.push(opts.q + \" \");\n        }\n        opts.prec && res.push(opts.prec + \" \");\n        res.push($type(itemType(type)), \" \", id);\n        opts.num && res.push(`[${opts.num}]`);\n        init && res.push(\" = \", emit(init));\n        return res.join(\"\");\n    };\n    const emit = defTarget({\n        arg: (t) => $decl(t, true),\n        array_init: (t) => _opts.version >= GLSLVersion.GLES_300\n            ? `${t.type}(${$list(t.init)})`\n            : unsupported(`array initializers not available in GLSL ${_opts.version}`),\n        assign: (t) => emit(t.l) + \" = \" + emit(t.r),\n        ctrl: (t) => t.id,\n        call: $fn,\n        call_i: (t) => t.id === \"texture\" && _opts.version < GLSLVersion.GLES_300\n            ? `${t.id}${t.args[0].type.substr(7)}(${$list(t.args)})`\n            : $fn(t),\n        decl: (t) => $decl(t.id),\n        fn: (t) => `${$type(t.type)} ${t.id}(${$list(t.args)}) ${emit(t.scope)}`,\n        for: (t) => `for(${t.init ? emit(t.init) : \"\"}; ${emit(t.test)}; ${t.iter ? emit(t.iter) : \"\"}) ${emit(t.scope)}`,\n        idx: (t) => `${emit(t.val)}[${emit(t.id)}]`,\n        if: (t) => {\n            const res = `if (${emit(t.test)}) ` + emit(t.t);\n            return t.f ? res + \" else \" + emit(t.f) : res;\n        },\n        lit: (t) => {\n            const v = t.val;\n            switch (t.type) {\n                case \"bool\":\n                    return isBoolean(v) ? String(v) : `bool(${emit(v)})`;\n                case \"float\":\n                    return isNumber(v)\n                        ? v === Math.trunc(v)\n                            ? v + \".0\"\n                            : String(v)\n                        : `float(${emit(v)})`;\n                case \"int\":\n                case \"uint\":\n                    return isNumber(v) ? String(v) : `${t.type}(${emit(v)})`;\n                default: {\n                    if (isVec(t) || isMat(t)) {\n                        return `${t.type}(${$list(v)})`;\n                    }\n                    return unsupported(`unknown type: ${t.type}`);\n                }\n            }\n        },\n        op1: (t) => t.post ? `(${emit(t.val)}${t.op})` : `(${t.op}${emit(t.val)})`,\n        op2: (t) => `(${emit(t.l)} ${t.op} ${emit(t.r)})`,\n        ret: (t) => \"return\" + (t.val ? \" \" + emit(t.val) : \"\"),\n        scope: (t) => {\n            let res = t.body\n                .map(emit)\n                .reduce((acc, x) => (acc.push(RE_SEMI.test(x) ? x : x + \";\"), acc), [])\n                .join(\"\\n\");\n            res += t.body.length && !RE_SEMI.test(res) ? \";\" : \"\";\n            if (!t.global) {\n                return `{\\n${res}\\n}`;\n            }\n            if (_opts.prelude) {\n                res = _opts.prelude + \"\\n\" + res;\n            }\n            if (_opts.versionPragma) {\n                res = `#version ${_opts.version}\\n` + res;\n            }\n            return res;\n        },\n        swizzle: (t) => `${emit(t.val)}.${t.id}`,\n        sym: (t) => t.id,\n        ternary: (t) => `(${emit(t.test)} ? ${emit(t.t)} : ${emit(t.f)})`,\n        while: (t) => `while (${emit(t.test)}) ${emit(t.scope)}`\n    });\n    Object.assign(emit, {\n        gl_FragColor: sym(\"vec4\", \"gl_FragColor\"),\n        gl_FragCoord: sym(\"vec4\", \"gl_FragCoord\", { const: true }),\n        gl_FragData: sym(\"vec4[]\", \"gl_FragData\", { num: 1 }),\n        gl_FrontFacing: sym(\"bool\", \"gl_FrontFacing\", { const: true }),\n        gl_PointCoord: sym(\"vec2\", \"gl_PointCoord\", { const: true }),\n        gl_PointSize: sym(\"float\", \"gl_PointSize\"),\n        gl_Position: sym(\"vec4\", \"gl_Position\")\n    });\n    return emit;\n};\n","import {\n\tdefn,\n\tVec2Sym,\n\tFloatSym,\n\tsym,\n\tadd,\n\tvec2,\n\tfloat,\n\tret,\n\tvec4,\n\tvec3,\n\tprogram,\n\tdefMain,\n\tuniform,\n\tTaggedFn3,\n\tVec4Sym,\n\tassign,\n\t$xy,\n} from '@thi.ng/shader-ast'\nimport {\n\tadditive,\n\taspectCorrectedUV,\n\tfit1101,\n\tsnoise2,\n} from '@thi.ng/shader-ast-stdlib'\nimport { targetGLSL, GLSLVersion } from '@thi.ng/shader-ast-glsl'\n\nconst fs = targetGLSL({\n\tversion: GLSLVersion.GLES_100,\n\ttype: 'fs',\n\tprelude: 'precision mediump float;',\n})\n\nlet getImage = defn(\n\t'vec4',\n\t'mainImage',\n\t['vec2', 'vec2', 'float'],\n\t(fragCoord: Vec2Sym, res: Vec2Sym, time: FloatSym) => {\n\t\tlet uv: Vec2Sym\n\t\tlet col: FloatSym\n\t\treturn [\n\t\t\t(uv = sym(aspectCorrectedUV(fragCoord, res))),\n\t\t\t// dynamically create a multi-octave version of `snoise2`\n\t\t\t// computed over 4 octaves w/ given phase shift and decay\n\t\t\t// factor (both per octave)\n\t\t\t(col = sym(\n\t\t\t\tadditive('vec2', snoise2, 4)(add(uv, time), vec2(2), float(0.5)),\n\t\t\t)),\n\t\t\tret(vec4(vec3(fit1101(col)), 1)),\n\t\t]\n\t},\n)\n\nlet resolution: Vec2Sym\nlet time: FloatSym\n\nexport const noiseShader = fs(\n\tprogram([\n\t\t(resolution = uniform('vec2', 'resolution')),\n\t\t(time = uniform('float', 'time')),\n\t\tdefMain(() => [\n\t\t\tassign(fs.gl_FragColor, getImage($xy(fs.gl_FragCoord), resolution, time)),\n\t\t]),\n\t]),\n)\n\nconsole.log(noiseShader)\n\n\nif (module.hot) {module.hot.accept(function(err) {\nif (err) {\nconsole.error(err);\n}\n});\n}\n","import {\n\tgetEffect,\n\tget,\n\tdispatch,\n\tgetFrame,\n\taddSystem,\n} from '../../shared-utils/painterState'\nimport { painter, events } from './context'\nimport { noiseShader } from './shaders'\nimport { repeat } from '../../shared-utils/scheduler'\n\n// ===== layers =====\n\nexport const noise = getEffect(painter, 'noise').update({\n\tfrag: noiseShader,\n})\n\nexport const toNormal = getEffect(painter, 'toNormal')\n\nconst noiseFrame = getFrame(painter, 'noise').update({\n\tlayers: noise,\n})\n\nlet time = 0\n\nrepeat(tpf => {\n\tconst d = get('device')\n\td.tpf = tpf\n\t// dispatch(events.FRAME)\n\n\ttime += tpf / 10000\n\tnoise.update({\n\t\tuniforms: {\n\t\t\tresolution: [d.canvas.width, d.canvas.height],\n\t\t\ttime,\n\t\t},\n\t})\n\tpainter.compose(noiseFrame).display(noiseFrame)\n}, 'loop')\n\naddSystem('index', (e, s) => {\n\tif (e === events.RESIZE) {\n\t\tnoiseFrame.update()\n\t}\n})\n\n\nif (module.hot) {module.hot.accept(function(err) {\nif (err) {\nconsole.error(err);\n}\n});\n}\n","export function randInt(int) {\n    return Math.floor(Math.random() * int);\n}\nexport function randIntInRange(from, to) {\n    return randInt(to - from) + from;\n}\nexport function normalRand() {\n    return (Math.random() + Math.random() + Math.random()) / 3;\n}\n//# sourceMappingURL=random.js.map","import { NO_OP } from \"./constants\";\n/**\n * Takes a `test` result or predicate function without args and throws\n * error with given `msg` if test failed (i.e. is falsy).\n *\n * @remarks\n * The function is only enabled if `process.env.NODE_ENV != \"production\"`\n * or if the `UMBRELLA_ASSERTS` env var is set to 1.\n */\nexport const assert = typeof process === \"undefined\" ||\n    process.env.NODE_ENV !== \"production\" ||\n    process.env.UMBRELLA_ASSERTS === \"1\"\n    ? (test, msg = \"assertion failed\") => {\n        if ((typeof test === \"function\" && !test()) || !test) {\n            throw new Error(typeof msg === \"function\" ? msg() : msg);\n        }\n    }\n    : NO_OP;\n","export const isNode = () => {\n    if (typeof process === \"object\") {\n        if (typeof process.versions === \"object\") {\n            if (typeof process.versions.node !== \"undefined\") {\n                return true;\n            }\n        }\n    }\n    return false;\n};\n","// onNextTick\n// schedule actions on next animation frame\n\ntype Callback = (n: number) => void\n\nlet updateOnce: { [id: string]: Callback } | null = null\nconst updateRepeat: { [id: string]: Callback } = {}\n\nlet willUpdate = false\n\nlet uidCounter = 0\n\nlet oldTime = 0\n\nfunction processUpdates(time: number) {\n\tconst tpf = oldTime ? time - oldTime : oldTime\n\toldTime = time\n\n\tif (updateOnce) {\n\t\tfor (const id in updateOnce) {\n\t\t\tupdateOnce[id](tpf)\n\t\t}\n\t\tupdateOnce = null\n\t}\n\n\tlet updates = 0\n\tfor (const id in updateRepeat) {\n\t\tupdates++\n\t\tupdateRepeat[id](tpf)\n\t}\n\n\tif (!updates) {\n\t\twillUpdate = false\n\t\toldTime = 0\n\t} else {\n\t\trequestAnimationFrame(processUpdates)\n\t}\n}\n\nexport function once(fn: Callback, id?: string | number) {\n\tid = id || fn.name || uidCounter++\n\tupdateOnce = updateOnce || {}\n\tupdateOnce[id] = fn\n\n\tif (!willUpdate) {\n\t\trequestAnimationFrame(processUpdates)\n\t\twillUpdate = true\n\t}\n}\n\nexport function repeat(fn: Callback, id?: string | number) {\n\tid = id || fn.name || uidCounter++\n\tupdateRepeat[id] = fn\n\n\tif (!willUpdate) {\n\t\trequestAnimationFrame(processUpdates)\n\t\twillUpdate = true\n\t}\n\n\treturn id\n}\n\nexport function stop(id: Callback | string | number) {\n\tif (typeof id === 'function') {\n\t\tid = id.name\n\t}\n\tdelete updateRepeat[id]\n}\n\n\nif (module.hot) {module.hot.accept(function(err) {\nif (err) {\nconsole.error(err);\n}\n});\n}\n","export const Buttons = {\n    LEFT: 0,\n    MIDDLE: 1,\n    RIGHT: 2,\n};\nexport function pointer(opts, callback) {\n    const cb = callback || opts;\n    const { element = document, enableRightButton, holdDelay = 400, holdRadius = 5, } = opts;\n    const state = {\n        pressed: {},\n        drag: { x: 0, y: 0, dX: 0, dY: 0, xMax: 0, yMax: 0 },\n        dragging: false,\n        holding: false,\n    };\n    let x = 0, y = 0, oX = 0, oY = 0, timeout = null;\n    function onPointerDown(e) {\n        if (e.isPrimary) {\n            state.pressed[e.button] = e;\n            x = oX = e.clientX;\n            y = oY = e.clientY;\n            state.dragging = true;\n            timeout != null && clearTimeout(timeout);\n            timeout = setTimeout(() => {\n                if (state.drag.xMax < holdRadius && state.drag.yMax < holdRadius) {\n                    state.holding = true;\n                    cb(state);\n                }\n            }, holdDelay);\n        }\n        else {\n            state.pressed[Buttons.RIGHT] = e;\n        }\n        cb(state);\n    }\n    function onPointerUp(_e) {\n        state.pressed = {};\n        delete state.drag.event;\n        state.drag.x = 0;\n        state.drag.y = 0;\n        state.drag.dX = 0;\n        state.drag.dY = 0;\n        state.drag.xMax = 0;\n        state.drag.yMax = 0;\n        state.dragging = false;\n        state.holding = false;\n        timeout != null && clearTimeout(timeout);\n        timeout = null;\n        cb(state);\n    }\n    function onPointerMove(e) {\n        if (state.dragging) {\n            state.drag.event = e;\n            state.drag.x = x - e.clientX;\n            state.drag.y = y - e.clientY;\n            state.drag.dX = oX - e.clientX;\n            state.drag.dY = oY - e.clientY;\n            state.drag.xMax = Math.max(Math.abs(state.drag.x), state.drag.xMax);\n            state.drag.yMax = Math.max(Math.abs(state.drag.y), state.drag.yMax);\n            oX = e.clientX;\n            oY = e.clientY;\n            cb(state);\n        }\n    }\n    function preventDefault(e) {\n        e.preventDefault();\n    }\n    element.addEventListener('pointerdown', onPointerDown);\n    document.addEventListener('pointermove', onPointerMove);\n    document.addEventListener('pointerup', onPointerUp);\n    document.addEventListener('pointerleave', onPointerUp);\n    document.addEventListener('pointercancel', onPointerUp);\n    if (enableRightButton) {\n        element.addEventListener('contextmenu', preventDefault);\n    }\n    cb(state);\n    return function destroy() {\n        element.removeEventListener('pointerdown', onPointerDown);\n        document.removeEventListener('pointermove', onPointerMove);\n        document.removeEventListener('pointerup', onPointerUp);\n        document.removeEventListener('pointerleave', onPointerUp);\n        document.removeEventListener('pointercancel', onPointerUp);\n        if (enableRightButton) {\n            element.removeEventListener('contextmenu', preventDefault);\n        }\n    };\n}\nexport function pointerObserver(opts = {}) {\n    const observer = {\n        Buttons,\n        state: {},\n        destroy: () => { },\n    };\n    function callback(state) {\n        observer.state = state;\n    }\n    observer.destroy = pointer(opts, callback);\n    return observer;\n}\n//# sourceMappingURL=pointer.js.map","export const and = (p1, p2) => (a, b) => p1(a, b) && p2(a, b);\nexport const not = (p) => (...args) => !p(...args);\nexport const defined = a => a != null;\nexport const notEmpty = a => a && a.length;\nexport const unequal = (a, b) => a !== b;\nexport const equal = (a, b) => a === b;\nexport function equalArray(arr1, arr2) {\n    if (arr1 === arr2) {\n        return true;\n    }\n    if (!arr2 || !arr1) {\n        return false;\n    }\n    if (arr1.length !== arr2.length) {\n        return false;\n    }\n    for (let i = 0; i < arr1.length; i++) {\n        if (arr1[i] !== arr2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\nexport function equalObject(obj1, obj2) {\n    if (obj1 === obj2) {\n        return true;\n    }\n    if (!obj2) {\n        return false;\n    }\n    const k1 = Object.keys(obj1);\n    const k2 = Object.keys(obj2);\n    if (!equalArray(k1, k2)) {\n        return false;\n    }\n    for (const key of k1) {\n        if (obj1[key] !== obj2[key]) {\n            return false;\n        }\n    }\n    return true;\n}\n//# sourceMappingURL=predicates.js.map"],"sourceRoot":""}