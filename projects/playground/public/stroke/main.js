(()=>{var e={758:()=>{}},t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(()=>{"use strict";function e(e,t,r=[]){for(let n=0;n<t;n++)r[n]=e(n);return r}function t(t,r){return e((()=>r),t)}function n(e,...t){return e.concat(...t)}function i(e,t=[]){for(const r of e){const e=t.length;for(let n=0;n<r.length;n++)t[n+e]=r[n]}return t}const s=function(e,t,r=[]){return i(function(e,t,r=[]){for(let n=0;n<t.length;n++)r[n]=e(t[n],n);return r}(e,t,r))};function a(e,t=[]){for(let r=0;r<e.length;r++)t[r]=e[e.length-1-r];return t}let o=null;const u={};let l=!1,f=0,c=0;function h(e){const t=c?e-c:c;if(c=e,o){for(const e in o)o[e](t);o=null}let r=0;for(const e in u)r++,u[e](t);r?requestAnimationFrame(h):(l=!1,c=0)}var d;function p(e,t,r){const n=r&&r.ignore;if("object"==typeof e&&"object"==typeof t&&!Array.isArray(e)&&!Array.isArray(t)&&e!==t){for(const r in e)if(e.hasOwnProperty(r)&&(!n||!(r in n)||!0!==n[r])){const i=e[r],s=t[r];void 0!==s&&(e[r]=p(i,s,{ignore:n&&n[r]}))}return e}return t}!function(e){e[e.CANCEL=3]="CANCEL",e[e.HELP=6]="HELP",e[e.BACK_SPACE=8]="BACK_SPACE",e[e.TAB=9]="TAB",e[e.CLEAR=12]="CLEAR",e[e.RETURN=13]="RETURN",e[e.ENTER=14]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CONTROL=17]="CONTROL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.PRINTSCREEN=44]="PRINTSCREEN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.DIGIT_0=48]="DIGIT_0",e[e.DIGIT_1=49]="DIGIT_1",e[e.DIGIT_2=50]="DIGIT_2",e[e.DIGIT_3=51]="DIGIT_3",e[e.DIGIT_4=52]="DIGIT_4",e[e.DIGIT_5=53]="DIGIT_5",e[e.DIGIT_6=54]="DIGIT_6",e[e.DIGIT_7=55]="DIGIT_7",e[e.DIGIT_8=56]="DIGIT_8",e[e.DIGIT_9=57]="DIGIT_9",e[e.SEMICOLON=59]="SEMICOLON",e[e.EQUALS=61]="EQUALS",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.CONTEXT_MENU=93]="CONTEXT_MENU",e[e.NUMPAD0=96]="NUMPAD0",e[e.NUMPAD1=97]="NUMPAD1",e[e.NUMPAD2=98]="NUMPAD2",e[e.NUMPAD3=99]="NUMPAD3",e[e.NUMPAD4=100]="NUMPAD4",e[e.NUMPAD5=101]="NUMPAD5",e[e.NUMPAD6=102]="NUMPAD6",e[e.NUMPAD7=103]="NUMPAD7",e[e.NUMPAD8=104]="NUMPAD8",e[e.NUMPAD9=105]="NUMPAD9",e[e.MULTIPLY=106]="MULTIPLY",e[e.ADD=107]="ADD",e[e.SEPARATOR=108]="SEPARATOR",e[e.SUBTRACT=109]="SUBTRACT",e[e.DECIMAL=110]="DECIMAL",e[e.DIVIDE=111]="DIVIDE",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.F13=124]="F13",e[e.F14=125]="F14",e[e.F15=126]="F15",e[e.F16=127]="F16",e[e.F17=128]="F17",e[e.F18=129]="F18",e[e.F19=130]="F19",e[e.F20=131]="F20",e[e.F21=132]="F21",e[e.F22=133]="F22",e[e.F23=134]="F23",e[e.F24=135]="F24",e[e.NUM_LOCK=144]="NUM_LOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.COMMA=188]="COMMA",e[e.PERIOD=190]="PERIOD",e[e.SLASH=191]="SLASH",e[e.BACK_QUOTE=192]="BACK_QUOTE",e[e.OPEN_BRACKET=219]="OPEN_BRACKET",e[e.BACK_SLASH=220]="BACK_SLASH",e[e.CLOSE_BRACKET=221]="CLOSE_BRACKET",e[e.QUOTE=222]="QUOTE",e[e.META=224]="META"}(d||(d={}));const g=5126,y=5124,m=5125,E=3553,_=34067,v=32879,b=35866,A="CLAMP_TO_EDGE",T={renderQuad:{attribs:{position:{buffer:new Float32Array([-1,1,-1,-1,1,1,1,-1]),storeType:"STATIC"},uv:{buffer:new Float32Array([0,1,0,0,1,1,1,0]),storeType:"STATIC"}},drawType:"TRIANGLE_STRIP",itemCount:4}},F={vert:"\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 coords;\nvoid main() {\n\tcoords = uv;\n\tgl_Position = vec4(position, 0.0, 1.0);\n}",frag:"precision mediump float;\nuniform sampler2D source;\nvarying vec2 coords;\nvoid main() {\n\tgl_FragColor = texture2D(source, coords);\n}"};function S(e){return L[e].bindPoint}function R(e,t){return r=>{e.uniform1i(t,r)}}function w(e,t){return r=>{e.uniform1iv(t,r)}}function M(e,t){return r=>{e.uniform2iv(t,r)}}function P(e,t){return r=>{e.uniform3iv(t,r)}}function x(e,t){return r=>{e.uniform4iv(t,r)}}function U(e,t,r,n){const i=S(t);return t=>{e.uniform1i(n,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(i,t._texture)}}function D(e,t,r,n,i){const s=S(t),a=new Int32Array(i);for(let e=0;e<i;++e)a[e]=r+e;return t=>{e.uniform1iv(n,a);for(const r in t)e.activeTexture(e.TEXTURE0+a[r]),e.bindTexture(s,t[r]._texture)}}const L={[g]:{Type:Float32Array,size:4,setter:function(e,t){return r=>{e.uniform1f(t,r)}},arraySetter:function(e,t){return r=>{e.uniform1fv(t,r)}}},35664:{Type:Float32Array,size:8,setter:function(e,t){return r=>{e.uniform2fv(t,r)}}},35665:{Type:Float32Array,size:12,setter:function(e,t){return r=>{e.uniform3fv(t,r)}}},35666:{Type:Float32Array,size:16,setter:function(e,t){return r=>{e.uniform4fv(t,r)}}},[y]:{Type:Int32Array,size:4,setter:R,arraySetter:w},35667:{Type:Int32Array,size:8,setter:M},35668:{Type:Int32Array,size:12,setter:P},35669:{Type:Int32Array,size:16,setter:x},[m]:{Type:Uint32Array,size:4,setter:function(e,t){return r=>{e.uniform1ui(t,r)}},arraySetter:function(e,t){return r=>{e.uniform1uiv(t,r)}}},36294:{Type:Uint32Array,size:8,setter:function(e,t){return r=>{e.uniform2uiv(t,r)}}},36295:{Type:Uint32Array,size:12,setter:function(e,t){return r=>{e.uniform3uiv(t,r)}}},36296:{Type:Uint32Array,size:16,setter:function(e,t){return r=>{e.uniform4uiv(t,r)}}},35670:{Type:Uint32Array,size:4,setter:R,arraySetter:w},35671:{Type:Uint32Array,size:8,setter:M},35672:{Type:Uint32Array,size:12,setter:P},35673:{Type:Uint32Array,size:16,setter:x},35674:{Type:Float32Array,size:16,setter:function(e,t){return r=>{e.uniformMatrix2fv(t,!1,r)}}},35675:{Type:Float32Array,size:36,setter:function(e,t){return r=>{e.uniformMatrix3fv(t,!1,r)}}},35676:{Type:Float32Array,size:64,setter:function(e,t){return r=>{e.uniformMatrix4fv(t,!1,r)}}},35685:{Type:Float32Array,size:24,setter:function(e,t){return r=>{e.uniformMatrix2x3fv(t,!1,r)}}},35686:{Type:Float32Array,size:32,setter:function(e,t){return r=>{e.uniformMatrix2x4fv(t,!1,r)}}},35687:{Type:Float32Array,size:24,setter:function(e,t){return r=>{e.uniformMatrix3x2fv(t,!1,r)}}},35688:{Type:Float32Array,size:48,setter:function(e,t){return r=>{e.uniformMatrix3x4fv(t,!1,r)}}},35689:{Type:Float32Array,size:32,setter:function(e,t){return r=>{e.uniformMatrix4x2fv(t,!1,r)}}},35690:{Type:Float32Array,size:48,setter:function(e,t){return r=>{e.uniformMatrix4x3fv(t,!1,r)}}},35678:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:E},35680:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:_},35679:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:v},35682:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:E},36289:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:b},36292:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:b},36293:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:_},36298:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:E},36299:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:v},36300:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:_},36303:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:b},36306:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:E},36307:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:v},36308:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:_},36311:{Type:null,size:0,setter:U,arraySetter:D,bindPoint:b}};function I(e,t,r){return n=>{e.bindBuffer(e.ARRAY_BUFFER,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.itemSize,g,n.normalize||!1,n.stride||0,n.offset||0)}}function z(e,t,r){return n=>{e.bindBuffer(e.ARRAY_BUFFER,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.itemSize,y,n.stride||0,n.offset||0)}}function B(e,t,r){const n=r.size,i=r.count;return r=>{e.bindBuffer(e.ARRAY_BUFFER,r.buffer);const s=n,a=s/i,o=L[5126].size*s,u=r.normalize||!1,l=r.offset||0,f=o/i;for(let r=0;r<i;++r)e.enableVertexAttribArray(t+r),e.vertexAttribPointer(t+r,a,g,u,o,l+f*r)}}const O={[g]:{size:4,setter:I,itemSize:1},35664:{size:8,setter:I,itemSize:2},35665:{size:12,setter:I,itemSize:3},35666:{size:16,setter:I,itemSize:4},[y]:{size:4,setter:z,itemSize:1},35667:{size:8,setter:z,itemSize:2},35668:{size:12,setter:z,itemSize:3},35669:{size:16,setter:z,itemSize:4},[m]:{size:4,setter:z,itemSize:1},36294:{size:8,setter:z,itemSize:2},36295:{size:12,setter:z,itemSize:3},36296:{size:16,setter:z,itemSize:4},35670:{size:4,setter:z,itemSize:1},35671:{size:8,setter:z,itemSize:2},35672:{size:12,setter:z,itemSize:3},35673:{size:16,setter:z,itemSize:4},35674:{size:4,setter:B,count:2},35675:{size:9,setter:B,count:3},35676:{size:16,setter:B,count:4}};function N(e,t){if(t.enable)for(const r of t.enable)e.enable(r);if(t.disable)for(const r of t.disable)e.disable(r);t.blendFunc&&e.blendFunc.apply(e,t.blendFunc),null!=t.depthFunc&&e.depthFunc(t.depthFunc),null!=t.cullFace&&e.cullFace(t.cullFace),null!=t.frontFace&&e.frontFace(t.frontFace),null!=t.lineWidth&&e.lineWidth(t.lineWidth),t.colorMask&&e.colorMask.apply(e,t.colorMask),null!=t.depthMask&&e.depthMask(t.depthMask),t.clearColor&&e.clearColor.apply(e,t.clearColor),null!=t.clearDepth&&e.clearDepth(t.clearDepth),null!=t.clearBits&&e.clear(t.clearBits)}function C(e,t){if(t.enable)for(const r of t.enable)e.disable(r);if(t.disable)for(const r of t.disable)e.enable(r)}Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Uint16Array,Uint16Array,Uint16Array,Uint16Array,Uint32Array,Uint32Array,Uint32Array,Uint32Array,Uint32Array;let k=1;class G{constructor(e,t="Form"+k++){this._painter=e,this.id=t}update(e){const t=this._painter.gl;e.drawType&&(this._drawType=t[e.drawType]),e.itemCount&&(this._itemCount=e.itemCount),this._attribs=this._attribs||{};for(const r in e.attribs){const n=e.attribs[r];null==this._attribs[r]&&(this._attribs[r]={buffer:t.createBuffer()}),t.bindBuffer(t.ARRAY_BUFFER,this._attribs[r].buffer),t.bufferData(t.ARRAY_BUFFER,n.buffer,t[(n.storeType||"STATIC")+"_DRAW"])}if(e.elements){const r=e.elements.buffer;null==this._elements&&(this._elements={buffer:t.createBuffer(),glType:null}),this._elements.glType=function(e){if(e instanceof Int8Array)return 5120;if(e instanceof Uint8Array)return 5121;if(e instanceof Uint8ClampedArray)return 5121;if(e instanceof Int16Array)return 5122;if(e instanceof Uint16Array)return 5123;if(e instanceof Int32Array)return y;if(e instanceof Uint32Array)return m;if(e instanceof Float32Array)return g;throw new Error("unsupported typed array type")}(r),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._elements.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t[(e.elements.storeType||"STATIC")+"_DRAW"])}return this}destroy(){const e=this._painter.gl;for(const t in this._attribs)e.deleteBuffer(this._attribs[t].buffer);this._attribs={},this._elements&&(e.deleteBuffer(this._elements.buffer),this._elements=void 0)}}let $=1;class j{constructor(e,t="Texture"+$++){this._painter=e,this.id=t,this._texture=null,this._data={}}update(e){const t=this._painter.gl;if(null==this._texture&&(this._texture=t.createTexture()),t.bindTexture(t.TEXTURE_2D,this._texture),e.wrap&&e.wrap!==this._data.wrap||e.wrapS&&e.wrapS!==this._data.wrapS||e.wrapT&&e.wrapT!==this._data.wrapT){let r,n;e.wrap?r=n=e.wrap:(n=e.wrapT||A,r=e.wrapS||A),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[r]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[n])}else this._data.wrap||this._data.wrapS||this._data.wrapT||(this._data.wrap=this._data.wrapT=this._data.wrapS=A,t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[this._data.wrap]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[this._data.wrap]));return e.magFilter&&e.magFilter!==this._data.magFilter?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[e.magFilter]):this._data.magFilter||(this._data.magFilter="NEAREST",t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[this._data.magFilter])),e.minFilter&&e.minFilter!==this._data.minFilter?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[e.minFilter]):this._data.minFilter||(this._data.minFilter="LINEAR",t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[this._data.minFilter])),e.asset&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.asset),void 0!==e.data&&t.texImage2D(t.TEXTURE_2D,0,"FLOAT"===e.type&&this._painter.isWebGL2?t.RGBA32F:t.RGBA,e.width,e.height,0,t.RGBA,t[e.type||"UNSIGNED_BYTE"],e.data),null!=e.flipY&&e.flipY!==this._data.flipY&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY),e.minFilter&&e.minFilter.indexOf("MIPMAP")>0&&t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),Object.assign(this._data,e),this}destroy(){this._painter.gl.deleteTexture(this._texture),this._data={},this._texture=null}}let X=1;class W{constructor(e,t="Form"+X++){this._painter=e,this.id=t,this.width=0,this.height=0,this.antialias=!1,this.frameBuffer=null,this.antiAliasFrameBuffer=null,this.antiAliasRenderBuffer=null,this.textures=[],this.depthBuffer=null,this.bufferStructure=[],this._data={}}update(e){var t;const r=this._painter.gl,n=e.width||this.width,i=e.height||this.height;if(!n||!i)return this;if(n===this.width&&i===this.height){if(!e.bufferStructure)return this;if(e.bufferStructure.length===this.bufferStructure.length&&this.bufferStructure.every(((t,r)=>function(e,t){if(e===t)return!0;if(!t)return!1;const r=Object.keys(e);if(!function(e,t){if(e===t)return!0;if(!t||!e)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(r,Object.keys(t)))return!1;for(const n of r)if(e[n]!==t[n])return!1;return!0}(t,e.bufferStructure[r]))))return this}null==this.frameBuffer&&(this.frameBuffer=r.createFramebuffer()),null==this.depthBuffer&&(this.depthBuffer=r.createRenderbuffer()),e.bufferStructure&&e.bufferStructure.length&&(this.bufferStructure=e.bufferStructure,this.bufferStructure.some((e=>"FLOAT"===e.type))&&(this._painter.isWebGL2?r.getExtension("EXT_color_buffer_float"):r.getExtension("OES_texture_float")));const s=this.bufferStructure.length||1,a=[r.COLOR_ATTACHMENT0];if(r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer),s>1){let e;this._painter.isWebGL2||(e=r.getExtension("WEBGL_draw_buffers"));const t=this._painter.isWebGL2?r.COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0_WEBGL;for(let e=0;e<s;e++)a[e]=t+e;this._painter.isWebGL2?r.drawBuffers(a):e.drawBuffersWEBGL(a)}if(this.antialias=1===s&&this._painter.isWebGL2&&(e.antialias||(null===(t=this._data)||void 0===t?void 0:t.antialias)),this.antialias){const e=r;null==this.antiAliasFrameBuffer&&(this.antiAliasFrameBuffer=r.createFramebuffer()),null==this.antiAliasRenderBuffer&&(this.antiAliasRenderBuffer=r.createRenderbuffer()),r.bindFramebuffer(r.FRAMEBUFFER,this.antiAliasFrameBuffer),r.bindRenderbuffer(r.RENDERBUFFER,this.antiAliasRenderBuffer),e.renderbufferStorageMultisample(r.RENDERBUFFER,Math.min(4,r.getParameter(e.MAX_SAMPLES)),e.RGBA8,n,i),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,this.antiAliasRenderBuffer),r.bindRenderbuffer(r.RENDERBUFFER,this.depthBuffer),e.renderbufferStorageMultisample(r.RENDERBUFFER,Math.min(4,r.getParameter(e.MAX_SAMPLES)),r.DEPTH_COMPONENT16,n,i),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer),r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer)}else r.bindRenderbuffer(r.RENDERBUFFER,this.depthBuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,n,i),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer);for(let e=0;e<s;e++){this.textures[e]||(this.textures[e]=new j(this._painter,this.id+"_Texture"+e));const t=this.textures[e];t.update(Object.assign(Object.assign({minFilter:"NEAREST",magFilter:"NEAREST"},this.bufferStructure[e]),{data:null,width:n,height:i})),r.framebufferTexture2D(r.FRAMEBUFFER,a[e],r.TEXTURE_2D,t._texture,0)}if(this.antialias){r.bindFramebuffer(r.FRAMEBUFFER,this.antiAliasFrameBuffer);const t=r.checkFramebufferStatus(r.FRAMEBUFFER);t!==r.FRAMEBUFFER_COMPLETE&&console.error("antialias framebuffer error",t,e),r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer)}const o=r.checkFramebufferStatus(r.FRAMEBUFFER);return o!==r.FRAMEBUFFER_COMPLETE&&console.error("framebuffer error",o,e),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),Object.assign(this._data,e),this.width=n,this.height=i,this}destroy(){const e=this._painter.gl;e.deleteFramebuffer(this.frameBuffer),e.deleteRenderbuffer(this.depthBuffer);for(const t of this.textures)e.deleteTexture(t);this.antiAliasFrameBuffer&&e.deleteFramebuffer(this.antiAliasFrameBuffer),this.antiAliasRenderBuffer&&e.deleteRenderbuffer(this.antiAliasRenderBuffer),this.textures=[],this.frameBuffer=null,this.depthBuffer=null,this._data={},this.bufferStructure=[],this.width=0,this.height=0}}let q=1;class H{constructor(e,t="Frame"+q++){this._painter=e,this.id=t,this.width=0,this.height=0,this.layers=[],this._data={},this._targets=[],this._textures=[]}image(e=0){return this._targets.length&&this._targets[this._targets.length-1].textures[e]||this._textures[e]}update(t={}){var r,n,i,s;const a=this._painter.gl,o=Array.isArray(t.layers)?t.layers:t.layers?[t.layers]:this.layers,u=t.selfReferencing||this._data.selfReferencing,l=o.reduce(((e,t)=>e+(t._uniforms.length||1)),0),f=u||l>1?2:l,c=t.width||(null===(r=t.texture)||void 0===r?void 0:r.width)||this._data.width||(null===(n=this._data.texture)||void 0===n?void 0:n.width)||a.canvas.width,h=t.height||(null===(i=t.texture)||void 0===i?void 0:i.height)||this._data.height||(null===(s=this._data.texture)||void 0===s?void 0:s.height)||a.canvas.height,d=t.antialias||this._data.antialias||!0;f!==this._targets.length&&this._destroyTargets();const p=Object.assign(Object.assign({},t),{width:c,height:h,antialias:d});return!this._targets.length&&f>0?this._targets=e((e=>new W(this._painter,this.id+"_target"+(e+1)).update(p)),f):this._targets.length&&this._targets.forEach((e=>{e.update(p)})),t.texture&&(this._textures[0]||(this._textures[0]=new j(this._painter,this.id+"_Texture0")),t.texture.width=c,t.texture.height=h,this._textures[0].update(t.texture)),Object.assign(this._data,t),this.layers=o,this.width=c,this.height=h,this}destroy(){this._destroyTargets(),this._textures.forEach((e=>e.destroy())),this._textures=[],this._data={},this.layers=[],this.width=0,this.height=0}_destroyTargets(){this._targets.forEach((e=>e.destroy())),this._targets=[]}_swapTargets(){if(this._targets.length>1){const e=this._targets[0];this._targets[0]=this._targets[1],this._targets[1]=e}}}let Y=1;class K{constructor(e="DrawingLayer"+Y++){this.id=e,this.sketches=[],this._data={},this._uniforms=[]}update(e){if(e.sketches&&(this.sketches=Array.isArray(e.sketches)?e.sketches:[e.sketches]),e.frag){const t=this.sketches&&this.sketches[0];t&&t.shade.update({frag:e.frag})}return e.uniforms&&(this._uniforms=Array.isArray(e.uniforms)?e.uniforms:[e.uniforms]),Object.assign(this._data,e),this}destroy(){for(const e of this.sketches)e.destroy();this._data.sketches=[],this._data={},this._uniforms=[]}}let V=1;class Q{constructor(e,t="Shade"+V++){this._painter=e,this.id=t}update(e){const t=this._painter.gl,r=e.frag&&e.frag.trim()||this.fragSource,n=e.vert&&e.vert.trim()||this.vertSource;if(!r||!n||r===this.fragSource&&n===this.vertSource)return this;this.destroy(),r.indexOf("GL_EXT_draw_buffers")>=0&&t.getExtension("WEBGL_draw_buffers");const i=t.createProgram(),s=t.createShader(t.FRAGMENT_SHADER),a=t.createShader(t.VERTEX_SHADER);if(i&&a&&s){if(this._program=i,this._frag=s,this._vert=a,t.attachShader(i,a),t.attachShader(i,s),t.shaderSource(a,n),t.shaderSource(s,r),t.compileShader(a),t.compileShader(s),t.getShaderParameter(a,t.COMPILE_STATUS)||console.error("Error Compiling Vertex Shader!\n",t.getShaderInfoLog(a),Z(n)),t.getShaderParameter(s,t.COMPILE_STATUS)||console.error("Error Compiling Fragment Shader!\n",t.getShaderInfoLog(s),Z(r)),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const e=t.getProgramInfoLog(i);console.error("Error in program linking:",e)}return this._uniformSetters=function(e,t){let r=0;function n(t,n){const i=e.getUniformLocation(t,n.name),s=n.size>1&&"[0]"===n.name.substr(-3),a=n.type,o=L[a];if(!o)throw new Error("unknown type: 0x"+a.toString(16));if(null==i)return;let u;if(null===o.Type){const t=r;r+=n.size,u=s?o.arraySetter(e,a,t,i,n.size):o.setter(e,a,t,i)}else u=o.arraySetter&&s?o.arraySetter(e,i):o.setter(e,i);return{setter:u,location:i}}const i={},s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<s;++r){const s=e.getActiveUniform(t,r);if(!s)continue;let a=s.name;if("[0]"===a.substr(-3)&&(a=a.substr(0,a.length-3)),t){const e=n(t,s);e&&(i[a]=e)}}return i}(t,i),this._attributeSetters=function(e,t){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const n=e.getActiveAttrib(t,i);if(!n)break;const s=e.getAttribLocation(t,n.name),a=O[n.type],o=a.setter(e,s,a);r[n.name]={setter:o,location:s}}return r}(t,i),this.fragSource=r,this.vertSource=n,this}}destroy(){const e=this._painter.gl;e.deleteProgram(this._program),e.deleteShader(this._frag),e.deleteShader(this._vert),this.vertSource=void 0,this.fragSource=void 0,this._attributeSetters={},this._uniformSetters={}}}function Z(e){return e.trim().split("\n").map(((e,t)=>t+1+": "+e)).join("\n")}let J=1;class ee{constructor(e="Sketch"+J++){this.id=e,this._uniforms=[]}update(e){return e.drawSettings&&(this._drawSettings=e.drawSettings),e.form&&(this.form=e.form),e.shade&&(this.shade=e.shade),e.uniforms&&(this._uniforms=Array.isArray(e.uniforms)?e.uniforms:[e.uniforms]),this}destroy(){this.form&&this.form.destroy(),this.shade&&this.shade.destroy(),this._drawSettings=void 0,this._uniforms=[]}}class te{constructor(e,t={}){this.canvas=e,this.isWebGL2=!0,this.maxBufferSamples=0;let r=null;if(t.useWebGL1||(r=e.getContext("webgl2",t)||e.getContext("experimental-webgl2",t)),null==r&&(this.isWebGL2=!1,r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)),null==r)throw Error("Cannot initialize WebGL.");this.gl=r,this.sizeMultiplier=t.sizeMultiplier||1,this.isWebGL2&&(this.maxBufferSamples=r.getParameter(r.MAX_SAMPLES)),this.resize(),N(r,function(e){return{clearColor:[0,0,0,1],blendFunc:[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA]}}(r)),this._renderQuad=this.createForm().update(T.renderQuad),this._staticSketch=this.createFlatSketch()}resize(){return function(e,t=1){let r=e.width,n=e.height;if("clientWidth"in e){const i=e.getBoundingClientRect();r=i.width*t|0,n=i.height*t|0}(e.width!==r||e.height!==n)&&(e.width=r,e.height=n)}(this.gl.canvas,this.sizeMultiplier),this}destroy(){this._staticSketch.destroy(),this._renderQuad.destroy()}updateDrawSettings(e){return N(this.gl,Object.assign({},e)),this}createForm(e){return new G(this,e)}createShade(e){return new Q(this,e)}createSketch(e){return new ee(e)}createFlatSketch(e){const t=this.createSketch(e);return t.update({form:this._renderQuad,shade:this.createShade(t.id+"_defaultShade").update(F)})}createFrame(e){return new H(this,e)}createLayer(e){return new K(e)}createEffect(e){const t=this.createLayer(e);return t.update({sketches:this.createFlatSketch(t.id+"_effectSketch")})}draw(e,t){const r=this.gl;return r.bindFramebuffer(r.FRAMEBUFFER,null),r.viewport(0,0,r.canvas.width,r.canvas.height),re(r,e,t),this}compose(...e){for(const t of e)ae(this.gl,t);return this}display(e,t=0){return this.draw(this._staticSketch,{source:e.image(t)})}}function re(e,t,r,n){const{shade:i,form:s,_drawSettings:a,_uniforms:o}=t;if(!i||!s)throw Error("cannot draw, shader or geometry are not set");e.useProgram(i._program),function(e,t){for(const r in t._attribs){const n=e._attributeSetters[r];n&&n.setter(t._attribs[r])}}(i,s),r&&ie(i,r,n),a&&N(e,a);for(let r=0;r<(o.length||1);r++)ne(e,t,o[r],n);a&&C(e,a)}function ne(e,t,r,n){r&&ie(t.shade,r,n),t.form._elements&&null!=t.form._elements.glType?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.form._elements.buffer),e.drawElements(t.form._drawType,t.form._itemCount,t.form._elements.glType,0)):e.drawArrays(t.form._drawType,0,t.form._itemCount)}function ie(e,t,r){for(const n in t){const i=e._uniformSetters[n];if(i){let e=t[n];"function"==typeof e&&(e=e()),"string"==typeof e&&r?i.setter(r[e]):i.setter(e)}}}function se(e,t,r,n,i){n?(e.bindFramebuffer(e.FRAMEBUFFER,n.antialias?n.antiAliasFrameBuffer:n.frameBuffer),e.viewport(0,0,n.width,n.height)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height)),t._data.drawSettings&&N(e,t._data.drawSettings);for(const n of t.sketches)re(e,n,r,i);if(n&&n.antialias){const t=e;e.bindFramebuffer(t.READ_FRAMEBUFFER,n.antiAliasFrameBuffer),e.bindFramebuffer(t.DRAW_FRAMEBUFFER,n.frameBuffer),t.clearBufferfv(t.COLOR,0,[1,1,1,1]),t.blitFramebuffer(0,0,n.width,n.height,0,0,n.width,n.height,e.COLOR_BUFFER_BIT,e.LINEAR)}t._data.drawSettings&&C(e,t._data.drawSettings)}function ae(e,t){for(let r=0;r<t.layers.length;r++){const n=t.layers[r],i=n._uniforms.length||1;for(let s=0;s<i;s++){const i=t._targets[0],a=r+s===0&&t._textures.length?t._textures:t._targets[1]&&t._targets[1].textures;se(e,n,n._uniforms[s],i,a),t._swapTargets()}}}const oe=2;let ue,le;const fe={};function ce(e){return fe[e]||(fe[e]=le.createForm("Form_"+e))}const he={};function de(e){return he[e]||(he[e]=le.createShade("Shade_"+e))}const pe={};function ge(e){return pe[e]||(pe[e]=le.createSketch("Sketch_"+e))}const ye={};function me(e){return ye[e]||(ye[e]=le.createLayer("Layer_"+e))}const Ee={};function _e(e){return Ee[e]||(Ee[e]=le.createFrame("Frame_"+e))}const ve={};function be(e){return ve[e]||(ve[e]=le.createEffect("Effect_"+e))}const Ae={device:{tpf:0,sizeMultiplier:1}};window.state=Ae;const Te={},Fe={FRAME:"frame",RESIZE:"resize"};let Se,Re,we;const Me=function(e,t){return e!==ue&&(ue=e,le=new te(e,void 0),Ae.device.canvas=e,Se&&Se(),Re&&Re(),we&&we(),Se=function(e){function t(){e({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",t),t(),function(){window.removeEventListener("resize",t)}}((()=>{return e=()=>{le.sizeMultiplier=Ae.device.sizeMultiplier,le.resize(),r(Fe.RESIZE)},t=(t="resize")||e.name||f++,o=o||{},o[t]=e,void(l||(requestAnimationFrame(h),l=!0));var e,t})),Re=function(e,t){const r=t||e,{element:n=document,enableRightButton:i,holdDelay:s=400,holdRadius:a=5}=e,o={pressed:{},drag:{x:0,y:0,dX:0,dY:0,xMax:0,yMax:0},dragging:!1,holding:!1};let u=0,l=0,f=0,c=0,h=null;function d(e){e.isPrimary?(o.pressed[e.button]=e,u=f=e.clientX,l=c=e.clientY,o.dragging=!0,null!=h&&clearTimeout(h),h=setTimeout((()=>{o.drag.xMax<a&&o.drag.yMax<a&&(o.holding=!0,r(o))}),s)):o.pressed[oe]=e,r(o)}function p(e){o.pressed={},delete o.drag.event,o.drag.x=0,o.drag.y=0,o.drag.dX=0,o.drag.dY=0,o.drag.xMax=0,o.drag.yMax=0,o.dragging=!1,o.holding=!1,null!=h&&clearTimeout(h),h=null,r(o)}function g(e){o.dragging&&e.isPrimary&&(o.drag.event=e,o.drag.x=u-e.clientX,o.drag.y=l-e.clientY,o.drag.dX=f-e.clientX,o.drag.dY=c-e.clientY,o.drag.xMax=Math.max(Math.abs(o.drag.x),o.drag.xMax),o.drag.yMax=Math.max(Math.abs(o.drag.y),o.drag.yMax),f=e.clientX,c=e.clientY,r(o))}function y(e){e.preventDefault()}return n.addEventListener("pointerdown",d),document.addEventListener("pointermove",g),document.addEventListener("pointerup",p),document.addEventListener("pointerleave",p),document.addEventListener("pointercancel",p),i&&n.addEventListener("contextmenu",y),r(o),function(){n.removeEventListener("pointerdown",d),document.removeEventListener("pointermove",g),document.removeEventListener("pointerup",p),document.removeEventListener("pointerleave",p),document.removeEventListener("pointercancel",p),i&&n.removeEventListener("contextmenu",y)}}({element:e,enableRightButton:!0,holdRadius:7,holdDelay:250},(e=>Ae.device.pointer=e)),we=function(e,t){const r=t||e,{element:n=window}=e,i={};function s(e){i[e.keyCode]=Date.now(),r(i)}function a(e){delete i[e.keyCode],r(i)}return n.addEventListener("keyup",a,!1),n.addEventListener("keydown",s,!1),r(i),function(){n.removeEventListener("keyup",a),n.removeEventListener("keydown",s)}}((e=>Ae.device.keys=e))),{painter:le,gl:le.gl,getForm:ce,getShade:de,getSketch:ge,getLayer:me,getFrame:_e,getEffect:be,state:Ae,get:function(e){return Ae[e]},set:function(e,t,r){const n=Ae;if(n[e]){const i=r&&r.reset;!0!==i&&(t=p(t,n[e],{ignore:i}))}n[e]=t},listen:function(e,t,r){Te[t]||(Te[t]={}),Te[t][e]=r},emit:r};function r(e){const t=Te[e];if(t)for(const e in t)t[e](Ae)}}(document.getElementById("canvas")),Pe=Object.assign({},Fe);Math.PI;const xe=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let e=0;e<=256;e++)xe[256+e]=xe[e];const Ue=.5*(Math.sqrt(3)-1),De=(3-Math.sqrt(3))/6,Le=(Math.sqrt(5)-1)/4,Ie=(5-Math.sqrt(5))/20,ze=new Uint8Array(256),Be=new Uint8Array(512),Oe=new Uint8Array(512);for(let e=0;e<256;e++)ze[e]=256*Math.random();for(let e=0;e<512;e++)Be[e]=ze[255&e],Oe[e]=Be[e]%12;const Ne=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Ce=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);function ke(e,t){let r=0,n=0,i=0;const s=(e+t)*Ue,a=Math.floor(e+s),o=Math.floor(t+s),u=(a+o)*De,l=e-(a-u),f=t-(o-u);let c,h;l>f?(c=1,h=0):(c=0,h=1);const d=l-c+De,p=f-h+De,g=l-1+2*De,y=f-1+2*De,m=255&a,E=255&o;let _=.5-l*l-f*f;if(_>=0){const e=3*Oe[m+Be[E]];_*=_,r=_*_*(Ne[e]*l+Ne[e+1]*f)}let v=.5-d*d-p*p;if(v>=0){const e=3*Oe[m+c+Be[E+h]];v*=v,n=v*v*(Ne[e]*d+Ne[e+1]*p)}let b=.5-g*g-y*y;if(b>=0){const e=3*Oe[m+1+Be[E+1]];b*=b,i=b*b*(Ne[e]*g+Ne[e+1]*y)}return 70*(r+n+i)}function Ge(e,t,r,n){let i,s,a,o,u;const l=(e+t+r+n)*Le,f=Math.floor(e+l),c=Math.floor(t+l),h=Math.floor(r+l),d=Math.floor(n+l),p=(f+c+h+d)*Ie,g=e-(f-p),y=t-(c-p),m=r-(h-p),E=n-(d-p);let _,v,b,A,T,F,S,R,w,M,P,x,U=0,D=0,L=0,I=0;g>y?U++:D++,g>m?U++:L++,g>E?U++:I++,y>m?D++:L++,y>E?D++:I++,m>E?L++:I++,_=U>=3?1:0,v=D>=3?1:0,b=L>=3?1:0,A=I>=3?1:0,T=U>=2?1:0,F=D>=2?1:0,S=L>=2?1:0,R=I>=2?1:0,w=U>=1?1:0,M=D>=1?1:0,P=L>=1?1:0,x=I>=1?1:0;const z=g-_+Ie,B=y-v+Ie,O=m-b+Ie,N=E-A+Ie,C=g-T+2*Ie,k=y-F+2*Ie,G=m-S+2*Ie,$=E-R+2*Ie,j=g-w+3*Ie,X=y-M+3*Ie,W=m-P+3*Ie,q=E-x+3*Ie,H=g-1+4*Ie,Y=y-1+4*Ie,K=m-1+4*Ie,V=E-1+4*Ie,Q=255&f,Z=255&c,J=255&h,ee=255&d;let te=.6-g*g-y*y-m*m-E*E;if(te<0)i=0;else{const e=Be[Q+Be[Z+Be[J+Be[ee]]]]%32*4;te*=te,i=te*te*(Ce[e]*g+Ce[e+1]*y+Ce[e+2]*m+Ce[e+3]*E)}let re=.6-z*z-B*B-O*O-N*N;if(re<0)s=0;else{const e=Be[Q+_+Be[Z+v+Be[J+b+Be[ee+A]]]]%32*4;re*=re,s=re*re*(Ce[e]*z+Ce[e+1]*B+Ce[e+2]*O+Ce[e+3]*N)}let ne=.6-C*C-k*k-G*G-$*$;if(ne<0)a=0;else{const e=Be[Q+T+Be[Z+F+Be[J+S+Be[ee+R]]]]%32*4;ne*=ne,a=ne*ne*(Ce[e]*C+Ce[e+1]*k+Ce[e+2]*G+Ce[e+3]*$)}let ie=.6-j*j-X*X-W*W-q*q;if(ie<0)o=0;else{const e=Be[Q+w+Be[Z+M+Be[J+P+Be[ee+x]]]]%32*4;ie*=ie,o=ie*ie*(Ce[e]*j+Ce[e+1]*X+Ce[e+2]*W+Ce[e+3]*q)}let se=.6-H*H-Y*Y-K*K-V*V;if(se<0)u=0;else{const e=Be[Q+1+Be[Z+1+Be[J+1+Be[ee+1]]]]%32*4;se*=se,u=se*se*(Ce[e]*H+Ce[e+1]*Y+Ce[e+2]*K+Ce[e+3]*V)}return 27*(i+s+a+o+u)}function $e(e,t,r,n){const i=[];for(let s=0;s<t;s++)for(let a=0;a<e;a++){const o=a/e,u=s/t,l=Math.cos(2*o*Math.PI)*r/(2*Math.PI),f=Math.cos(2*u*Math.PI)*n/(2*Math.PI),c=Math.sin(2*o*Math.PI)*r/(2*Math.PI),h=Math.sin(2*u*Math.PI)*n/(2*Math.PI);i.push(Ge(l,f,c,h))}return i}function je(e,t,r=[]){for(let n=0;n<e.length;n++)r[n]=e[n]+t[n];return r}function Xe(e,t,r=[]){for(let n=0;n<e.length;n++)r[n]=e[n]-t[n];return r}function We(e,t,r=[]){for(let n=0;n<t.length;n++)r[n]=t[n]*e;return r}function qe(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];t+=n*n}return Math.sqrt(t)}var He="undefined"!=typeof Float32Array?Float32Array:Array;function Ye(){var e=new He(3);return He!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ke(e,t,r){var n=new He(3);return n[0]=e,n[1]=t,n[2]=r,n}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Ve(){var e=new He(4);return He!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}Ye(),function(){var e;e=new He(4),He!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Qe;function Ze(e,...t){return e.bind(null,...t)}function Je({vertex:e=[0,0,0],normal:t=[0,0,1],direction:r=[0,1,0],length:n=1}={}){return{vertex:e,normal:t,direction:r,length:n}}function et(e=1,t){e="number"==typeof e?e:e(t);const r=2===t.direction.length?[t.direction[1],-t.direction[0]]:function(e,t,r=[]){return r[0]=e[1]*t[2]-e[2]*t[1],r[1]=e[2]*t[0]-e[0]*t[2],r[2]=e[0]*t[1]-e[1]*t[0],r}(t.normal,t.direction);return[je(We(-e,r),t.vertex),je(We(e,r),t.vertex)]}function tt(e){return e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2}Ye(),Ke(1,0,0),Ke(0,1,0),Ve(),Ve(),Qe=new He(9),He!=Float32Array&&(Qe[1]=0,Qe[2]=0,Qe[3]=0,Qe[5]=0,Qe[6]=0,Qe[7]=0),Qe[0]=1,Qe[4]=1,Qe[8]=1,Ve(),Ve(),Ve(),Ve(),function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1}(Ve()),Ye(),Me.set("lines",{line1:[]});const rt=e=>"boolean"==typeof e,nt=e=>"number"==typeof e,it=(e,t=(e=>void 0!==e?": "+e:""))=>class extends Error{constructor(r){super(e(r)+t(r))}},st=it((()=>"unsupported operation")),at=e=>{throw new st(e)},ot=Object.getPrototypeOf,ut=/^[iub]?vec[234]$/,lt=/^mat[234]$/,ft=e=>ut.test(e.type),ct=e=>lt.test(e.type),ht=(e,t,r)=>({tag:"lit",type:e,info:r,val:t}),dt=e=>ht("bool",nt(e)?!!e:e),pt=e=>ht("float",rt(e)?1&e:e),gt=e=>ht("int",rt(e)?1&e:nt(e)?0|e:e),yt=e=>ht("uint",rt(e)?1&e:nt(e)?e>>>0:e),mt=(e,t)=>r=>nt(r)?t(r):void 0===r||ft(r)||r.type===e?r:t(r),Et=mt("float",pt),_t=mt("int",gt),vt=mt("uint",yt),bt=mt("bool",dt),At=(dt(!0),dt(!1)),Tt=pt(0),Ft=pt(1),St=pt(2),Rt=pt(.5),wt=gt(0),Mt=(gt(1),yt(0)),Pt=(yt(1),pt(Math.PI),pt(2*Math.PI),pt(Math.PI/2),pt(Math.SQRT2),(e,t)=>r=>[void 0===r[0]?t:e(r[0]),...r.slice(1).map(e)]),xt=Pt(Et,Tt),Ut=(Pt(_t,wt),Pt(vt,Mt),Pt(bt,At),(e,t)=>ft(e[0])?e[0].type[0]:t[e.length]);function Dt(...e){return((e,t,r)=>ht(e,r=t(r),Ut(r,["n","n"])))("vec2",xt,e)}function Lt(...e){return((e,t,r)=>ht(e,r=t(r),2===r.length?"vn":Ut(r,["n","n"])))("vec3",xt,e)}function It(...e){return((e,t,r)=>ht(e,r=t(r),2===r.length?ft(r[1])?"vv":"vn":Ut(r,["n","n",,"vnn"])))("vec4",xt,e)}const zt=(e,t)=>{const r=e.type[0];return"i"===r?gt(t):"u"===r?yt(t):"b"===r?dt(t):pt(t)};var Bt,Ot;(Ot=Bt||(Bt={}))[Ot.FINE=0]="FINE",Ot[Ot.DEBUG=1]="DEBUG",Ot[Ot.INFO=2]="INFO",Ot[Ot.WARN=3]="WARN",Ot[Ot.SEVERE=4]="SEVERE",Ot[Ot.NONE=5]="NONE";const Nt=Object.freeze({level:Bt.NONE,fine(){},debug(){},info(){},warn(){},severe(){}}),Ct=Symbol();let kt=Nt;const Gt=(e,t,r)=>{const n=t[r];if(n)for(let r of n){let n=e[r]||Gt(e,t,r);if(n)return n}},$t=(e,t,r)=>{const n=t[r];if(n)for(let r of n)e.push(r),$t(e,t,r);return e},jt=e=>{const t=function(e,t){const r={},n={},i=(...t)=>{const i=e(...t),s=r[i]||Gt(r,n,i)||r[Ct];return s?s(...t):at(`missing implementation for: "${i.toString()}"`)};return i.add=(e,t)=>(r[e]&&kt.warn(`overwriting '${e.toString()}' impl`),r[e]=t,!0),i.addAll=e=>{let t=!0;for(let r in e)t=i.add(r,e[r])&&t;return t},i.remove=e=>!!r[e]&&(delete r[e],!0),i.callable=(...t)=>{const i=e(...t);return!!(r[i]||Gt(r,n,i)||r[Ct])},i.isa=(e,t)=>{let r=n[e];!r&&(n[e]=r=new Set),r.add(t)},i.impls=()=>{const e=new Set(Object.keys(r));for(let t in n)Gt(r,n,t)&&e.add(t);return r[Ct]&&e.add(Ct),e},i.rels=()=>n,i.parents=e=>n[e],i.ancestors=e=>new Set($t([],n,e)),i.dependencies=function*(){for(let e in n)for(let t of n[e])yield[e,t];for(let e in r)!n[e]&&(yield[e,void 0])},i}((e=>e.tag));return t.add(Ct,(e=>at(`no impl for AST node type: '${e.tag}'`))),t.addAll(e),t},Xt=e=>"string"==typeof e,Wt=it((()=>"illegal argument(s)")),qt=e=>{throw new Wt(e)};let Ht=0;const Yt=()=>`_s${(Ht++).toString(36)}`;function Kt(e,...t){let r,n,i;switch(t.length){case 0:Xt(e)||(i=e,e=i.type);break;case 1:Xt(t[0])?r=t[0]:t[0].tag?i=t[0]:n=t[0];break;case 2:Xt(t[0])?[r,n]=t:[n,i]=t;break;case 3:[r,n,i]=t;break;default:qt()}return{tag:"sym",type:e,id:r||Yt(),opts:n||{},init:i}}const Vt=(e,t,r)=>Kt(e,t,Object.assign({q:"in",type:"in"},r));var Qt;!function(e){e.GLES_100="100",e.GLES_300="300 es"}(Qt||(Qt={}));const Zt=/[};]$/,Jt=e=>{const t=Object.assign({type:"fs",version:Qt.GLES_300,versionPragma:!0,prelude:""},e),r="vs"===t.type,n=(e,t=", ")=>e.map(a).join(t),i=e=>`${e.id}(${n(e.args)})`,s=(e,n=!1)=>{const{id:i,type:s,opts:o,init:u}=e,l=[];if(o.type){let e;t.version<Qt.GLES_300?r?e={in:"attribute",out:"varying",uni:"uniform"}[o.type]:(e={in:"varying",out:null,uni:"uniform"}[o.type],!e&&at("GLSL 100 doesn't support fragment shader output variables")):(null!=o.loc&&l.push(`layout(location=${o.loc}) `),null!=o.smooth&&l.push(o.smooth+" "),e="uni"===o.type?"uniform":o.type),l.push(e+" ")}else o.const&&l.push("const "),n&&o.q&&l.push(o.q+" ");return o.prec&&l.push(o.prec+" "),l.push((e=>e.replace("[]",""))(s)," ",i),o.num&&l.push(`[${o.num}]`),u&&l.push(" = ",a(u)),l.join("")},a=jt({arg:e=>s(e,!0),array_init:e=>t.version>=Qt.GLES_300?`${e.type}(${n(e.init)})`:at(`array initializers not available in GLSL ${t.version}`),assign:e=>a(e.l)+" = "+a(e.r),ctrl:e=>e.id,call:i,call_i:e=>"texture"===e.id&&t.version<Qt.GLES_300?`${e.id}${e.args[0].type.substr(7)}(${n(e.args)})`:i(e),decl:e=>s(e.id),fn:e=>`${e.type} ${e.id}(${n(e.args)}) ${a(e.scope)}`,for:e=>`for(${e.init?a(e.init):""}; ${a(e.test)}; ${e.iter?a(e.iter):""}) ${a(e.scope)}`,idx:e=>`${a(e.val)}[${a(e.id)}]`,if:e=>{const t=`if (${a(e.test)}) `+a(e.t);return e.f?t+" else "+a(e.f):t},lit:e=>{const t=e.val;switch(e.type){case"bool":return rt(t)?String(t):`bool(${a(t)})`;case"float":return nt(t)?t===Math.trunc(t)?t+".0":String(t):`float(${a(t)})`;case"int":case"uint":return nt(t)?String(t):`${e.type}(${a(t)})`;default:return ft(e)||ct(e)?`${e.type}(${n(t)})`:at(`unknown type: ${e.type}`)}},op1:e=>e.post?`(${a(e.val)}${e.op})`:`(${e.op}${a(e.val)})`,op2:e=>`(${a(e.l)} ${e.op} ${a(e.r)})`,ret:e=>"return"+(e.val?" "+a(e.val):""),scope:e=>{let r=e.body.map(a).reduce(((e,t)=>(e.push(Zt.test(t)?t:t+";"),e)),[]).join("\n");return r+=e.body.length&&!Zt.test(r)?";":"",e.global?(t.prelude&&(r=t.prelude+"\n"+r),t.versionPragma&&(r=`#version ${t.version}\n`+r),r):`{\n${r}\n}`},swizzle:e=>`${a(e.val)}.${e.id}`,sym:e=>e.id,ternary:e=>`(${a(e.test)} ? ${a(e.t)} : ${a(e.f)})`,while:e=>`while (${a(e.test)}) ${a(e.scope)}`});return Object.assign(a,{gl_FragColor:Kt("vec4","gl_FragColor"),gl_FragCoord:Kt("vec4","gl_FragCoord",{const:!0}),gl_FragData:Kt("vec4[]","gl_FragData",{num:1}),gl_FrontFacing:Kt("bool","gl_FrontFacing",{const:!0}),gl_PointCoord:Kt("vec2","gl_PointCoord",{const:!0}),gl_PointSize:Kt("float","gl_PointSize"),gl_Position:Kt("vec4","gl_Position")}),a},er=Array.isArray;function tr(e,t,r,n){var i,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(s<3?i(a):s>3?i(t,r,a):i(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a}Object.create,Object.create;const rr=Symbol(),nr=()=>{},ir=Object.getPrototypeOf({}),sr="function",ar="string",or=(e,t)=>{let r;return e===t||(null==e?e==t:typeof e.equiv===sr?e.equiv(t):null==t?e==t:typeof t.equiv===sr?t.equiv(e):typeof e!==ar&&typeof t!==ar&&(r=Object.getPrototypeOf(e),null!=r&&r!==ir||(r=Object.getPrototypeOf(t),null!=r&&r!==ir)?typeof e!==sr&&void 0!==e.length&&typeof t!==sr&&void 0!==t.length?ur(e,t):e instanceof Set&&t instanceof Set?lr(e,t):e instanceof Map&&t instanceof Map?fr(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:cr(e,t)))},ur=(e,t,r=or)=>{let n=e.length;if(n===t.length)for(;--n>=0&&r(e[n],t[n]););return n<0},lr=(e,t,r=or)=>e.size===t.size&&r([...e.keys()].sort(),[...t.keys()].sort()),fr=(e,t,r=or)=>e.size===t.size&&r([...e].sort(),[...t].sort()),cr=(e,t,r=or)=>{if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(!t.hasOwnProperty(n)||!r(e[n],t[n]))return!1;return!0};function hr(e,t){for(let r of t)e.delete(r);return e}const dr=e=>null!=e&&"function"==typeof e[Symbol.iterator],pr=(e,t)=>[e[0],e[1],t],gr=(e,t)=>null!=e&&"function"==typeof e[t];class yr{constructor(e){this.value=e}deref(){return this.value}}const mr=e=>e instanceof yr,Er=e=>e instanceof yr?e.deref():e;function*_r(e,t){const r=(n=e,gr(n,"xform")?n.xform():n)([nr,nr,(e,t)=>t])[2];var n;for(let e of t){let t=r(rr,e);if(mr(t))return t=Er(t.deref()),void(t!==rr&&(yield t));t!==rr&&(yield t)}}function vr(e,t){return dr(t)?_r(vr(e),t):t=>{const r=t[2];return pr(t,((t,n)=>r(t,e(n))))}}const br="object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node?r(758).inspect:null,Ar=(e,t)=>[...vr((e=>br(e,t)),e)].join(", "),Tr=(e,t)=>[...vr((([e,r])=>`${br(e,t)} => ${br(r,t)}`),e)].join(", "),Fr=((e,t={})=>{const r=Reflect.ownKeys(e),n=Reflect.ownKeys(t),i=Symbol("isa");function s(t){for(let n of r){const r=Object.getOwnPropertyDescriptor(t.prototype,n);!r||r.configurable?Object.defineProperty(t.prototype,n,{value:e[n],writable:!0}):console.log(`not patching: ${t.name}.${n.toString()}`)}return Object.defineProperty(t.prototype,i,{value:!0}),t}for(let e of n)Object.defineProperty(s,e,{value:t[e],enumerable:t.propertyIsEnumerable(e)});return Object.defineProperty(s,Symbol.hasInstance,{value:e=>!!e[i]}),s})({[Symbol.for("nodejs.util.inspect.custom")](e,t){const r=this[Symbol.toStringTag],n=Object.assign(Object.assign({},t),{depth:null===t.depth?null:t.depth-1});return e>=0?[`${r}(${this.size||0}) {`,br?this instanceof Set?Ar(this,n):this instanceof Map?Tr(this,n):"":"","}"].join(" "):t.stylize(`[${r}]`,"special")}});function Sr(e,t){if(e instanceof Map)for(let r of t)e.set(r[0],r[1]);else for(let r of t)e.add(r);return e}var Rr;const wr=new WeakMap,Mr=e=>wr.get(e).vals;let Pr=Rr=class extends Set{constructor(e,t={}){super(),wr.set(this,{equiv:t.equiv||or,vals:[]}),e&&this.into(e)}*[Symbol.iterator](){yield*Mr(this)}get[Symbol.species](){return Rr}get[Symbol.toStringTag](){return"ArraySet"}get size(){return Mr(this).length}copy(){const e=wr.get(this),t=new Rr(null,{equiv:e.equiv});return wr.get(t).vals=e.vals.slice(),t}empty(){return new Rr(null,this.opts())}clear(){Mr(this).length=0}first(){if(this.size)return Mr(this)[0]}add(e){return!this.has(e)&&Mr(this).push(e),this}into(e){return Sr(this,e)}has(e){return this.get(e,rr)!==rr}get(e,t){const r=wr.get(this),n=r.equiv,i=r.vals;for(let t=i.length;--t>=0;)if(n(i[t],e))return i[t];return t}delete(e){const t=wr.get(this),r=t.equiv,n=t.vals;for(let t=n.length;--t>=0;)if(r(n[t],e))return n.splice(t,1),!0;return!1}disj(e){return hr(this,e)}equiv(e){return((e,t)=>{if(e===t)return!0;if(!(t instanceof Set)||e.size!==t.size)return!1;for(let r of e.keys())if(!t.has(r))return!1;return!0})(this,e)}forEach(e,t){const r=Mr(this);for(let n=r.length;--n>=0;){const i=r[n];e.call(t,i,i,this)}}*entries(){for(let e of Mr(this))yield[e,e]}*keys(){yield*Mr(this)}*values(){yield*Mr(this)}opts(){return{equiv:wr.get(this).equiv}}};var xr;Pr=Rr=tr([Fr],Pr);const Ur=new WeakMap,Dr=e=>Ur.get(e).map;let Lr=xr=class extends Map{constructor(e,t){super();const r=Object.assign({equiv:or,keys:Pr},t);Ur.set(this,{keys:new r.keys(null,{equiv:r.equiv}),map:new Map,opts:r}),e&&this.into(e)}[Symbol.iterator](){return this.entries()}get[Symbol.species](){return xr}get[Symbol.toStringTag](){return"EquivMap"}get size(){return Ur.get(this).keys.size}clear(){const e=Ur.get(this);e.keys.clear(),e.map.clear()}empty(){return new xr(null,Ur.get(this).opts)}copy(){const e=Ur.get(this),t=new xr;return Ur.set(t,{keys:e.keys.copy(),map:new Map(e.map),opts:e.opts}),t}equiv(e){return((e,t)=>{if(e===t)return!0;if(!(t instanceof Map)||e.size!==t.size)return!1;for(let r of e.entries())if(!or(t.get(r[0]),r[1]))return!1;return!0})(this,e)}delete(e){const t=Ur.get(this);return(e=t.keys.get(e,rr))!==rr&&(t.map.delete(e),t.keys.delete(e),!0)}dissoc(e){return hr(this,e)}forEach(e,t){for(let r of Dr(this))e.call(t,r[1],r[0],this)}get(e,t){const r=Ur.get(this);return(e=r.keys.get(e,rr))!==rr?r.map.get(e):t}has(e){return Ur.get(this).keys.has(e)}set(e,t){const r=Ur.get(this),n=r.keys.get(e,rr);return n!==rr?r.map.set(n,t):(r.keys.add(e),r.map.set(e,t)),this}into(e){return Sr(this,e)}entries(){return Dr(this).entries()}keys(){return Dr(this).keys()}values(){return Dr(this).values()}opts(){return Ur.get(this).opts}};Lr=xr=tr([Fr],Lr);const Ir=(e,t,r)=>{if(e.size<t.size){const r=e;e=t,t=r}var n,i;return r=r?Sr(r,e):(n=e,i=Set,gr(n,"copy")?n.copy():new(n[Symbol.species]||i)(n)),e===t?r:Sr(r,t)};function zr(e,t){return dr(t)?_r(zr(e),t):t=>{const r=t[2];return pr(t,((t,n)=>e(n)?r(t,n):t))}}const Br=it((()=>"illegal arity"));function Or(...e){const t=e[0],r=t[0],n=t[1],i=t[2],s=null==(e=(e=>2===e.length?[void 0,e[1]]:3===e.length?[e[1],e[2]]:(e=>{throw new Br(e)})(e.length))(e))[0]?r():e[0],a=e[1];return Er(n(gr(a,"$reduce")?a.$reduce(i,s):null!=(o=a)&&"function"!=typeof o&&void 0!==o.length?Nr(i,s,a):Cr(i,s,a)));var o}const Nr=(e,t,r)=>{for(let n=0,i=r.length;n<i;n++)if(t=e(t,r[n]),mr(t)){t=t.deref();break}return t},Cr=(e,t,r)=>{for(let n of r)if(t=e(t,n),mr(t)){t=t.deref();break}return t};class kr{constructor(e){if(this.dependencies=new Lr,this.dependents=new Lr,e)for(let[t,r]of e)null!=r?this.addDependency(t,r):this.addNode(t)}*[Symbol.iterator](){yield*this.sort()}get[Symbol.species](){return kr}copy(){const e=new kr;for(let t of this.dependencies)e.dependencies.set(t[0],t[1].copy());for(let t of this.dependents)e.dependents.set(t[0],t[1].copy());return e}addNode(e){return!this.dependencies.has(e)&&this.dependencies.set(e,new Pr),this}addDependency(e,t){(or(e,t)||this.depends(t,e))&&qt(`Circular dependency between: ${e} & ${t}`);let r=this.dependencies.get(e);return this.dependencies.set(e,r?r.add(t):new Pr([t])),r=this.dependents.get(t),this.dependents.set(t,r?r.add(e):new Pr([e])),this}addDependencies(e,t){for(let r of t)this.addDependency(e,r)}removeEdge(e,t){let r=this.dependencies.get(e);return r&&r.delete(t),r=this.dependents.get(t),r&&r.delete(e),this}removeNode(e){return this.dependencies.delete(e),this}depends(e,t){return this.transitiveDependencies(e).has(t)}dependent(e,t){return this.transitiveDependents(e).has(t)}immediateDependencies(e){return this.dependencies.get(e)||new Pr}immediateDependents(e){return this.dependents.get(e)||new Pr}isLeaf(e){return 0===this.immediateDependents(e).size}isRoot(e){return 0===this.immediateDependencies(e).size}nodes(){return Ir(new Pr(this.dependencies.keys()),new Pr(this.dependents.keys()))}leaves(){return zr((e=>this.isLeaf(e)),this.nodes())}roots(){return zr((e=>this.isRoot(e)),this.nodes())}transitiveDependencies(e){return Gr(this.dependencies,e)}transitiveDependents(e){return Gr(this.dependents,e)}sort(){const e=[],t=this.copy();let r=new Pr(t.leaves());for(;;){if(!r.size)return e.reverse();const n=r.first();r.delete(n);for(let e of[...t.immediateDependencies(n)])t.removeEdge(n,e),t.isLeaf(e)&&r.add(e);e.push(n),t.removeNode(n)}}}const Gr=(e,t)=>{const r=e.get(t);return r?Or([null,e=>e,(t,r)=>Ir(t,Gr(e,r))],r,r):new Pr},$r=e=>"fn"===e.tag||"for"===e.tag||"while"==e.tag?e.scope.body:"if"===e.tag?e.f?e.t.body.concat(e.f.body):e.t.body:void 0,jr=e=>$r(e)||("scope"===e.tag?e.body:"ternary"===e.tag?[e.t,e.f]:"ret"===e.tag?[e.val]:"call"===e.tag||"call_i"===e.tag?e.args:"sym"===e.tag&&e.init?[e.init]:"decl"===e.tag?[e.id]:"op1"===e.tag||"swizzle"===e.tag?[e.val]:"op2"===e.tag?[e.l,e.r]:"assign"===e.tag?[e.r]:ft(e)||ct(e)||(e=>(e=>{let t;return null!=e&&"object"==typeof e&&(null===(t=ot(e))||null===ot(t))})(e)&&!!e.tag&&!!e.type)(e.val)?e.val:void 0),Xr=(e,t,r,n,i=!0)=>{if(er(n))n.forEach((n=>r=Xr(e,t,r,n,i)));else{i&&(r=e(r,n));const s=t(n);s&&(r=Xr(e,t,r,s,i)),!i&&(r=e(r,n))}return r},Wr=(e,t=new kr)=>e.deps&&e.deps.length?e.deps.reduce(((t,r)=>Wr(r,t.addDependency(e,r))),t):t.addNode(e),qr=(e,t=!1)=>({tag:"scope",type:"void",body:e.filter((e=>null!=e)).map((e=>{return"sym"===e.tag?{tag:"decl",type:(t=e).type,id:t}:e;var t})),global:t}),Hr=e=>{const t=e.filter((e=>"fn"!==e.tag)),r=e.reduce(((e,t)=>"fn"===t.tag?Wr(t,e):e),new kr);return qr(t.concat(r.sort()),!0)},Yr=(()=>{try{return"1"===process.env.UMBRELLA_ASSERTS}catch(e){}return!1})()?(e,t="assertion failed")=>{if("function"==typeof e&&!e()||!e)throw new Error("function"==typeof t?t():t)}:nr,Kr=e=>{const[t,r,n]=Xt(e)?[e]:e;return{tag:"arg",type:t,id:r||Yt(),opts:Object.assign({q:"in"},n)}};function Vr(e,t,r,n){t=t||Yt();const i=r.map(Kr),s=n(...i.map((e=>Kt(e.type,e.id,e.opts)))).filter((e=>null!=e)),a=Xr(((r,n)=>("ret"===n.tag&&(Yr(n.type===e,`wrong return type for function '${t}', expected ${e}, got ${n.type}`),r++),r)),$r,0,s);if("void"!==e&&!a)throw new Error(`function '${t}' must return a value of type ${e}`);const o=Xr(((e,t)=>("call"===t.tag&&t.fn&&e.push(t.fn),e)),jr,[],s),u=(...e)=>function(e,...t){return Xt(e)?{tag:"call",type:t[0],id:e,args:t.slice(1)}:{tag:"call",type:e.type,id:e.id,args:t,fn:e}}(u,...e);return Object.assign(u,{tag:"fn",type:e,id:t,args:i,deps:o,scope:qr(s)})}const Qr=e=>Vr("void","main",[],e),Zr=(e,t,...r)=>({tag:"call_i",type:t,id:e,args:r}),Jr=(e,t)=>(Yr("swizzle"!==e.tag||"sym"===e.val.tag,"can't assign to non-symbol swizzle"),{tag:"assign",type:e.type,l:e,r:t}),en={mave:"mv",vema:"vm",vefl:"vn",mafl:"vn",flve:"nv",flma:"nv",ivin:"vn",iniv:"nv",uvui:"vn",uiuv:"nv"},tn=(e,t,r,n,i)=>{const s=nt(t),a=nt(r);let o,u,l;return s?a?(u=pt(t),l=pt(r),o="float"):(l=r,u=zt(l,t),o=l.type):a?(u=t,l=zt(u,r),o=u.type):(u=t,l=r,o=n||(ft(u)?u.type:ft(l)||ct(l)?l.type:u.type)),{tag:"op2",type:n||o,info:i||en[u.type.substr(0,2)+l.type.substr(0,2)],op:e,l:u,r:l}};function rn(e,t){return tn("+",e,t)}function nn(e,t){return tn("-",e,t)}function sn(e,t){return tn("*",e,t,!nt(e)&&!nt(t)&&ct(e)&&ft(t)?t.type:void 0)}const an=e=>(t,r)=>tn(e,t,r,"bool"),on=(an("=="),an("!="));an("<"),an("<="),an(">"),an(">=");const un=e=>{const t=e.type[0],r=e.type.indexOf("Shadow")>0;return"s"===t?r?"float":"vec4":"i"===t?r?"int":"ivec4":"u"===t?r?"uint":"uvec4":qt(`unknown sampler type ${e.type}`)},ln=(e,t,r,n)=>{const i=n?Zr(e,un(t),t,...r,n):Zr(e,un(t),t,...r);return!ft(i)&&(i.info="n"),i};function fn(e,t){const r=e.type[0],n=(e,r)=>1===t.length?e:r+t.length;return{tag:"swizzle",type:"i"===r?n("int","ivec"):"u"===r?n("uint","uvec"):"b"===r?n("bool","bvec"):n("float","vec"),val:e,id:t}}const cn=e=>fn(e,"y"),hn=e=>fn(e,"z"),dn=e=>fn(e,"w"),pn=e=>t=>Zr(e,t.type,t),gn=e=>(t,r)=>Zr(e,t.type,t,r),yn=e=>(t,r,n)=>Zr(e,t.type,t,r,n);gn("min"),gn("max"),yn("clamp"),gn("step"),yn("smoothstep"),pn("radians"),pn("degrees"),pn("cos"),pn("sin"),pn("tan"),pn("acos"),pn("asin");const mn=gn("pow");function En(e,t,r){const n=Zr("mix",e.type,e,t,r);return"float"===r.type&&(n.info="n"),n}pn("exp"),pn("log"),pn("exp2"),pn("log2"),pn("sqrt"),pn("inversesqrt"),pn("abs"),pn("sign"),pn("floor"),pn("ceil"),pn("fract");const _n=e=>({tag:"ctrl",type:"void",id:e}),vn=(_n("break"),_n("continue"),_n("discard"),Vr("float","fitNorm1",["float","float","float"],((e,t,r)=>{return[(i=on(t,r),o=nn(e,t),u=nn(r,t),s=tn("/",o,u),a=Tt,n={tag:"ternary",type:s.type,test:i,t:s,f:a},{tag:"ret",type:n?n.type:"void",val:n})];var n,i,s,a,o,u})),e=>nn(sn(e,St),Ft)),bn=((e="precision mediump float;")=>Jt({version:Qt.GLES_100,type:"fs",prelude:e}))(),An=Jt({version:Qt.GLES_100,type:"vs"});let Tn,Fn,Sn,Rn;const wn=An(Hr([Sn=Vt("vec2","position"),Rn=Vt("vec2","uv"),("vec2","vUv",Fn=Kt("vec2","vUv",Object.assign({q:"out",type:"out"},undefined))),Qr((()=>[Jr(Fn,Rn),Jr(An.gl_Position,It(sn(Sn,Dt(1,-1)),0,1))]))]));let Mn,Pn,xn;const Un=bn(Hr([Mn=Kt("sampler2D","noiseTex",Object.assign({q:"in",type:"uni"},void 0)),Tn=Vt("vec3","vNormal"),Fn=Vt("vec2","vUv"),Qr((()=>{return[Pn=Kt((r=Mn,n=sn(Fn,Dt(1,10)),ln("texture",r,[n],undefined))),xn=Kt((e=rn(rn(rn(vn((t=Pn,fn(t,"x"))),vn(cn(Pn))),vn(hn(Pn))),vn(dn(Pn))),rn(sn(e,Rt),Rt))),Jr(xn,mn(xn,pt(.15))),Jr(xn,sn(sn(xn,sn(nn(rn(pt(1),xn),mn(cn(Fn),pt(4))),.5)),1)),Jr(bn.gl_FragColor,It(En(Lt(.4,1,.6),Lt(0,.6,.2),xn),xn))];var e,t,r,n}))]));function Dn(e){return Math.floor(127*(e+1))}const Ln=Me.getShade("line").update({vert:wn,frag:Un}),In=function(r,o,{withBackFace:u=!1,withNormals:l=!1,withUVs:f=!1,storeType:c}={}){const h={attribs:{position:{buffer:new Float32Array(i(n(s(Ze(et,o),r),u?s((d=Ze(et,o),p=a,(...e)=>{let t=p(d(...e));return t}),r).reverse():[]))),storeType:c}},drawType:"TRIANGLE_STRIP",itemCount:r.length*(u?4:2)};var d,p;return l&&(h.attribs.normal={buffer:new Float32Array(i(n(s((e=>[e.normal,e.normal]),r),u?s((e=>t(2,We(-1,e.normal))),r).reverse():[]))),storeType:c}),f&&(h.attribs.uv={buffer:new Float32Array(i(n(i(e((e=>[[0,e/r.length],[1,e/r.length]]),r.length)),u?i(e((e=>[[1,e/r.length],[0,e/r.length]]),r.length)).reverse():[]))),storeType:c}),h}(function(r,n,s){const a=.2,o=[-.5,-.5],u=[.5,-.4],[l,f]=o,[c,h]=u,d=20*Math.random(),p=20*Math.random(),g=e=>1/8*ke(e,d),y=e=>.1*ke(e,p);return i(e((e=>[[[l+g(e),f+a*e+y(e)],[c+g(e+5),h+a*e+y(e+5)]],[[c+g(e+5),h+a*e+y(e+5)],[l+g(e+1),f+a*(e+1)+y(e+1)]]]),5)).concat([[[l+g(5),f+1+y(5)],[c+g(10),h+1+y(10)]]]).flatMap((([r,n])=>function(r,n,i=20){const s=Xe(n,r),a=qe(s),o=We(1/a,s),u=[o[1],-o[0]],l=t(i,1/i).map(((e,t)=>e*t)),f=l.map(tt).map((e=>e*a)),c=10*Math.random(),h=function(e,t,r,n=[]){const i=Math.min(t.length,r.length);for(let s=0;s<i;s++)n[s]=e(t[s],r[s]);return n}(((e,t)=>[e,t]),f,l.map((e=>Math.sin(e*Math.PI)*ke(3*e,c)*a/3/i))).map((([e,t])=>je(je(r,We(e,o)),We(t,u)))).concat([n]);return(d=h,d.slice(1).map(((t,r)=>e((e=>d[r+e]),2)))).map((([e,t])=>{let r=Xe(t,e),n=qe(r);return Je({vertex:e,length:n,direction:We(1/n,r)})})).concat([Je({vertex:n,direction:o,length:1/(3*i)})]);var d}(r,n,20)))}(),(e=>{return 20*(t=1/900/Math.pow(e.length,.29),Math.max(.001,Math.min(t,.0028)));var t}),{withUVs:!0}),zn=Me.getForm("line").update(In),Bn=Me.getFrame("noiseTex").update({texture:function({startX:e=1,startY:t=1,width:r,height:n,data:i={}}){const s=new Uint8Array(r*n*4),a=$e(r,n,e,t),o=$e(r,n,2.1*e,2.1*t),u=$e(r,n,4.2*e,4.2*t),l=$e(r,n,8.3*e,8.3*t);for(let e=0;e<a.length;e++){const t=4*e;s[t]=Dn(a[e]),s[t+1]=Dn(o[e]),s[t+2]=Dn(u[e]),s[t+3]=Dn(l[e])}return i.data=s,i.width=r,i.height=n,i}({width:256,height:256,startX:3,startY:3,data:{magFilter:"LINEAR",minFilter:"LINEAR",wrap:"REPEAT"}})}),On=Me.getSketch("line").update({form:zn,shade:Ln,uniforms:{noiseTex:Bn.image()}}),Nn=Me.getFrame("scene").update({layers:Me.getLayer("scene").update({sketches:[On],drawSettings:{clearColor:[1,1,1,1],enable:[Me.gl.BLEND]}})});Me.state.time=0,Me.state.device.sizeMultiplier=window.devicePixelRatio,Me.listen("index",Pe.RESIZE,(()=>{Nn.update(),Me.painter.compose(Nn).display(Nn),console.log(Nn._targets[0].width,Me.gl.drawingBufferWidth)}))})()})();
//# sourceMappingURL=main.js.map